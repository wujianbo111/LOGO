C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DDC2BI
OBJECT MODULE PLACED IN .\obj\DDC2Bi.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\..\KERNEL\SYSTEM\DDC2Bi.c OPTIMIZE(SIZE) BROWSE INCDIR(..\..\DRIVER\INC
                    -;..\..\KERNEL\SCALER\INC;..\..\KERNEL\SYSTEM\INC;..\..\LIB\INC;..\..\PANEL\INC;..\..\BOARD;..\..\DRIVER\INC;..\..\KERNEL
                    -\SYSTEM\INC\AOC2011;..\..\DRIVER\extDEVICE\INC;..\..\MODEL;..\..\CONFIG;..\..\PANEL;..\..\UI\F_LOGO\INC;..\..\UI\HkcOsd\
                    -INC) DEFINE(ModelName=JRY_TESTBOARD_C_BOARD) DEBUG OBJECTEXTEND PRINT(.\list\DDC2Bi.lst) OBJECT(.\obj\DDC2Bi.obj)

line level    source

   1          #include "types.h"
   2          #include "board.h"
   3          #include "global.h"
   4          #include "Menudef.h"
   5          #include "menufunc.h"
   6          #include "adjust.h"
   7          #include <math.h>
   8          #include "ms_reg.h"
   9          #include "msOSD.h"
  10          #include "msosdfunction.h"
  11          #include "autofunc.h"
  12          #include "drvadc.h"
  13          #include "ms_rwreg.h"
  14          #include "Debug.h"
  15          #include "misc.h"
  16          #include "mstar.h"
  17          #include "power.h"
  18          #include "keypaddef.h"
  19          #include "ddc2bi.h"
  20          #include "userpref.h"
  21          
  22          #include "msACE.h"
  23          #include "gamma.h"
  24          #include "msflash.h"
  25          #include "mcu.h"
  26          #include "ddc.h"
  27          #include "nvram.h"
  28          #include "GPIO_DEF.h"
  29          #ifdef TSUMXXT//#if( ChipID == ChipTSUMT )              //110311 Modify
              #include "msADC.h"
              #endif
  32          #if PanelminiLVDS || PANEL_VCOM_ADJUST  //110229 Modify
              #include "msMiniLVDSI2c.h"
              #endif
  35          #include "drvgpio.h"
  36          #include "PropFont.h"
  37          ////////////////////////////////////////////////////
  38          //#include "drvDDC2Bi.h" // the function changes to hal
  39          ///////////////////////////////////////////////////
  40          #include "MsDLC.h"      //120413 Modify
  41          #include "drvOSD.h"
  42          
  43          
  44          #if ENABLE_DeltaE
              #include "msAutoGamma_Setting.h"
              extern void drvGammaOnOff(BYTE u8Switch, BYTE u8Window);
              #endif
  48          #define CTEMP_6500K CTEMP_Warm1
  49          #define CTEMP_9300K CTEMP_Cool1
  50          #define CTEMP_7500K CTEMP_Normal
  51          
  52          #define UserPrefRedColor6500K UserPrefRedColorWarm1
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 2   

  53          #define UserPrefGreenColor6500K UserPrefGreenColorWarm1
  54          #define UserPrefBlueColor6500K UserPrefBlueColorWarm1
  55          
  56          #define UserPrefRedColor9300K UserPrefRedColorCool1
  57          #define UserPrefGreenColor9300K UserPrefGreenColorCool1
  58          #define UserPrefBlueColor9300K UserPrefBlueColorCool1
  59          
  60          #define UserPrefRedColor7500K UserPrefRedColorNormal
  61          #define UserPrefGreenColor7500K UserPrefGreenColorNormal
  62          #define UserPrefBlueColor7500K UserPrefBlueColorNormal
  63          
  64          extern Bool SetColor(void);
  65          extern Bool SetColorTemp();
  66          extern Bool CheckFactorySettingOutOfRange(void);
  67          void CheckModeSettingRange();
  68          void Init_FactorySetting(void);
  69          #if ENABLE_HDMI
  70          extern void SetColorBoostWin(BYTE mode);
  71          #else
              extern void SetColorBoostWindow(BYTE mode);
              #endif
  74          #if 0        
              extern Bool AdjustSuperResolution(void);
              #endif
  77          extern Bool xdata bFlashWriteFactory;
  78          
  79          extern WORD CRC16(BYTE nData, WORD nCRC);
  80          
  81          extern void DrawOsdMenu(void);
  82          
  83          #define SIO_ID1     SIORxBuffer[0]
  84          #define SIO_TYPE1   SIORxBuffer[1]
  85          #define SIO_TYPE2   SIORxBuffer[2]
  86          #define SIO_CMD1    SIORxBuffer[3]
  87          #define SIO_CMD2    SIORxBuffer[4]
  88          #define SIO_DATA1   SIORxBuffer[5]
  89          #define SIO_DATA2   SIORxBuffer[6]
  90          #define SIO_DATA3       SIORxBuffer[7]
  91          #define SIOData10   (SIO_DATA1-0x30)*256
  92          #define SIOData11   ((SIO_DATA1-0x41)+10)*256
  93          #define SIOData20   (SIO_DATA2-0x30)*16
  94          #define SIOData21   ((SIO_DATA2-0x41)+10)*16
  95          #define SIOData30   (SIO_DATA3-0x30)
  96          #define SIOData31   (SIO_DATA3-0x41)+10
  97          BYTE AlignControl(void);
  98          #define ASSETSTARTADDR                  0x600
  99          #define ASSETLENGTH                             64
 100          
 101          #if JRY_Color_Tool_Functing
 102          
 103          #define EDID_VGA                              0 
 104          #define EDID_DVI                                   1    
 105          #define EDID_HDMI                             2
 106          #define EDID_DP                             3
 107          
 108          #if JRY_FDDCCI_WriteEDID || WriteSN_Functiom_New
 109          WORD idata edid_cont=0;
 110          BYTE idata edid_pointer=0;
 111          #endif
 112          
 113          #if (ENABLE_HDCP&&JRY_FDDCCI_WriteHDCP)
              #define HDCP_L128                               128
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 3   

              #define HDCP_L33                                33
              WORD idata DDCCI_pointer=0;
              BYTE  idata   DDCCI_cont=0;
              BYTE  idata  Hdcpsave_offset=0 ;
              WORD idata Hdcp_pointer=0;
              WORD idata DDCCi_checksun=0;
              WORD  idata Tchecksun=0;
              WORD idata  checksun_verify=0;
              BYTE  idata Flash_HDCPcont=0;
              #endif
 125          
 126          Bool JRYColorToolControl (void)
 127          {       
 128   1      
 129   1              
 130   1              WhileCounte=5;
 131   1              
 132   1              if(ubAutoAlign==0)
 133   1              {
 134   2                      if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1f)&&(DDCBuffer[5]==0))//enter align mode
 135   2                      {
 136   3                              Set_ATEModeFlag();
 137   3                              Set_FactoryModeFlag();
 138   3                              Set_BurninModeFlag();
 139   3                       #if !USEFLASH
                                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                               #else
 142   3                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
 143   3                       #endif
 144   3      
 145   3                              MenuPageIndex=RootMenu;
 146   3                              MenuItemIndex=0;  
 147   3                              
 148   3                              ubAutoAlign=1;
 149   3                              
 150   3                              DDCBuffer[0]=0x84;
 151   3                              DDCBuffer[1]=0x00;
 152   3                              DDCBuffer[2]=0x4F;
 153   3                              return 2;
 154   3                      }
 155   2                      else
 156   2                      {
 157   3                              return 0;
 158   3                      }
 159   2              }
 160   1              
 161   1      if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x13)&&(DDCBuffer[5]==0))//auto color
 162   1      {
 163   2                       if(AutoColor()!=0)
 164   2                       {
 165   3                              DDCBuffer[1]=0x00;
 166   3                              DDCBuffer[2]=0x4F;
 167   3                       }
 168   2                       else
 169   2                       {
 170   3                              DDCBuffer[1]=0x03;
 171   3                              DDCBuffer[2]=0x58;
 172   3                       }      
 173   2                              DDCBuffer[0]=0x84;
 174   2                      
 175   2                              return 2;
 176   2      }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 4   

 177   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==0))//set CT
 178   1      {
 179   2                              SetFactoryColorTempCool1();
 180   2                              
 181   2                              DDCBuffer[0]=0x84;
 182   2                              DDCBuffer[1]=0x00;
 183   2                              DDCBuffer[2]=0x4F;
 184   2                              return 2;
 185   2      }
 186   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==1))//set CT
 187   1      {
 188   2                              SetFactoryColorTempWarm1();
 189   2                              
 190   2                              DDCBuffer[0]=0x84;
 191   2                              DDCBuffer[1]=0x00;
 192   2                              DDCBuffer[2]=0x4F;
 193   2                              return 2;
 194   2      }
 195   1      
 196   1      #if Adj_7500K_Temp      
              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x14)&&(DDCBuffer[5]==3))//set CT
              {
                              
                                     SetFactoryColorTempNormal();
                                      
                                      DDCBuffer[0]=0x84;
                                      DDCBuffer[1]=0x00;
                                      DDCBuffer[2]=0x4F;
                                      return 2;
              }
              #endif
 208   1      
 209   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x15))//read R gain
 210   1      {
 211   2                              DDCBuffer[0]=0x84;
 212   2                              DDCBuffer[1]=0x00;
 213   2                      if(UserPrefColorTemp==CTEMP_6500K)
 214   2                              DDCBuffer[2]=UserPrefRedColor6500K;//0x4F;
 215   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 216   2                              DDCBuffer[2]=UserPrefRedColor9300K;//0x4F;
 217   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefRedColor7500K;//0x4F;
                              #endif
 221   2                      else 
 222   2                              DDCBuffer[2]=UserPrefRedColor;//0x4F;
 223   2                              return 2;
 224   2      }
 225   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x16))//read G gain
 226   1      {
 227   2                              DDCBuffer[0]=0x84;
 228   2                              DDCBuffer[1]=0x00;
 229   2                      if(UserPrefColorTemp==CTEMP_6500K)
 230   2                              DDCBuffer[2]=UserPrefGreenColor6500K;//0x4F;
 231   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 232   2                              DDCBuffer[2]=UserPrefGreenColor9300K;//0x4F;
 233   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefGreenColor7500K;//0x4F;
                              #endif
 237   2                      else 
 238   2                              DDCBuffer[2]=UserPrefGreenColor;//0x4F;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 5   

 239   2                              return 2;
 240   2      }
 241   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x17))//read B gain
 242   1      {
 243   2                              DDCBuffer[0]=0x84;
 244   2                              DDCBuffer[1]=0x00;
 245   2                      if(UserPrefColorTemp==CTEMP_6500K)
 246   2                              DDCBuffer[2]=UserPrefBlueColor6500K;//0x4F;
 247   2                      else if(UserPrefColorTemp==CTEMP_9300K)
 248   2                              DDCBuffer[2]=UserPrefBlueColor9300K;//0x4F;
 249   2                      #if Adj_7500K_Temp      
                              else if(UserPrefColorTemp==CTEMP_7500K)
                                      DDCBuffer[2]=UserPrefBlueColor7500K;//0x4F;
                              #endif
 253   2                      else 
 254   2                              DDCBuffer[2]=UserPrefBlueColor;//0x4F;
 255   2                              return 2;
 256   2      }
 257   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x15))//write R gain
 258   1      {
 259   2                              BYTE ucR_Gain;
 260   2                              ucR_Gain=DDCBuffer[5];
 261   2                              if((ucR_Gain >= 0) && (ucR_Gain <= 255))
 262   2                              {
 263   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
 264   3                                      {
 265   4                                              UserPrefRedColor6500K=ucR_Gain;
 266   4                                              #if CT_sRGB_ENABLE
                                                      UserPrefRedColorSRGB=ucR_Gain;
                                                      #endif
 269   4                                      }
 270   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 271   3                                              UserPrefRedColor9300K=ucR_Gain;
 272   3                                     #if Adj_7500K_Temp       
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefRedColor7500K=ucR_Gain;
                                             #endif
 276   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 277   3                                              UserPrefRedColor=ucR_Gain;
 278   3                                     mStar_AdjustRedColor(ucR_Gain,UserPrefContrast);
 279   3                                      DDCBuffer[0]=0x84;
 280   3                                      DDCBuffer[1]=0x00;
 281   3                                      DDCBuffer[2]=0x4F;
 282   3                              }
 283   2                              else
 284   2                              {
 285   3                                      DDCBuffer[0]=0x84;
 286   3                                      DDCBuffer[1]=0x03;
 287   3                                      DDCBuffer[2]=0x58;
 288   3                              }
 289   2                              return 2;
 290   2      }
 291   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x16))//write G gain
 292   1      {
 293   2                              BYTE ucG_Gain;
 294   2                              ucG_Gain=DDCBuffer[5];
 295   2                              if((ucG_Gain >= 0) && (ucG_Gain <= 255))
 296   2                              {
 297   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
 298   3                                      {
 299   4                                              UserPrefGreenColor6500K=ucG_Gain;
 300   4                                              #if CT_sRGB_ENABLE
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 6   

                                                      UserPrefGreenColorSRGB=ucG_Gain;
                                                      #endif
 303   4                                      }
 304   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 305   3                                              UserPrefGreenColor9300K=ucG_Gain;
 306   3                                      #if Adj_7500K_Temp      
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefGreenColor7500K=ucG_Gain;
                                              #endif
 310   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 311   3                                              UserPrefGreenColor=ucG_Gain;
 312   3                                     mStar_AdjustGreenColor(ucG_Gain,UserPrefContrast);
 313   3                                      
 314   3                                      
 315   3                                      DDCBuffer[0]=0x84;
 316   3                                      DDCBuffer[1]=0x00;
 317   3                                      DDCBuffer[2]=0x4F;
 318   3                              }
 319   2                              else
 320   2                              {
 321   3                                      DDCBuffer[0]=0x84;
 322   3                                      DDCBuffer[1]=0x03;
 323   3                                      DDCBuffer[2]=0x58;
 324   3                              }
 325   2                              return 2;
 326   2      }
 327   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x17))//write B gain
 328   1      {
 329   2                              BYTE ucB_Gain;
 330   2                              ucB_Gain=DDCBuffer[5];
 331   2                              if((ucB_Gain >= 0) && (ucB_Gain <= 255))
 332   2                              {
 333   3                                      if(UserPrefColorTemp == CTEMP_6500K) 
 334   3                                      {
 335   4                                              UserPrefBlueColor6500K=ucB_Gain;
 336   4                                              #if CT_sRGB_ENABLE
                                                      UserPrefBlueColorSRGB=ucB_Gain;
                                                      #endif
 339   4                                      }
 340   3                                      else if(UserPrefColorTemp == CTEMP_9300K) 
 341   3                                              UserPrefBlueColor9300K=ucB_Gain;
 342   3                                      #if Adj_7500K_Temp      
                                              else if(UserPrefColorTemp == CTEMP_7500K) 
                                                      UserPrefBlueColor7500K=ucB_Gain;
                                              #endif
 346   3                                      else if(UserPrefColorTemp == CTEMP_USER) 
 347   3                                              UserPrefBlueColor=ucB_Gain;
 348   3                                     mStar_AdjustBlueColor(ucB_Gain,UserPrefContrast);
 349   3                                      DDCBuffer[0]=0x84;
 350   3                                      DDCBuffer[1]=0x00;
 351   3                                      DDCBuffer[2]=0x4F;
 352   3                              }
 353   2                              else
 354   2                              {
 355   3                                      DDCBuffer[0]=0x84;
 356   3                                      DDCBuffer[1]=0x03;
 357   3                                      DDCBuffer[2]=0x58;
 358   3                              }
 359   2                              return 2;
 360   2      }
 361   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==0))//save CT
 362   1      {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 7   

 363   2                        UserPrefColorTemp=CTEMP_9300K;
 364   2                      
 365   2                              #if USEFLASH
 366   2                              SaveFactorySetting();
 367   2                              #else
                                   //NVRam_WriteByte(NVR_MONITOR_ADDR(MonitorFlag), FactorySetting);  //need check tina
                                      #endif
 370   2                                                                                              
 371   2                               #if USEFLASH
 372   2                            SaveMonitorSetting();
 373   2                           #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
 376   2                              
 377   2                              DDCBuffer[0]=0x84;
 378   2                              DDCBuffer[1]=0x00;
 379   2                              DDCBuffer[2]=0x4F;
 380   2                              
 381   2                              return 2;
 382   2      }
 383   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==1))//save CT
 384   1      {
 385   2      
 386   2                      UserPrefColorTemp=CTEMP_6500K;
 387   2                      
 388   2                              #if USEFLASH
 389   2                              SaveFactorySetting();                   
 390   2                              #endif
 391   2                              
 392   2                              #if USEFLASH
 393   2                            SaveMonitorSetting();
 394   2                           #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
 397   2                              DDCBuffer[0]=0x84;
 398   2                              DDCBuffer[1]=0x00;
 399   2                              DDCBuffer[2]=0x4F;
 400   2                              return 2;
 401   2      }
 402   1      #if  Adj_7500K_Temp     
              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x18)&&(DDCBuffer[5]==3))//save CT
              {
              
                                      UserPrefColorTemp=CTEMP_7500K;
              
                                      #if USEFLASH
                                      SaveFactorySetting();
                                      #endif
                                              
                                      #if USEFLASH
                                    SaveMonitorSetting();
                                   #else      
                                   NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
                                      DDCBuffer[0]=0x84;
                                      DDCBuffer[1]=0x00;
                                      DDCBuffer[2]=0x4F;
                                      return 2;
              }
              #endif
 423   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x19)&&(DDCBuffer[5]==0))//set brightness and contrast defaul
             -t
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 8   

 424   1      {
 425   2                              UserPrefBrightness=DefBrightness;
 426   2                              UserPrefContrast=DefContrast;
 427   2                              mStar_AdjustBrightness(UserPrefBrightness);
 428   2                              mStar_AdjustContrast( UserPrefContrast );
 429   2                              DDCBuffer[0]=0x84;
 430   2                              DDCBuffer[1]=0x00;
 431   2                              DDCBuffer[2]=0x4F;
 432   2                              return 2;
 433   2      }
 434   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x1A))//read adjust brightness 
 435   1      {
 436   2                              DDCBuffer[0]=0x84;
 437   2                              DDCBuffer[1]=0x00;
 438   2                              DDCBuffer[2]=UserPrefBrightness;
 439   2                              return 2;
 440   2      }
 441   1      else if((DDCBuffer[3]==0x32)&&(DDCBuffer[4]==0x1B))//read adjust contrast
 442   1      {
 443   2                  UserPrefContrast=GetScale100Value(UserPrefContrast, MinContrastValue, MaxContrastValue);
 444   2                              DDCBuffer[0]=0x84;
 445   2                              DDCBuffer[1]=0x00;
 446   2                              DDCBuffer[2]=UserPrefContrast;
 447   2                              return 2;
 448   2      }
 449   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1A))//write adjust brightness 
 450   1      {
 451   2                              BYTE uctempData;
 452   2                              uctempData=DDCBuffer[5];
 453   2                              if((uctempData >= 0) && (uctempData <= 100))
 454   2                              {
 455   3                                      UserPrefBrightness=uctempData;
 456   3                                      mStar_AdjustBrightness(UserPrefBrightness);
 457   3                                      DDCBuffer[1]=0x00;
 458   3                                      DDCBuffer[2]=0x4F;
 459   3                              }
 460   2                              else
 461   2                              {
 462   3                                      DDCBuffer[1]=0x03;
 463   3                                      DDCBuffer[2]=0x58;
 464   3                              }
 465   2                              DDCBuffer[0]=0x84;
 466   2                              return 2;
 467   2      }
 468   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1B))//write adjust contrast
 469   1      {
 470   2                              BYTE uctempData;
 471   2                              uctempData=DDCBuffer[5];
 472   2                              if((uctempData >= 0) && (uctempData <= 100))
 473   2                              {
 474   3                                      UserPrefContrast=uctempData;
 475   3                                      mStar_AdjustContrast(UserPrefContrast);
 476   3                                      
 477   3                                      DDCBuffer[1]=0x00;
 478   3                                      DDCBuffer[2]=0x4F;
 479   3                              }
 480   2                              else
 481   2                              {
 482   3                                      DDCBuffer[1]=0x03;
 483   3                                      DDCBuffer[2]=0x58;
 484   3                              }
 485   2                              DDCBuffer[0]=0x84;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 9   

 486   2                              return 2;
 487   2      }
 488   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1C))//set default language or select reset language
 489   1      {
 490   2                              UserPrefLanguage=DefLanguage;
 491   2                              
 492   2                              DDCBuffer[0]=0x84;
 493   2                              DDCBuffer[1]=0x00;
 494   2                              DDCBuffer[2]=0x4F;
 495   2                              return 2;
 496   2      }
 497   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1D)&&(DDCBuffer[5]==0))//enter burn mode
 498   1      {
 499   2                              return 0;
 500   2      }
 501   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x1D)&&(DDCBuffer[5]==1))//exit burn mode
 502   1      {
 503   2                              return 0;
 504   2      }
 505   1      else if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1F)&&(DDCBuffer[5]==0))//enter align mode
 506   1      {
 507   2                              Set_ATEModeFlag();
 508   2                              Set_FactoryModeFlag();
 509   2                              Set_BurninModeFlag();
 510   2                       #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                               #else
 513   2                       UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
 514   2                       #endif
 515   2      
 516   2                              DDCBuffer[0]=0x84;
 517   2                              DDCBuffer[1]=0x00;
 518   2                              DDCBuffer[2]=0x4F;
 519   2                              return 2;
 520   2      }
 521   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x21)&&(DDCBuffer[5]==0))//factory mode on
 522   1      {
 523   2                              DDCBuffer[0]=0x84;
 524   2                              DDCBuffer[1]=0x00;
 525   2                              DDCBuffer[2]=0x4F;
 526   2                              return 2;
 527   2      }
 528   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x21)&&(DDCBuffer[5]==1))//factory mode off
 529   1      {
 530   2                      ubAutoAlign=0;
 531   2                      if(FactoryModeFlag)
 532   2                      {       
 533   3                               #if USEFLASH
 534   3                            SaveMonitorSetting();
 535   3                           #else      
                                              NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                      #endif
 538   3                               MenuPageIndex=RootMenu;
 539   3                               MenuItemIndex=0; 
 540   3                               Osd_Hide();                    
 541   3                               SaveUserPrefSetting(0);
 542   3                              
 543   3                      }
 544   2                      else
 545   2                      {
 546   3                              SaveUserPrefSetting(0);//SaveUserPref();
 547   3                      }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 10  

 548   2      }
 549   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x23)&&(DDCBuffer[5]==0))//change source vga
 550   1      {
 551   2                              DDCBuffer[0]=0x84;
 552   2                              DDCBuffer[1]=0x00;
 553   2                              DDCBuffer[2]=0x4F;
 554   2                              return 2;
 555   2      }
 556   1      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x23)&&(DDCBuffer[5]==1))//change source dvi
 557   1      {
 558   2                              DDCBuffer[0]=0x84;
 559   2                              DDCBuffer[1]=0x00;
 560   2                              DDCBuffer[2]=0x4F;
 561   2                              return 2;
 562   2      }
 563   1      #if WriteSN_Functiom_New
              
                  else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x30))//3DDC长度
                 {
                                edid_cont=((DDCBuffer[5])*128);
                                 edid_pointer=0;
                                  if((DDCBuffer[5])<3)
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                      }
                                  else
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                      }
                      }
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x31))//3DDC接收
                              {
                                      BYTE  j,i=0;
                                      j=DDCBuffer[5];
                                      if (edid_pointer<edid_cont)
                                       {
                                       for(i=0;i<j;i++)
                                            {
                                               DDC1[edid_pointer]=DDCBuffer[6+i];
                                               edid_pointer++;
                                            }
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                       }
                                      else
                                      {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
                                     }                                
                              }
                       else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x32))   //3ddC 校验
                              {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 11  

                                       BYTE  checksun=0;
                                       WORD  i;
                                      if ((edid_cont==128)||(edid_cont==256))
                                      {
                                              for(i=0;i<128;i++)
                                              {
                                                      checksun+=DDC1[i];                              
                                              }
                                                      if(checksun==0)
                                                      {
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=0x00;
                                                              DDCBuffer[2]=0x4F;
                                                              return 2;
                                                      }
                                      }
              
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
              
                              }
                       else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x33))//3ddc保存
                              {
                                       BYTE  checksun;
                                       BYTE  EDID_TYPE=0;
                                         #if USEFLASH
                                       WORD  i;
                                        #endif
              
                                      //Osd_Show();
                                      #if ENABLE_VGA
                                       if(DDCBuffer[5]==0)                            
                                         EDID_TYPE=EDID_VGA;  
                                       #elif ENABLE_DVI
                                       if (DDCBuffer[5]==1)
                                         EDID_TYPE=EDID_DVI;
                                       #elif ENABLE_HDMI
                                       if (DDCBuffer[5]==2)
                                         EDID_TYPE=EDID_HDMI;
                                       #endif
                                      else
                                        {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;
                                        }
                                              
                                      #if USEFLASH
              
                                        #if ENABLE_VGA
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCA, FALSE,  DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);        
                                        #elif ENABLE_DVI
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCD, FALSE,  DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE);   
                                        #elif ENABLE_HDMI
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_DDCH, FALSE,  DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);
                                        #endif
                                      
                                      checksun=DDC1[0x7F];  //2  只需校验128 字节
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 12  

                                      for(i=0;i<edid_cont;i++) DDC1[i]=0;
                                     
                                        #if ENABLE_VGA
                                               Flash_Read_Factory_KeySet(FLASH_KEY_DDCA, TRUE, 0, DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);
                                        #elif ENABLE_DVI
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCD, TRUE, 0,   DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE); 
                                        #elif ENABLE_HDMI
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCH, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE); 
                                        #endif
              
                                     #endif     
                                                       
                                           if(DDC1[(0x7F)]==checksun)
                                              {       
              
              
                                              Set_DDCCIReadLoadEDIDFlag();
                                              //SaveMonitorSetting();
                                              WhileCounte=1;
                                              Power_TurnOffLed();             //3灭灯指示
                                      
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x00;
                                                      DDCBuffer[2]=0x4F;
                                                      return 2;
                                              }
                                            else
                                              {
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x03;
                                                      DDCBuffer[2]=0x58;
                                                      return 2;
                                              }
                              }
              
              #elif  JRY_FDDCCI_WriteEDID
 707   1          else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x30))//DDC长度
 708   1                      {
 709   2                              #if LoadAllPortSeriealnumberByOneVGAPort                         
 710   2                                      Clr_DDCCOneVGAPortLoadEDIDFlag();               
 711   2                              #endif
 712   2                      
 713   2                        edid_cont=((DDCBuffer[5])*128);
 714   2                         edid_pointer=0;
 715   2                          if((DDCBuffer[5])<3)
 716   2                              {
 717   3                                      DDCBuffer[0]=0x84;
 718   3                                      DDCBuffer[1]=0x00;
 719   3                                      DDCBuffer[2]=0x4F;
 720   3                                      return 2;
 721   3                              }
 722   2                          else
 723   2                              {
 724   3                                      DDCBuffer[0]=0x84;
 725   3                                      DDCBuffer[1]=0x03;
 726   3                                      DDCBuffer[2]=0x58;
 727   3                                      return 2;                               
 728   3                              }
 729   2                      }
 730   1      
 731   1              else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x31))//DDC接收
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 13  

 732   1                      {
 733   2                              BYTE  j,i=0;
 734   2                              j=DDCBuffer[5];
 735   2                              if (edid_pointer<edid_cont)
 736   2                               {
 737   3                               for(i=0;i<j;i++)
 738   3                                    {
 739   4                                       DDC1[edid_pointer]=DDCBuffer[6+i];
 740   4                                       edid_pointer++;
 741   4                                    }
 742   3                                      DDCBuffer[0]=0x84;
 743   3                                      DDCBuffer[1]=0x00;
 744   3                                      DDCBuffer[2]=0x4F;
 745   3                                      return 2;
 746   3                               }
 747   2                              else
 748   2                                {
 749   3                                      DDCBuffer[0]=0x84;
 750   3                                      DDCBuffer[1]=0x03;
 751   3                                      DDCBuffer[2]=0x58;
 752   3                                      return 2;
 753   3                               }                              
 754   2                      }
 755   1               else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x32))   //2    ddC 校验
 756   1                      {
 757   2                               BYTE  checksun=0;
 758   2                               WORD  i;
 759   2                              if ((edid_cont==128)||(edid_cont==256))
 760   2                                      {
 761   3                                      for(i=0;i<edid_cont;i++)
 762   3                                              {
 763   4                                              checksun+=DDC1[i];
 764   4                                              
 765   4                                              }
 766   3                                              if(checksun==0)
 767   3                                                      {
 768   4                                                      DDCBuffer[0]=0x84;
 769   4                                                      DDCBuffer[1]=0x00;
 770   4                                                      DDCBuffer[2]=0x4F;
 771   4                                                      return 2;
 772   4                                                      }
 773   3      
 774   3                                      }
 775   2      
 776   2                                      DDCBuffer[0]=0x84;
 777   2                                      DDCBuffer[1]=0x03;
 778   2                                      DDCBuffer[2]=0x58;
 779   2                                      return 2;
 780   2      
 781   2                      }
 782   1               else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x33))//ddc保存
 783   1                      {
 784   2                               BYTE  checksun;
 785   2                               BYTE  EDID_TYPE=0;
 786   2                                 #if USEFLASH
 787   2                               WORD  i;
 788   2                                #endif
 789   2      
 790   2                              //Osd_Show();
 791   2                              if(DDCBuffer[5]==0)                             
 792   2                                 EDID_TYPE=EDID_VGA;                          
 793   2                              else if (DDCBuffer[5]==1)
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 14  

 794   2                                 EDID_TYPE=EDID_DVI;
 795   2                              else if (DDCBuffer[5]==2)
 796   2                                 EDID_TYPE=EDID_HDMI;
 797   2                              else if (DDCBuffer[5]==3)
 798   2                                 EDID_TYPE=EDID_DP;                   
 799   2                              #if USEFLASH
 800   2                              
 801   2                                if(EDID_TYPE==EDID_VGA)
 802   2                                      {
 803   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCA, FALSE,  DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);        
 804   3                                      }
 805   2                           else if (EDID_TYPE==EDID_DVI)
 806   2                                      {
 807   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCD, FALSE,  DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE);           
 808   3                             }
 809   2                              #if ENABLE_HDMI
 810   2                            else if (EDID_TYPE==EDID_HDMI)
 811   2                              {
 812   3                                              Flash_Write_Factory_KeySet(FLASH_KEY_DDCH, FALSE,  DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);
 813   3                              }
 814   2                              #endif    
 815   2                              #if DP_WRITE_SN
                                        else if (EDID_TYPE==EDID_DP)
                                              {
                                                      Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, FALSE, DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);    
                                              }
                                      #endif
 821   2                              
 822   2                              checksun=DDC1[edid_cont-1];
 823   2              
 824   2                              for(i=0;i++;i<edid_cont)
 825   2                                      DDC1[i]=0;
 826   2                             
 827   2                              if(EDID_TYPE==EDID_VGA)
 828   2                                      {
 829   3                                       Flash_Read_Factory_KeySet(FLASH_KEY_DDCA, TRUE, 0, DDCAKEY_SIZE, DDC1, DDCAKEY_S
             -IZE);
 830   3                                      }
 831   2                             else if (EDID_TYPE==EDID_DVI)
 832   2                              {
 833   3                                              Flash_Read_Factory_KeySet(FLASH_KEY_DDCD, TRUE, 0,   DDCDKEY_SIZE, DDC1, DDCDKEY_SIZE); 
 834   3                              }
 835   2                              #if ENABLE_HDMI//(!(CHIP_ID == CHIP_TSUM9 || CHIP_ID == CHIP_TSUMF) )
 836   2                                else if (EDID_TYPE==EDID_HDMI)
 837   2                                      {
 838   3                                              Flash_Read_Factory_KeySet(FLASH_KEY_DDCH, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE); 
 839   3                                      }
 840   2                              #endif
 841   2                              #if  0//DP_WRITE_SN
                                        else if (EDID_TYPE==EDID_DP)
                                              {
                                                      Flash_Read_Factory_KeySet(FLASH_KEY_DDCDP, TRUE, 0,   DDCHKEY_SIZE, DDC1, DDCHKEY_SIZE);        
                                              }
                                      #endif
 847   2                              #elif 0//else
                                      
                                               if(EDID_TYPE==EDID_VGA)
                                               NVRam_WriteTbl( RM_MHL_EDID_BASEADDR , DDC1, 128 );
                                               else if (EDID_TYPE==S_EDID_DVI)
                                               NVRam_WriteTbl( RM_MHL_EDID_BASEADDR+128 , DDC1, 128 );
              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 15  

                                               checksun=DDC1[edid_cont-1];
                                               DDC1[edid_cont-1]=0;
                                               
                                              if(EDID_TYPE==EDID_VGA)
                                               NVRam_ReadTbl( RM_MHL_EDID_BASEADDR , &DDC1, 128 );
                                              else if (EDID_TYPE==S_EDID_DVI)
                                              NVRam_ReadTbl( RM_MHL_EDID_BASEADDR+128 , &DDC1, 128 );
                                     #endif     
 862   2                                               
 863   2                                   if(DDC1[(edid_cont-1)]==checksun)
 864   2                                      {       
 865   3                                      #if VGA_Write_EEPROM
                                                      if (EDID_TYPE==EDID_VGA)
                                                      {
                                                              Set_Load_VGAEDID_Flag();
                                                      }
                                              #endif
 871   3      
 872   3                                      #if LoadAllPortSeriealnumberByOneVGAPort                         
 873   3                                              if (EDID_TYPE==EDID_VGA)
 874   3                                              {
 875   4                                                      Set_DDCCOneVGAPortLoadEDIDFlag();
 876   4                                              }                                               
 877   3                                      #endif
 878   3                                      
 879   3                                      #if DVI_Write_EEPROM
                                                      if (EDID_TYPE==EDID_DVI)
                                                      {
                                                              Set_Load_DVIEDID_Flag();
                                                      }
                                              #endif
 885   3                                      
 886   3                                      #if HDMI_Write_EEPROM
 887   3                                              if (EDID_TYPE==EDID_HDMI)
 888   3                                              {
 889   4                                                      Set_Load_HDMIEDID_Flag();
 890   4                                                      #if HDMI2_Write_EEPROM
                                                              Set_Load_HDMI2EDID_Flag();
                                                              #endif
 893   4                                              }
 894   3                                      #endif
 895   3      
 896   3                                      Set_DDCCIReadLoadEDIDFlag();
 897   3                                      DDCCILoadEDIDCount=0;
 898   3                                      
 899   3                                              DDCBuffer[0]=0x84;
 900   3                                              DDCBuffer[1]=0x00;
 901   3                                              DDCBuffer[2]=0x4F;
 902   3                                              return 2;
 903   3                                      }
 904   2                                    else
 905   2                                      {
 906   3                                              DDCBuffer[0]=0x84;
 907   3                                              DDCBuffer[1]=0x03;
 908   3                                              DDCBuffer[2]=0x58;
 909   3                                              return 2;
 910   3                                      }
 911   2                      }
 912   1      #endif
 913   1      
 914   1      #if (ENABLE_HDCP&&JRY_FDDCCI_WriteHDCP)
              #message "please check , dont  have this function"
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 16  

              #elif 0
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x34))//HDCP 长度
                              {
                                      if((DDCBuffer[5])==6)
                                              {
                                              //当前批次[6]
                                              //分三批，第一/二批128BYTE,
                                              //第三批33YBTE.
                                              //当为第一批次时清零校验和。
                                              if(DDCBuffer[6]==0)
                                           {            
                                                       DDCCi_checksun=0;
                                               Flash_HDCPcont=0;
                                           }
                                              // 3个批次，第一次传0，第二次传1，第三次传2
                                              Hdcpsave_offset=DDCBuffer[6];
                                              //DDCCI_cont本批大小[7]；
                                              DDCCI_cont=DDCBuffer[7];
                                              //Hdcp_pointer本批次的OFFSET 起始位置[8][9]
                                              Hdcp_pointer=DDCBuffer[8];
                                              Hdcp_pointer=Hdcp_pointer<<8;
                                              Hdcp_pointer=Hdcp_pointer|DDCBuffer[9];
                                              //Tchecksun本批次的Checksun
                                              Tchecksun=DDCBuffer[10];
                                              Tchecksun=Tchecksun<<8;
                                              Tchecksun=Tchecksun|DDCBuffer[11];
                                              
                                              DDCCI_pointer=0;
                                              //DDCCI_pointer=0;
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=0x4F;
                                              return 2;
                                              }
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
              
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x35))//HDCP  接收
                              {
                                      BYTE  j,i=0;
                                      j=DDCBuffer[5];
                                      if(DDCCI_pointer<DDCCI_cont)
                                              {
                                              //传4批次，每批次32BYTE
                                              for(i=0;i<j;i++)
                                                      {
                                                      
                                                        if(Flash_HDCPcont==0)
                                                      {               
                                                      DDC1[DDCCI_pointer]=DDCBuffer[6+i];
                                                      DDCCi_checksun+=DDC1[DDCCI_pointer];
                                                       }
                                                   else if(Flash_HDCPcont==1)
                                                      {
                                                        DDC1[DDCCI_pointer+128]=DDCBuffer[6+i];
                                                      DDCCi_checksun+=DDC1[DDCCI_pointer+128];
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 17  

                                                       }
                                                   else if(Flash_HDCPcont==2)
                                                     {   
                                                        DDC1[DDCCI_pointer+256]=DDCBuffer[6+i];
                                                              DDCCi_checksun+=DDC1[DDCCI_pointer+256];
                                                      }
                                               
                                                      DDCCI_pointer++;
                                                      }
                                              if(DDCCI_pointer<=(DDCCI_cont-1))//2<=  保证卡在最后一次发送校验码
                                                      {
              
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=0x00;
                                                              DDCBuffer[2]=0x4F;
                                                              return 2;
                                                      }
                                              else if((DDCCI_pointer==DDCCI_cont)&&(Tchecksun==DDCCi_checksun))
                                                      {
                      //////////////////////////////至此->本批次接收数据OK，可以以Hdcp_pointer为OFFSET 进行保存////////////////
             -/////////////////////
                                                              //Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, Hdcp_pointer,  DDCCI_cont, RX_EDID
             -, DDCCI_cont);        
                                                      if(Flash_HDCPcont==2)
                                                              {
                                                              #if USEFLASH    
                                                                     Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, 0, HDCPKEY_SIZE, DDC1, HDCPKE
             -Y_SIZE);        
                                                              #else
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR , DDC1, 128 );
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR+128 , DDC1+128, 128 );
                                                                      NVRam_WriteTbl( RM_HDCP_KEY_BASEADDR+256 , DDC1+256, 33 );      
                                                              #endif
                                                              }
                                                             Flash_HDCPcont++;
                                                     
                                                              DDCBuffer[0]=0x84;
                                                              DDCBuffer[1]=DDCCi_checksun&0xff;
                                                              DDCBuffer[2]=DDCCi_checksun>>8;
                                                              return 2;
                                                      }
                                              else
                                                      {
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x03;
                                                      DDCBuffer[2]=0x58;
                                                      return 2;                               
                                                      }
              
                                              }               
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
                      else if((DDCBuffer[3]==0x39)&&(DDCBuffer[4]==0x36))//HDCP 校验
                              {
                                WORD  wCount ; 
                             BYTE   i=0;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 18  

                              //在此处对保存的数据进行读取，如果校验和与此前接收的校验和相等则OK,否则NG.
                               checksun_verify=0;
              
                          for(i=0;i<20;i++)
                              DDC1[i]=0;
                           
                               #if USEFLASH   
                                      Flash_Read_Factory_KeySet(FLASH_KEY_HDCP, TRUE, 0, HDCPKEY_SIZE, DDC1, HDCPKEY_SIZE);
                              #else
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR , &DDC1, 128 );
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR+128 , &DDC1+128, 128 );
                                      NVRam_ReadTbl( RM_HDCP_KEY_BASEADDR+256 , &DDC1+256, 33 );
                              #endif
                              
                                      for(wCount=0; wCount<289; wCount++)
                                      {
                                              checksun_verify+=DDC1[wCount];
                                      }
              
                                      if(DDCCi_checksun==checksun_verify)
                                              {
                                                  Set_LoadHDCPKeyFlag();
              
                                                      DDCBuffer[0]=0x84;
                                                      DDCBuffer[1]=0x00;
                                                      DDCBuffer[2]=0x4f;
                                                      return 2;
                                              }
                                      else
                                              {
                                              DDCBuffer[0]=0x84;
                                              DDCBuffer[1]=0x03;
                                              DDCBuffer[2]=0x58;
                                              return 2;                               
                                              }
                              }
              #endif
1074   1      
1075   1               else if((DDCBuffer[3]==0x35)&&(DDCBuffer[4]==0x1F)&&(DDCBuffer[5]==1))//exit align mode
1076   1                      {
1077   2                              ubAutoAlign=0;
1078   2      
1079   2                              if(FactoryModeFlag)
1080   2                              {
1081   3                                      Osd_Hide();
1082   3                                      Clr_FactoryModeFlag();  
1083   3                                      MenuPageIndex=RootMenu;
1084   3                              }               
1085   2                      #if USEFLASH
1086   2                              SaveMonitorSetting();
1087   2                      #else   
                                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                              #endif
1090   2                              DDCBuffer[0]=0x84;
1091   2                              DDCBuffer[1]=0x00;
1092   2                              DDCBuffer[2]=0x4F;
1093   2                              return 2;
1094   2                  }
1095   1      
1096   1      else
1097   1      {
1098   2                              DDCBuffer[0]=0x84;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 19  

1099   2                              DDCBuffer[1]=0x03;
1100   2                              DDCBuffer[2]=0x58;
1101   2                              return 2;
1102   2      }
1103   1                      return 2;
1104   1      }
1105          #endif
1106          
1107          #if ENABLE_DP_INPUT     //121130 Modify
              #if DPENABLEMCCS
              BYTE data ucfinal_status,g_ucDDC_TxRecord ;  // use idata to speedup
              WORD data DDC2BI_INT_STS, DDC2BI_R_BUF, DDC2BI_W_BUF, DDC2BI_INT_CLR;
              code BYTE dpNullMsg[3]={0x6e, 0x80, 0xbe};
              static BYTE u8DDC_RxRecord = 0;
              #endif
              #endif
1115          //BYTE u8BackupOutDE_H,u8BackupOutDE_L;
1116          //#endif
1117          
1118          BYTE code MODEL_TYPE[] = 
1119          {
1120              Model
1121          };
1122          
1123          extern  BYTE xdata MenuPageIndex;
1124          extern  BYTE xdata MenuItemIndex;
1125          
1126          #if Enabe_DDCCI_FUNCTION
1127          BYTE code CAP_VCP[]=
1128          {
1129          "("
1130          "vcp(02 04 05 06 08 0E 10 12 14( 04 05 08 0B) 16 18 1A 1E 20 30 3E "
1131          #if 0//AudioFunc
              "62 "
              "8D "
              #endif
1135          #if Dual
1136          "60(01 03) "
1137          #endif
1138          "C8 C9 "
1139          #if Enable_DDCCI_OSDEnable_EN
              "CA "
              #endif
1142          #if 1
1143          "CC(01 02 03 04 05 06 07 09 0A 0B 0D 0E 12 14 16 1E) "
1144          #endif
1145          "B0 B6 D6 DF F8)"
1146          "prot(monitor)"
1147          "type(LCD)"
1148          "cmds(01 02 03 07 0C F3)"
1149          "mccs_ver(2.1)"
1150          "asset_eep(64)"
1151          "mpu_ver("FWVersion")"
1152          "model("Model")"
1153          "mswhql(1)"
1154          ")"
1155          };
1156          #if Dual
1157          BYTE code DVI_CAP_VCP[]=
1158          {
1159          "("
1160          "vcp(02 04 05 08 10 12 14( 04 05 08 0B) 16 18 1A 60(01 03)"
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 20  

1161          #if AudioFunc
1162          "62 "
1163          "8D "
1164          #endif
1165          #if Dual
1166          "60(01 03) "
1167          #endif
1168          " C8 C9 "
1169          #if 1
1170          "CC(01 02 03 04 05 06 07 09 0A 0B 0D 0E 12 14 16 1E) "
1171          #endif
1172          "B0 B6 D6 DF "
1173          #if ENABLE_FREESYNC
              "ED "
              #endif
1176          #if Enable_DDCCI_OSDEnable_EN
              "CA "
              #endif
1179          "F8)"
1180          "prot(monitor)"
1181          "type(LCD)"
1182          "cmds(01 02 03 07 0C F3)"
1183          "mccs_ver(2.1)"
1184          "asset_eep(64)"
1185          "mpu_ver("FWVersion")"
1186          "model("Model")"
1187          "mswhql(1)"
1188          ")"
1189          };
1190          #endif
1191          #else
              BYTE code CAP_VCP[]=
              {
              "6C 6E 70 C8 C9 "
              };
              #if Dual
              BYTE code DVI_CAP_VCP[]=
              {
              "6C 6E 70 C8 C9 "
              };
              #endif
              #endif
1203          
1204          void DDC2Bi_InitRx(void)
1205          {
1206   1          rxStatus = DDC2B_CLEAR;
1207   1          rxIndex = 0;
1208   1      }
1209          void DDC2Bi_Init( void )
1210          {
1211   1          drvDDC2Bi_Init();
1212   1      }
1213          void DDC2Bi_GetTxBuffer( void )
1214          {
1215   1          BYTE i;
1216   1          for( i = MAX_TXWAIT_DELAY; i > 0; i-- )
1217   1              if( txStatus == DDC2B_MSGON )
1218   1              {
1219   2                  Delay1ms( 1 );
1220   2              }
1221   1          txStatus = DDC2B_CLEAR;
1222   1      }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 21  

1223          BYTE DDC2Bi_ComputeChecksum( BYTE count )
1224          {
1225   1          BYTE CheckSum;
1226   1          BYTE i = 0;
1227   1          CheckSum = INITTxCK;
1228   1          for( ; count > 0; count-- )
1229   1              CheckSum ^= DDCBuffer[i++];
1230   1          return CheckSum;
1231   1      }
1232          void DDC2Bi_MessageReady( void )
1233          {
1234   1          drvDDC2Bi_MessageReady();
1235   1      }
1236          void DDC2Bi_ParseCommand( void )
1237          {
1238   1          drvDDC2Bi_ParseCommand();
1239   1      }
1240          void DDC2Bi_CommandHandler( void )
1241          {
1242   1          if( rxStatus == DDC2B_COMPLETED )
1243   1          {
1244   2              DDC2Bi_ParseCommand();
1245   2              Clr_RxBusyFlag();
1246   2              DDC2Bi_InitRx();
1247   2          }
1248   1      }
1249          void DoDDCCI( BYTE Source ) // Annie 2006.7.5
1250          {
1251   1          drvDoDDCCI(Source);
1252   1      }
1253          void ISR_DDC2Bi(void)
1254          {
1255   1      #if CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF
1256   1          if( ADC_INT_FLAG &( BIT3 | BIT4 ) )
1257   1          {
1258   2              DoDDCCI( InputCombo_A0 );
1259   2              CLR_ADC_INT_FLAG();
1260   2          }
1261   1        #if DDC_Port_D0
1262   1          else if( DDCDVI0_INT_FLAG &( BIT3 | BIT4 ) )
1263   1          {
1264   2              DoDDCCI( InputCombo_D0 );
1265   2              CLR_DVI0_INT_FLAG();
1266   2          }
1267   1        #endif
1268   1        #if DDC_Port_D1
                  else if( DDCDVI1_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( InputCombo_D1 );
                      CLR_DVI1_INT_FLAG();
                  }
                #endif
1275   1        #if DDC_Port_D2
                  else if( DDCDVI2_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( InputCombo_D2 );
                      CLR_DVI2_INT_FLAG();
                  }
                #endif
1282   1      
1283   1      #else // CHIP_ID != CHIP_TSUMC
                  if( ADC_INT_FLAG &( BIT3 | BIT4 ) )
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 22  

                  {
                      DoDDCCI( Input_VGA );
                      CLR_ADC_INT_FLAG();
                  }
                #if INPUT_TYPE!=INPUT_1A
                  else if( DDCDVI_INT_FLAG &( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( Input_Digital );
                      CLR_DVI_INT_FLAG();
                  }
                #endif
                #if ENABLE_HDMI
                  else if( DDCHDMI_INT_FLAG & ( BIT3 | BIT4 ) )
                  {
                      DoDDCCI( Input_HDMI );
                      CLR_HDMI_INT_FLAG();
                  }
                #endif
              #endif // #if CHIP_ID == CHIP_TSUMC
1304   1      }
1305          
1306          
1307          #if  ENABLE_DP_INPUT    //121130 Modify
              #if  DPENABLEMCCS
              //================= DP =====================
              #if CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD//130607 xiandi
              void DDC2BI_DP(void)
              {
              
                  BYTE u8AUXCH_RxCmd;
                  BYTE u8DDC_Length;
                  #define u8DDC_RxOnGoing u8DDC_RxRecord
              
                  u8AUXCH_RxCmd = (msRegs[REG_0638 + Aux])&0x0F;
                  u8DDC_Length = msRegs[REG_063A+ Aux];
                  //===============//<write>PC Read Command============================
                   if(u8AUXCH_RxCmd & _BIT0)    //DP Tx
                  {
              
                      if (u8DDC_Length)
                      {
                          if(rxStatus == DDC2B_CLEAR && txLength)
                          {
                              while(u8DDC_Length-- && txLength)
                              {
                                  if(g_ucDDC_TxRecord)
                                  {
                                      msRegs[REG_06D3 + Aux]=DDCBuffer[g_ucDDC_TxRecord-1];
                                      txLength--;
                                  }
                                  else
                                      msRegs[REG_06D3 + Aux]=DDC2B_DEST_ADDRESS;
              
                                      g_ucDDC_TxRecord++;
                              }
                          }
                          else
                          {
                              while(u8DDC_Length--)
                              {
                                   msRegs[REG_06D3 + Aux]= dpNullMsg[g_ucDDC_TxRecord++];
                              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 23  

                          }
                      }
              
                  }
                  //===============//<write>PC Write Command============================
                  else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x04)    //DP Rx
                                 {
                          if (u8DDC_Length)
                          {
                              if (!u8DDC_RxOnGoing)
                              {
                                  BYTE xdata temp;
                                  msRegs[REG_06FC + Aux]= msRegs[REG_06FC + Aux]|_BIT2;
                                  temp=msRegs[REG_0675 + Aux];
                                  rxIndex=0;
                                  u8DDC_RxOnGoing=TRUE;
                                  u8DDC_Length--;
                              }
                              while(u8DDC_Length--)
                              {
                                   BYTE xdata temp1=10;
                                      msRegs[REG_06FC + Aux]= msRegs[REG_06FC + Aux]|_BIT2;
                                      while(temp1--){};
                                      temp1=10;
                                      DDCBuffer[rxIndex++] = msRegs[REG_0675 + Aux];
                              }
                          }
              
                          if (u8AUXCH_RxCmd==0x00)
                          {
                              u8DDC_RxOnGoing=FALSE;
                              g_ucDDC_TxRecord=0;
                              rxStatus = DDC2B_COMPLETED;
                              txLength=0;
                          }
              
                  }
                          msRegs[REG_0679 + Aux]= msRegs[REG_0679 + Aux]|_BIT7;//Clear Interrupt
                          msRegs[REG_0679 + Aux]= 0x00;
              
                  #undef u8DDC_RxOnGoing
              
              
              }
              void msDP_DDC2BI(void)
              {
                   if(msRegs[REG_0678 + Aux]&_BIT7)   //MCCS Interrupt
                  {
                      DDC2BI_DP() ;
                  }
              }
              #elif CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF
              //================= DP =====================
              
              void DDC2BI_DP(void)     //Rockman
              {
              
                      BYTE u8AUXCH_RxCmd;
                      BYTE u8DDC_Length;
                      #define u8DDC_RxOnGoing u8DDC_RxRecord
                 
                      u8AUXCH_RxCmd = (msRegs[REG_0638 + Aux])&0x0F;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 24  

                      u8DDC_Length = msRegs[REG_063A+ Aux];
                      //===============//<write>PC Read Command============================
                       if(u8AUXCH_RxCmd & _BIT0)    //DP Tx
                      {
              
                          if (u8DDC_Length)
                          {   
                              
                              if(rxStatus == DDC2B_CLEAR && txLength)
                              {
                                  while(u8DDC_Length-- && txLength)
                                  {
                                      if(g_ucDDC_TxRecord)
                                      {
                                          msRegs[REG_06F3]=DDCBuffer[g_ucDDC_TxRecord-1];
                                          //msRegs[REG_06F3]= test[g_ucDDC_TxRecord-1];
                                          txLength--;
                                      }
                                      else
                                          msRegs[REG_06F3] =DDC2B_DEST_ADDRESS;
              
                                          msRegs[REG_06F2 ] = BIT0;
                                          while( ! (((msRegs[REG_06F2])&BIT2)))               // Wait
                                        {}
                                        msRegs[REG_06F1 ] = BIT1;                                    // Clear   
                                       g_ucDDC_TxRecord++;
                                  }
                              }
                              else
                              {
                                  while(u8DDC_Length--)
                                  {
                                       msRegs[REG_06F3]= dpNullMsg[g_ucDDC_TxRecord++];
                                       msRegs[REG_06F2 ] = BIT0;
                                          while( ! (((msRegs[REG_06F2])&BIT2)))               // Wait
                                        {}
                                        msRegs[REG_06F1 ] = BIT1;                                    // Clear   
              
                                        
                                  }
                              }
                          }
              
                      }
                      //===============//<write>PC Write Command============================
                      else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x04)    //DP Rx
                                     {
                              if (u8DDC_Length)
                              {
                                  if (!u8DDC_RxOnGoing)
                                  {
                                      BYTE xdata temp;
                                      msRegs[REG_06F0]= msRegs[REG_06F0]|_BIT0;
                                       while( ! (((msRegs[REG_06F0])&BIT2)))          // Wait
                                        {}
                                       msRegs[REG_06F0 ] = BIT1;                                     // Clear
                                      temp=msRegs[REG_0675];
                                      rxIndex=0;
                                      u8DDC_RxOnGoing=TRUE;
                                      u8DDC_Length--;
                                  }
                                  while(u8DDC_Length--)
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 25  

                                  {
                                       BYTE xdata temp1=10;
                                          msRegs[REG_06F0]= msRegs[REG_06F0]|_BIT0;
                                          while( ! (((msRegs[REG_06F0])&BIT2)))               // Wait
                                           {}
                                           msRegs[REG_06F0 ] = BIT1;  
                                          DDCBuffer[rxIndex++] = msRegs[REG_0675];
                                          //DDCData[rxIndex++] = msRegs[REG_0675];
                                  }
                              }
              
                              if (u8AUXCH_RxCmd==0x00)
                              {
                                  u8DDC_RxOnGoing=FALSE;
                                  g_ucDDC_TxRecord=0;
                                  rxStatus = DDC2B_COMPLETED;
                                  txLength=0;
                              }
              
                      }
                              msRegs[REG_0679 + Aux]= msRegs[REG_0679 + Aux]|_BIT7;//Clear Interrupt
                              msRegs[REG_0679 + Aux]= 0x00;
              
                      #undef u8DDC_RxOnGoing
              
              
              }
              
              void msDP_DDC2BI(void)
              {
                   if(msRegs[REG_0678 + Aux]&_BIT7)   //MCCS Interrupt
                  {
                      DDC2BI_DP() ;
                  }
              }
              
              
              #else
              void DDC2BI_DP(void)
              {
              
                      BYTE u8AUXCH_RxCmd;
                      BYTE u8DDC_Length;
                      #define u8DDC_RxOnGoing u8DDC_RxRecord
              
                      u8AUXCH_RxCmd = msRegs[REG_1FF4];
                      u8DDC_Length = msRegs[REG_1FF6];
                      //===============//<write>PC Read Command============================
                       if(u8AUXCH_RxCmd & _BIT4)    //DP Tx
                      {
                          if (u8DDC_Length)
                          {
                              if(rxStatus == DDC2B_CLEAR && txLength)
                              {
                                  while(u8DDC_Length-- && txLength)
                                  {
                                      if(g_ucDDC_TxRecord)
                                      {
                                          msRegs[REG_1FF9]=DDCBuffer[g_ucDDC_TxRecord-1];
                                          txLength--;
                                      }
                                      else
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 26  

                                          msRegs[REG_1FF9]=DDC2B_DEST_ADDRESS;
                                          g_ucDDC_TxRecord++;
                                  }
                              }
                              else
                              {
                                  while(u8DDC_Length--)
                                  {
                                      msRegs[REG_1FF9]= dpNullMsg[g_ucDDC_TxRecord++];
                                  }
                              }
                          }
                      }
                       
                      //===============//<write>PC Read Command============================
                      else if(u8AUXCH_RxCmd==0x00 || u8AUXCH_RxCmd==0x40)    //DP Rx
                      {
                              if (u8DDC_Length)
                              {
                                  if (!u8DDC_RxOnGoing)
                                  {
                                      BYTE xdata temp;
                                      msRegs[REG_1FFA]= msRegs[REG_1FFA]|_BIT2;
                                      temp=msRegs[REG_1FF8];
                                      rxIndex=0;
                                      u8DDC_RxOnGoing=TRUE;
                                      u8DDC_Length--;
                                  }
                                  while(u8DDC_Length--)
                                  {
                                       BYTE xdata temp1=10;
                                      msRegs[REG_1FFA]= msRegs[REG_1FFA]|_BIT2;
                                          while(temp1--){};
                                          temp1=10;
                                      DDCBuffer[rxIndex++] = msRegs[REG_1FF8];
                                          //DDCBuffer_Temp[rxIndex++]= msRegs[REG_1FF8];
                                  }
                              }
              
                              if (u8AUXCH_RxCmd==0x00)
                              {
                                  u8DDC_RxOnGoing=FALSE;
                                  g_ucDDC_TxRecord=0;
                                  rxStatus = DDC2B_COMPLETED;
                                  txLength=0;
                              }
              
                      }
                              msRegs[REG_1FEA]=msRegs[REG_1FEA]|_BIT7;//Clear Interrupt
                              msRegs[REG_1FFA]= 0x00;
              
                      #undef u8DDC_RxOnGoing
              
              
              }
              void msDP_DDC2BI(void)
              {
                  if(msRegs[REG_1FE6]&_BIT7)   //MCCS Interrupt
                  {
                      DDC2BI_DP() ;
                              
                  }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 27  

              }
              #endif
              #endif
              #endif
1599          #if ENABLE_DeltaE
              
              /////////////////////////////////////////////////////////////////////
              // 
              // AUTO-GAMMA
              /////////////////////////////////////////////////////////////////////
              ////Auto-Gamma Varible Declaration///////////
              BYTE BackupOutDE_L; 
              BYTE BackupOutDE_H; 
              BYTE g_CheckSumResult;
              CSTransferSettingType xdata g_CS_Setting[2];
              BYTE xdata bToolWriteGamma=0;
              
              WORD xdata u16ChkSum_Addr = 0;
              code BYTE* tAllFGamma3x3Matrix[2] =
              {
                   g_CS_Setting[0].CM,  
                   g_CS_Setting[1].CM,  
              };
              
              code BYTE tSRGB_CM[18] = { 0xfb, 0x03, 0x12, 0x00, 0xdf, 0x1f,
                                                                 0xfa, 0x1f, 0xd0, 0x03, 0x30, 0x00,
                                                                 0x05, 0x00, 0x53, 0x00, 0xa7, 0x03,};
              
              code BYTE tAdobe_CM[18] = {0x62,0x03,0x0B,0x00,0x08,0x00,0x16,0x00,0x39,0x03,0x10,0x00,0x0D,0x00,
                                                            0x02,0x00,0xF0,0x03,};
              
              
               void msWriteFGammaTbl(BOOL bWindow)
              {
              #if ENABLE_USE_NewDeltaE
               XDATA BYTE ucTrigger,j ;
                  //XDATA BYTE wLevel;
                  XDATA WORD wData[2],k;
                  XDATA BYTE i;
                  XDATA BYTE ucBank, *ucTab1;
                  ucBank = scReadByte( 0 );
                  msWriteByte(SC0_00, 0x0E);
                  if(bWindow)
                      msWriteBit(SCE_22, 0, _BIT0);
                  else
                      msWriteBit(SCE_02, 0, _BIT0);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllFrontEndGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_C0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_C2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 28  

                              msWriteByteMask(SCE_C2, 0 , BIT4);
                      /*
                              // From level 0 ~ 255
                              for( i = 0;i <128; i++ )
                              {
                              // Cal data
                                      for( wLevel =0;wLevel<2;wLevel++)
                                      {
                                              if(wLevel ==1)
                                                  wData = (((WORD)ucTab1[i*3+2]) <<4 |((ucTab1[i*3]&0xF0)>>4));
                                              else
                                                  wData = (((WORD)ucTab1[i*3+1]) <<4 |(ucTab1[i*3]&0x0F));
                                              // Write gamma data;
                                              printData(" %x  ", wData);
                                              scWrite2Byte(SCE_C4, wData);//msWriteWord( SCE_C5, wData ); //scWriteWord(SCE_C5, wData);
                                      }
                              }
                      */
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = ucTab1[k] | ((ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = ucTab1[k+1] | ((ucTab1[k+2]&0xF0)<<4) ;
              
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_C4, wData[i]);
                          }
                      }
              
              
                          msWriteByteMask(SCE_C2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
                  scWriteByte( 0, ucBank );
              #else
                  XDATA BYTE ucTrigger,j ;
                  //XDATA BYTE wLevel;
                  XDATA WORD wData[2],k;
                  XDATA BYTE i;
                  XDATA BYTE  *ucTab1;
              
                  if(bWindow)
                      msWriteByteMask(SCE_22, 0, _BIT0);
                  else
                      msWriteByteMask(SCE_02, 0, _BIT0);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllFrontEndGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_C0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_C2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_C2, 0 , BIT4);
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 29  

                    
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = (WORD)ucTab1[k] | ((WORD)(ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = (WORD)ucTab1[k+1] | ((WORD)(ucTab1[k+2]&0xF0)<<4) ;
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_C4, wData[i]);
                          }
                      }        
                          msWriteByteMask(SCE_C2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
              #endif
              }
              
              void msWriteFixGammaTbl(BOOL bWindow)
              {
              #if ENABLE_USE_NewDeltaE
                XDATA BYTE ucTrigger,j,i ;
                  XDATA WORD wData[2],k;
                  XDATA BYTE ucBank, *ucTab1;
                  ucBank = scReadByte( 0 );
                  msWriteByte(SC0_00, 0x0E);
                  if(bWindow)
                      msWriteBit(SCE_22, 0, _BIT2);
                  else
                      msWriteBit(SCE_02, 0, _BIT2);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllxvYccFixGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_E0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_E2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_E2, 0 , BIT4);
                      /*
                      for( k = 0;k <512; k=k+2 )
                      {
                          wData = (WORD)(ucTab1[k+1] << 8)| ucTab1[k] ;
                          //printData(" %x  ", wData);
                          scWrite2Byte(SCE_E4, wData);
                      }
                      */
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = ucTab1[k] | ((ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = ucTab1[k+1] | ((ucTab1[k+2]&0xF0)<<4) ;
              
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_E4, wData[i]);
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 30  

                          }
                      }
                          msWriteByteMask(SCE_E2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
                      }
                  scWriteByte( 0, ucBank );
              #else
                  XDATA BYTE ucTrigger,j,i ;
                  XDATA WORD wData[2],k;
                  XDATA BYTE  *ucTab1; 
              
                  if(bWindow)
                      msWriteByteMask(SCE_22, 0, _BIT2);
                  else
                      msWriteByteMask(SCE_02, 0, _BIT2);
              
                      for(j = 0 ; j < 3; j++)
                      {
                              ucTab1 = tAllxvYccFixGammaTab[0];
                              if(j == 0)      // R
                                  ucTrigger = 0;
                              else if(j == 1) // G
                                  ucTrigger = _BIT2;
                              else if(j == 2) // B
                                  ucTrigger = _BIT3;
                              else if(j == 3) // R/G/B
                                  ucTrigger = _BIT2|_BIT3;
              
                              msWrite2Byte(SCE_E0, 0x00);//LUT table R/W address
                              msWriteByteMask(SCE_E2, _BIT1|_BIT0|ucTrigger , _BIT0|_BIT1|_BIT2|_BIT3); // wrtie enable, ise burst wri
             -te
                              msWriteByteMask(SCE_E2, 0 , BIT4);
              
                      for( k = 0;k <384; k=k+3 )
                      {
                          wData[0] = (WORD)ucTab1[k] | ((WORD)(ucTab1[k+2]&0x0F)<<8) ;
                          wData[1] = (WORD)ucTab1[k+1] | ((WORD)(ucTab1[k+2]&0xF0)<<4) ;
                          //wData[0] = 0;
                           //wData[1] = 0;
                          for(i = 0; i < 2 ; i++)
                          {
                              //printData(" %x  ", wData[i]);
                              msWrite2Byte(SCE_E4, wData[i]);
                          }
                      }
                          msWriteByteMask(SCE_E2, 0x00, BIT1 | BIT0); //msWriteByteMask(SC25_F0, 0x00, 0xC0);
              
                      }
              #endif
              }
              
              void msWriteFGammaCM(BYTE bWindow, BYTE idxGamma)
              {
                  XDATA BYTE idx;
                  XDATA WORD ucAddr;
                  XDATA BYTE* pcTab;
              
                  if( bWindow == 0 )
                  {
                      ucAddr = SCE_04 ;
                  }
                  else
                  {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 31  

                      ucAddr = SCE_24;
                  }
              
                  pcTab =  tAllFGamma3x3Matrix[idxGamma];
              
                  for (idx = 0; idx < 18; idx++)
                      {
                      msWriteByte( ucAddr + idx, pcTab[idx]);
                       //printData("w-cm %x  ", pcTab[idx]);  
                  }
                  
              }
              
              void LoadPostGamma(BYTE GmaTblSize)
              {
                  XDATA WORD i, BaseAddr,  GammaTbl[4], DiffValue0, DiffValue1 ,SumValue , wRGBGamAddStart = 0 ;
                  XDATA BYTE NvrValue, j , ucTrigger, ChannelIndex = 0;
              
                  //BaseAddr = AddrOfPostGamma;
                  BaseAddr = BGammaTblAddr;
                  msWrite2Byte(SC8_20, 0x00);
                  msWriteByteMask( SC8_22, 0x03,BIT1|BIT0);// Main Window
               
                  for(ChannelIndex= 0 ; ChannelIndex < 3;ChannelIndex++)
                  {
                      switch(ChannelIndex){
                           case 0:{ucTrigger = 0;}break;
                           case 1:{ucTrigger = _BIT2;}break;
                           case 2:{ucTrigger =_BIT3;}break;
                      }              
                       wRGBGamAddStart = (WORD)GmaTblSize * ChannelIndex ;
                       msWriteByteMask( SC8_22, ucTrigger , BIT2|BIT3);
              
                       for(j=0; j<4; j++)
                          GammaTbl[j] = 0;
              
                       SumValue = 0;
              
                       for (i=0; i < GmaTblSize; i++)
                       {   
                           NvrValue = 0;
                           NVRam_ReadByte(BaseAddr + wRGBGamAddStart + i, &NvrValue);   
                                       
                          DiffValue1 = NvrValue & 0x0F;       
                          DiffValue0 = (NvrValue & 0xF0) >>4;
                          if(i==0)
                              GammaTbl[0] = 0;
                          else
                          {
                              GammaTbl[0] = GammaTbl[3] ;       
                              GammaTbl[0] = GammaTbl[0] + DiffValue0 ; 
                          }
                          GammaTbl[1] = GammaTbl[0] + DiffValue0 ;  
                          GammaTbl[2] = GammaTbl[1] + DiffValue1 ;
                          GammaTbl[3] = GammaTbl[2] + DiffValue1 ;
                          for(j=0; j<4; j++)
                          {
                              if(GammaTbl[j] > 1023)
                                  GammaTbl[j] = 1023;
                              //printData(" GammaTbl=  %x", GammaTbl[j]);
                             msWrite2Byte(SC8_24, GammaTbl[j]);
                          }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 32  

                         
                      }
                  }
                  msWriteByteMask( SC8_22, 0, BIT1 | BIT0 );
              }
              
              #if 0
              void ReadSrgbDefaultValue(int CMIndex)//Hans120316
              {
                  XDATA BYTE j,idx,chkSum =0 ;
              
                      for(j=0;j<18;j++)
                      {
                          if(CMIndex == 0)
                          {
                              g_CS_Setting[0].CM[j] = tSRGB_CM[j];
                              chkSum ^= tSRGB_CM[j];
                          }
                          else
                          {
                              g_CS_Setting[1].CM[j] = tAdobe_CM[j];
                              chkSum ^= tAdobe_CM[j];
                          }
                      }
              
                  //if(CMIndex)
                  //    NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR+1, chkSum);
                  //else
                  //    NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR, chkSum);
              
                  for(idx = 0 ; idx < 18 ;idx++)
                    NVRam_WriteByte( (RM_COLORSPACE_TRANS_BASEADDR + idx) + (sizeof(CSTransferSettingType)*CMIndex), g_C
             -S_Setting[CMIndex].CM[idx]  );
              
              }
              #endif
              
              void LoadDeltaEColorMode(BOOL bWindow, BYTE ModeIndex, BOOL Enable)//Hans 120223 need modify
              {
                  XDATA BYTE idx; 
                  msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamma disable.
                  msWriteByteMask(SC8_3F, 0, _BIT7); 
                  
                  // disable noise masking
                  msWriteByte(SC7_D0, 0);
                  msWriteByte(SC7_D2, 0);
                  
                  if(Enable)
                  {
                      //DeGamma
                      msWriteFGammaTbl(bWindow);
                      //Color Matrix
                      for(idx = 0 ; idx < 18 ;idx++)
                          {
                            NVRam_ReadByte((RM_COLORSPACE_TRANS_BASEADDR + idx)+ (sizeof(CSTransferSettingType)*ModeInde
             -x), &g_CS_Setting[ModeIndex].CM[idx]);
                           // printData("NVRAM value ==>%x",g_CS_Setting[ModeIndex].CM[idx]  );
                          }
                      
                      msWriteFGammaCM(bWindow, ModeIndex);
                      //FixGamma
                      msWriteFixGammaTbl(bWindow); //Hans120412
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 33  

                      //Post Gamma
                     //LoadPostGamma(bWindow,1, BGammaTblAddr,BGammaTblAddr1, GammaTblSize);
                     msWriteByteMask(SCE_02,  _BIT2|_BIT1 | _BIT0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-g
             -amma enable.  
                       msWriteByteMask(SC8_3F, _BIT7, _BIT7);
                   
                   drvGammaOnOff(_DISABLE, MAIN_WINDOW );
                   drvGammaOnOff(_DISABLE, SUB_WINDOW );
                   mStar_WaitForDataBlanking();
                   LoadPostGamma(GammaTblSize);
                   Delay1ms(50);
                   //mStar_WaitForDataBlanking();
                   drvGammaOnOff(_ENABLE, MAIN_WINDOW );
                   drvGammaOnOff(_ENABLE, SUB_WINDOW );
                      
                      //AUTOGAMMA_PUTSTR("\r\n Load DE color table");
                  }
              }
              
              #endif
1980          //===================================================
1981          #ifdef UseVGACableReadWriteAllPortsEDID
              typedef enum
              {
                  VGA1_EDID_DDC2BI = BIT7,
                  DVI1_EDID_DDC2BI = BIT5,
                  HDMI1_EDID_DDC2BI = BIT3,
                  HDMI2_EDID_DDC2BI = BIT2,
                  DP1_EDID_DDC2BI = BIT1,
                  MHL_EDID_DDC2BI = BIT5,
                  HDMI1_EDID20_EDID_DDC2BI = BIT7,
                  HDMI2_EDID20_EDID_DDC2BI = BIT6,
                      #if 0//OSD_ENABLE_FREESYNC
                      VCP_TPV_PORT_DP1_SECOND = BIT2,
                      #endif
              
              } drvFactoryInputPortEDID;
              
              WORD appFactorySetEdidWriteStart( BYTE ucControl )
              {
                  BYTE xdata ucInputEDID_High, ucInputEDID_Low;
                  ucInputEDID_High = 0x00;
                  ucInputEDID_Low  = 0x00;
                  //Monitor Feedback: 6f 6e 83 02 EDIDPort Status chksum
                  //Return Input Types Information
                  //
              #if ENABLE_VGA  
                              ucInputEDID_High|=VGA1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_DVI        
                      ucInputEDID_High|=DVI1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_HDMI       
                      ucInputEDID_High|=HDMI1_EDID_DDC2BI;
              #endif
                  
              #if ENABLE_HDMI2  
                      ucInputEDID_High|=HDMI2_EDID_DDC2BI;
              #endif
                  
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 34  

                  
              #if ENABLE_DP_INPUT         
                      ucInputEDID_High|=DP1_EDID_DDC2BI;
              #endif
                  
                  
              
              
              
                     
              
              
                  
                  //BIT0=0,EDID Saved in EEPRom;BIT0=1,EDID Saved in Flash
                  //BIT1:(0:Write Disable;1:Write Enable)
                  if( ucControl == 0x01 )
                  {
                      //hw_ClrBlacklit();
                      //SET_FACTORY_MODE_FLAG();
                    //  hw_ClrDDC_WP();
                      //Set_WriteEnableFlag();
                      ucInputEDID_Low = ucInputEDID_Low | BIT1;
              
                  }
                  else
                  {
                      //CLR_FACTORY_MODE_FLAG();
                      hw_SetDDC_WP();
                      //Clr_WriteEnableFlag();
                      //SET_DFM_LOADEDIDKEY_FLAG();
                      #if  0//!USER_PREF_EDID_USEFLASH         
                      ReadNVRAMBlock(ADDR_EDID_BLOCK, CNT_EDID_BLOCK);
                      #endif 
                      //LoadAligmentEDID();
                      ucInputEDID_Low = ucInputEDID_Low & ~(BIT1);
                  }
              
                  return (( WORD )ucInputEDID_High << 8 | ucInputEDID_Low );
              }
              #endif
2062          
2063          #if Enabe_DDCCI_FUNCTION
2064          
2065          BYTE AlignControl(void)
2066          {
2067   1          BYTE CommandCode, CPCode, ValueL, RetValueH, RetValueL, PageValue;
2068   1          BYTE TPValue;
2069   1          WORD WordValue, ValueH;
2070   1              WORD XDATA g_wFDCRCValue = 0;
2071   1          #if DDCCI_ENABLE
2072   1              WORD WordAddr;
2073   1          #endif
2074   1      #if JRY_Color_Tool_Functing
2075   1          BYTE  XDATA Resault;
2076   1       #endif
2077   1          CommandCode = DDCBuffer[1];
2078   1          PageValue = 0;
2079   1      
2080   1              if( (MenuPageIndex != BurninMenu)
2081   1                &&(MenuPageIndex != UnsupportedModeMenu)
2082   1                &&(MenuPageIndex != LogoMenu))
2083   1              {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 35  

2084   2                  #if ENABLE_FREESYNC
                         #if FreeSyncMenu_Enable
                         if((MenuPageIndex == FreeSyncMenu))//||(MenuPageIndex == SFreesyncMenu))
                              Set_OSDFreeSyncActionFlag();
                         else
                       #endif
                   #endif                             
2091   2                {
2092   3           #if ENABLE_FREESYNC                
                       if(MenuPageIndex != InputInfoMenu)
                   #endif             
2095   3                 {
2096   4                      Osd_Hide(); //20151211 for TPV Request
2097   4                      MenuPageIndex=RootMenu;
2098   4                      MenuItemIndex=0;        
2099   4                      Set_LoadOSDDataFlag();
2100   4                 }
2101   3                }
2102   2              /*      Osd_Hide(); //20151211 for TPV Request
2103   2                      MenuPageIndex=RootMenu;
2104   2                      MenuItemIndex=0;        */      
2105   2              }
2106   1      
2107   1          #if DDCCI_ENABLE
2108   1              if (!DDCciFlag)
2109   1              //We can adjust the W/B By DDC2BI When DDCCI Is Disable
2110   1          #endif //When DDCCI_ENABLE=0,we use below to disable DDCCI and Use it to adjust W/B
2111   1          {
2112   2              if (CommandCode == SETVCPFeature || CommandCode == GETVCPFeature)
2113   2              {
2114   3                  CPCode = DDCBuffer[2];
2115   3                  if (CPCode != 0xFE)
2116   3                      return FALSE;
2117   3              }
2118   2              else
2119   2                  return FALSE;
2120   2          }
2121   1          #if DDCCI_ENABLE_DEBUG
              
                      Osd_Show();
                      Osd_Draw4Num(15,0,DDCBuffer[1]);
                      Osd_Draw4Num(15,1,DDCBuffer[2]);
                      Osd_Draw4Num(15,2,DDCBuffer[3]);
                      Osd_Draw4Num(15,3,DDCBuffer[4]);
                      Osd_Draw4Num(15,4,DDCBuffer[5]);
                      //Delay1ms(1000);
                  #endif
2131   1      
2132   1          //111----------------------------------------------------------Start
2133   1          if (CommandCode == SETVCPFeature)
2134   1          // 1-1
2135   1          {
2136   2              CPCode = DDCBuffer[2];
2137   2              RetValueH = DDCBuffer[3];
2138   2              RetValueL = DDCBuffer[4];
2139   2              WordValue = ((WORD)DDCBuffer[3] << 8) | ((WORD)DDCBuffer[4]);
2140   2      #if 0//def WH_REQUEST //20120904
                                              if((MenuPageIndex >= MainMenu && MenuPageIndex <= InputInfoMenu)
                                                      )
                                              {
                                                      {
                                                              ClrOSDWindosw(SUB_WIN_00);
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 36  

                                                              ClrOSDWindosw(SUB_WIN_01);
                                                              ClrOSDWindosw(SUB_WIN_02);
                                                              ClrOSDWindosw(SUB_WIN_03);
                                                              MenuPageIndex=RootMenu;
                                                              MenuItemIndex=0;
                                                              Osd_Hide();
                                                      }
                                              }
              #endif
2155   2          }
2156   1          else if (CommandCode == GETVCPFeature)
2157   1          // 1-2
2158   1          {
2159   2              CPCode = DDCBuffer[2];
2160   2          }
2161   1          else if (CommandCode == ModeChangeRequest)
2162   1          // 1-3 xx
2163   1          {
2164   2              CPCode = DDCBuffer[2];
2165   2              ValueH = DDCBuffer[3];
2166   2          }
2167   1          else if (CommandCode == GETPagedVCP)
2168   1          // 1-4
2169   1          {
2170   2              PageValue = DDCBuffer[2];
2171   2              CPCode = DDCBuffer[3];
2172   2          }
2173   1          else if (CommandCode == SETPagedVCP)
2174   1          // 1-5
2175   1          {
2176   2              PageValue = DDCBuffer[2];
2177   2              CPCode = DDCBuffer[3];
2178   2              RetValueH = DDCBuffer[4];
2179   2              RetValueL = DDCBuffer[5];
2180   2              WordValue = ((WORD)DDCBuffer[4] << 8) | ((WORD)DDCBuffer[5]);
2181   2          }
2182   1          #if DDCCI_ENABLE
2183   1              else if (CommandCode == CapabilitiesRequest)
2184   1              // 1-6
2185   1              {
2186   2                  RetValueH = DDCBuffer[2];
2187   2                  RetValueL = DDCBuffer[3];
2188   2                  WordAddr = ((WORD)DDCBuffer[2] << 8) | ((WORD)DDCBuffer[3]);
2189   2                  #if Dual
2190   2              if( CURRENT_INPUT_IS_TMDS()//SrcInputType == Input_Digital || SrcInputType == Input_Digital2
2191   2      #if ENABLE_DP_INPUT
                              || CURRENT_INPUT_IS_DISPLAYPORT()
              #endif  
2194   2                              )
2195   2                          WordValue = sizeof(DVI_CAP_VCP);
2196   2                      else
2197   2                  #endif
2198   2                      WordValue = sizeof(CAP_VCP);
2199   2                  if (WordAddr >= WordValue)
2200   2                  {
2201   3                      DDCBuffer[0] = 0x83;
2202   3                      DDCBuffer[1] = 0xE3;
2203   3                      return 3;
2204   3                  }
2205   2                  #define CapLen CPCode
2206   2                  CapLen = (WordAddr + 32 >= WordValue) ? (WordValue - WordAddr): 32;
2207   2                  DDCBuffer[0] = CapLen + 3+0x80;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 37  

2208   2                  DDCBuffer[1] = 0xE3;
2209   2                  DDCBuffer[2] = RetValueH;
2210   2                  DDCBuffer[3] = RetValueL;
2211   2                  for (ValueL = 4; ValueL < CapLen + 4; ValueL++)
2212   2                  {
2213   3                      #if Dual
2214   3                  if( CURRENT_INPUT_IS_TMDS()//SrcInputType == Input_Digital || SrcInputType == Input_Digital2 
2215   3                      #if ENABLE_DP_INPUT
                              || CURRENT_INPUT_IS_DISPLAYPORT()//SrcInputType == Input_Displayport
                              #endif  
2218   3                      )
2219   3                              DDCBuffer[ValueL] = DVI_CAP_VCP[WordAddr + ValueL - 4];
2220   3                          else
2221   3                      #endif
2222   3                          DDCBuffer[ValueL] = CAP_VCP[WordAddr + ValueL - 4];
2223   3                  }
2224   2                  #undef CapLen
2225   2                  return DDCBuffer[0] &~0x80;
2226   2              }
2227   1          #endif
2228   1          else if (CommandCode == EnableApp)
2229   1          // 1-7 xx
2230   1          {
2231   2              DDCBuffer[0] = 0x80;
2232   2              return 0; //0xFE;
2233   2          }
2234   1          else if (CommandCode == AppTest)
2235   1          // 1-8 xx
2236   1          {
2237   2              DDCBuffer[0] = 0x80;
2238   2              return 0; //0xFD;
2239   2          }
2240   1      #if ENABLE_DeltaE
              
              //*******************************************************************************************
              //MSTART COMMAND***************************************************************************
              //*******************************************************************************************
                      else if ( CommandCode == MStar_Command )
                      {
                               switch(DDCBuffer[2]){
                                      case MS_ColorEngine_OnOff : {
                                       if ( DDCBuffer[3] == 0x00 ){ 
                                                       bToolWriteGamma=1;
                                        //Color Engine Off
                                       msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);      // fix-gamma/color-matrix/de-gamma disable.
                                              msWriteByteMask(SC8_3F, 0, _BIT7);                                                       
                                              }else{                            
                                                      bToolWriteGamma=0;
                                       msWriteByteMask(SCE_02,  _BIT2|_BIT1 | _BIT0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamm
             -a enable.  
                                              msWriteByteMask(SC8_3F, _BIT7, _BIT7);   
                                              }
                                      }break;
                                      
                               case MS_AutoGamma_OnOff : {
                                       if ( DDCBuffer[3] == 0x00 ){ 
                                        //Off  
                                        msWriteByte( SC0_32, 0x00);
                                        msWriteByte( SC0_1C, BackupOutDE_L);
                                        msWriteByte( SC0_1D, BackupOutDE_H );
                                              }else{                            
                                        //On
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 38  

                                        BackupOutDE_L = msReadByte(SC0_1C); 
                                        BackupOutDE_H = msReadByte(SC0_1D);
                                                        msWriteByte( SC0_32, 0x01);
                                        msWriteByte( SC0_1C,  msReadByte(SC0_18));
                                        msWriteByte( SC0_1D, 0x00 );
                                              }
                                      }break;
              
                               case MS_AutoGamma_SetBGColor : {
                                       msWriteByte( SC0_33, DDCBuffer[3] ); // Set Red frame color
                                              msWriteByte( SC0_34, DDCBuffer[4] ); // Set Green frame color
                                              msWriteByte( SC0_35, DDCBuffer[5] ); // Set Blue frame   color
                                      }break;
                          #if ENABLE_USE_NewDeltaE
                      case MS_GET_MODEL_NAME :
                          {
                              int i=0,model_len = 0;
              
                              while(tool_model_panel_name[model_len])
                                  ++model_len;
                              ++model_len; //for the \0
              
                              DDCBuffer[0] =model_len;
                              for( i = 0 ; i < model_len-1 ; ++i)
                                    DDCBuffer[i+1] = tool_model_panel_name[i];
                              DDCBuffer[model_len] = 0x00;
                              return model_len;
              
                          }
                          break;
                               case MS_WR_PostGamma :
                          {
                                         XDATA WORD addr, j;
                                      XDATA BYTE Sum, cnt, GmaMode, GmaChannel;
                                      XDATA WORD CheckSum_addr=0,WordAddr;
                                      Sum=0;
                                      g_CheckSumResult =0 ;
                          GmaMode = DDCBuffer[3] ; // gamma mode
                          GmaChannel = DDCBuffer[4] ; // gamma channel
                                      cnt = DDCBuffer[5] ; // data size
                                      addr = (WORD)(DDCBuffer[6] << 8 );
                                      addr += DDCBuffer[7]; // start addr-hi, lo
                          if (GmaMode == 0)
                          {
                                      WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                          }
                          #if 0
                          else if (GmaMode == 1)
                          {
                              WordAddr = BGammaTblAddr1 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr1+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr1+GmaChannel*2+1;
                          }
                          else if (GmaMode == 2)
                          {
                              WordAddr = BGammaTblAddr2 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr2+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr2+GmaChannel*2+1;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 39  

                          }
                          else if (GmaMode == 3)
                          {
                              WordAddr = BGammaTblAddr3 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr3+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr3+GmaChannel*2+1;
                          }
                          else if (GmaMode == 4)
                          {
                              WordAddr = BGammaTblAddr4 + GmaChannel*GammaTblSize + addr;
                              if (cnt == 40)
                                  CheckSum_addr=BGammaCheckSumStartAddr4+GmaChannel*2;
                              else if (cnt == 24)
                                  CheckSum_addr=BGammaCheckSumStartAddr4+GmaChannel*2+1;
                          }
                          #endif
                                      for(j=0; j< cnt; j++)
                                      {
                                              Sum ^=  DDCBuffer[8+j] ;   
                                      }
                          //hw_ClrGreenLed();
                          NVRam_WriteTbl(WordAddr, &DDCBuffer[8], cnt);
                          //hw_SetGreenLed();
                          g_CheckSumResult = Sum;
                          NVRam_WriteByte(CheckSum_addr, g_CheckSumResult);
                      }
                          break;
                               
                               case MS_LoadColorMode : {                                              
                                         LoadDeltaEColorMode(MAIN_WINDOW, sRGB_MODE, TRUE); //AdobeRGB_MODE
                               }break;
                               #else
              
                               case MS_WR_PostGamma : {                               
                                         XDATA WORD addr, j;
                                      XDATA BYTE Sum, cnt, GmaMode, GmaChannel;
                                      XDATA WORD CheckSum_addr=0,WordAddr;
              
                                      Sum=0;
                                      g_CheckSumResult =0 ;
                                      GmaMode = DDCBuffer[3] & 0x01; // gamma mode
                                      GmaChannel = DDCBuffer[4] & 0x03 ; // gamma channel
                                      cnt = DDCBuffer[5] ; // data size
                                      addr = (WORD)(DDCBuffer[6] << 8 );
                                      addr += DDCBuffer[7]; // start addr-hi, lo
                                       //msRegs[0x5004]=0x55;
                                      //if(GmaMode == 0)
                                      //{
                                              //WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                                              //if(cnt == 40)
                                                      //CheckSum_addr=BGammaCheckSumStartAddr+GmaChannel*2;
                                              //else if(cnt == 36)//Hans120316
                                                      //CheckSum_addr=BGammaCheckSumStartAddr+GmaChannel*2+1;
                                      //}
                                      //if(GmaMode == 1)
                                      //{
                                              //WordAddr = BGammaTblAddr1 + GmaChannel*GammaTblSize + addr;
                                              //u16ChkSum_Addr = BGammaCheckSumStartAddr10+GmaChannel*2;
              
                                      //}
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 40  

                                      WordAddr = BGammaTblAddr + GmaChannel*GammaTblSize + addr;
                                      for(j=0; j< cnt; j++)
                                      {
                                              Sum ^=  DDCBuffer[8+j] ;   
                                NVRam_WriteByte(WordAddr + j, DDCBuffer[8+j]);                
                                      }
                                              
                                      //NVRam_WriteTbl(WordAddr, &DDCBuffer[8], cnt);
                      
                                      g_CheckSumResult ^= Sum;
                                      //NVRam_WriteByte(u16ChkSum_Addr, g_CheckSumResult);
                               }break;
                               
                               case MS_LoadColorMode : {                                              
                                         LoadDeltaEColorMode(MAIN_WINDOW, AdobeRGB_MODE, TRUE);                  
                               }break;
                              #endif
                                       case MS_LoadPostGamma : {                                              
                                         LoadPostGamma(GammaTblSize);
                               }break;
                                       
                               case MS_WR_ColorMatrix : { 
                                 BYTE  cnt, type,i;
                                      cnt = DDCBuffer[4];
                                      type = DDCBuffer[3];
                                      g_CheckSumResult = 0;
                               for(i = 0 ; i < 18 ; i++)
                                      {
                                              //tAllFGamma3x3Matrix[type][i] = DDCBuffer[5+i];
                                              g_CS_Setting[type].CM[i] = DDCBuffer[5+i];
                                              g_CheckSumResult ^= DDCBuffer[5+i];
                                              NVRam_WriteByte( (RM_COLORSPACE_TRANS_BASEADDR + i) + (sizeof(CSTransferSettingType)*type), g_CS_Setti
             -ng[type].CM[i]);
                                      }
                                      //if(type)
                                      //        NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR+1, g_CheckSumResult);
                                      //else
                                      //        NVRam_WriteByte(RM_COLORSPACE_TRANS_ChkSum_ADDR, g_CheckSumResult);             
                               }break;
                               
                               case MS_Read_ACK : {
                                              DDCBuffer[0] = 0x81;
                                DDCBuffer[1] =  g_CheckSumResult; 
                                g_CheckSumResult = 0;
                                return 1;
                               }break;
              
                               case MS_WR_BLOCK : {
                                              bToolWriteGamma = DDCBuffer[3] ;
                                      }break;
                       }
                                      
                              
                              
                      }
              #endif
2448   1      
2449   1          else if (CommandCode == GetTimingRequest)
2450   1          // 1-9
2451   1          {
2452   2              DDCBuffer[0] = 0x06;
2453   2              DDCBuffer[1] = 0x4E;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 41  

2454   2              DDCBuffer[2] = SyncPolarity(SrcFlags);
2455   2              if (UnsupportedModeFlag)
2456   2                  DDCBuffer[2] |= 0x80;
2457   2              if (!InputTimingStableFlag)
2458   2                  DDCBuffer[2] |= 0x40;
2459   2              WordValue = HFreq(SrcHPeriod) *10;
2460   2              DDCBuffer[3] = WordValue >> 8;
2461   2              DDCBuffer[4] = WordValue &0x00FF;
2462   2              WordValue = VFreq(WordValue, SrcVTotal);
2463   2              DDCBuffer[5] = WordValue >> 8;
2464   2              DDCBuffer[6] = WordValue &0x00FF;
2465   2              return 6;
2466   2          }
2467   1          if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
2468   1          {
2469   2              SIORxBuffer[0] = DDCBuffer[3];//CmdByte  0xE1
2470   2              SIORxBuffer[1] = DDCBuffer[4];//ExtByte eg:0x11->ECO Mode
2471   2              SIORxBuffer[2] = DDCBuffer[5];
2472   2              SIORxBuffer[3] = DDCBuffer[6];
2473   2              SIORxBuffer[4] = DDCBuffer[7];
2474   2              SIORxBuffer[5] = DDCBuffer[8];
2475   2              SIORxBuffer[6] = DDCBuffer[9];
2476   2              SIORxBuffer[7] = DDCBuffer[10];
2477   2              }
2478   1              else if(CommandCode == SETVCPFeature)
2479   1          {//For I-Menu
2480   2          //S-6Ea-51a-PktLena-Pre1Bytea-Pre2Bytea-CmdBytea-ExtBytea-DATA1a-DATA2a-CHKa-P
2481   2      
2482   2              #ifdef UseVGACableReadWriteAllPortsEDID
                        #if 1  ///yuanzhi 20100428_1 for 单口烧录不通问题.
                        if((DDCBuffer[2]==0xFE&&DDCBuffer[3]==0xEF)
                              ||((DDCBuffer[3]==0xE1)&&(DDCBuffer[4]==0xA2)&&(DDCBuffer[5]==0x01))
                           )// && DDCBuffer[4]==0x20)
                        #else
                        if(DDCBuffer[2]==0xFE&&DDCBuffer[3]==0xEF)// && DDCBuffer[4]==0x20)
                        #endif
                              {
                                ;
                              }
                        else
                      #endif
2495   2              {
2496   3              SIORxBuffer[0] = DDCBuffer[3];//CmdByte  0xE1
2497   3              SIORxBuffer[1] = DDCBuffer[4];//ExtByte eg:0x11->ECO Mode
2498   3              SIORxBuffer[2] = DDCBuffer[5];//DATA1   Value High
2499   3              SIORxBuffer[3] = DDCBuffer[6];//DATA2   Value Low
2500   3              SIORxBuffer[4] = DDCBuffer[7];
2501   3              SIORxBuffer[5] = DDCBuffer[8];
2502   3              SIORxBuffer[6] = DDCBuffer[9];
2503   3              SIORxBuffer[7] = DDCBuffer[10];
2504   3                }
2505   2              }
2506   1          //111----------------------------------------------------------End
2507   1          //GetValue------------------------------------------------------Start
2508   1          if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
2509   1          {
2510   2              //Initial-----------------------Start
2511   2              if (CommandCode == GETVCPFeature)
2512   2              {
2513   3                  if(CPCode==TPV_App_Command)
2514   3                      {
2515   4                      DDCBuffer[0] = 0x88;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 42  

2516   4                      DDCBuffer[1] = 0x02;
2517   4                      DDCBuffer[2] = 0x00;
2518   4                      DDCBuffer[3] = IMenu_Application;
2519   4                      //DDCBuffer[4] = SIORxBuffer[1];//ExtByte
2520   4                      }
2521   3                      #ifdef UseVGACableReadWriteAllPortsEDID
                           else if((CPCode==0xFE)&&(DDCBuffer[3]==0xEF))
                                              {
                                                ;
                                              }
                              #endif
2527   3                  else
2528   3                      {
2529   4                  DDCBuffer[0] = 0x88;
2530   4                  DDCBuffer[1] = 0x02;
2531   4                  DDCBuffer[2] = 0x00;
2532   4                  DDCBuffer[3] = CPCode;
2533   4                  DDCBuffer[4] = 0x01;
2534   4                  ValueH = 0x00;
2535   4                  ValueL = 0xFF;
2536   4                  RetValueH = 0x00;
2537   4                  TPValue = 0x01;
2538   4              }
2539   3              }
2540   2              else
2541   2              {
2542   3                  DDCBuffer[0] = 0x89;
2543   3                  DDCBuffer[1] = 0xC7;
2544   3                  DDCBuffer[2] = 0x00;
2545   3                  DDCBuffer[3] = PageValue;
2546   3                  DDCBuffer[4] = CPCode;
2547   3                  DDCBuffer[5] = 0x01;
2548   3                  ValueH = 0x00;
2549   3                  ValueL = 0xFF;
2550   3                  RetValueH = 0x00;
2551   3                  TPValue = 0x01;
2552   3              }
2553   2              //Initial-----------------------End
2554   2              //Setting---------------------------------Start
2555   2              if (CPCode == NewControl && PageValue == 0)
2556   2              {
2557   3                   /*if(DDCCINewControlFlag)
2558   3                  RetValueL = 2;
2559   3                  else*/
2560   3                  RetValueL = 1;
2561   3                  ValueL = 2;
2562   3              }
2563   2         #if ENABLE_HDMI_DRR_MCCS
                      else if(CPCode == VCP_FREESYNC_MODE)
                      {   
                          TPValue = 0x00;
                          ValueH = 0x00;
                          ValueL = 0x01;
                          RetValueH = 0x00;
                  #if ENABLE_FREESYNC
                          if(UserprefFreeSyncMode)
                              {
                              RetValueL=1;
                              }
                          else
                  #endif
                              {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 43  

                              RetValueL =0;// USER_PREF_FREESYNCMODE;
                              }
                      }
              #endif
2582   2              else if (CPCode == ALL_Reset && PageValue == 0)
2583   2              {
2584   3                  RetValueL = 0;
2585   3                  ValueL = 1;
2586   3              }
2587   2              
2588   2              else if(CPCode == BriCon_Reset && PageValue == 0)   // 2-2
2589   2              {RetValueL = 0;
2590   3              ValueL = 1;
2591   3              }
2592   2              else if (CPCode == Geometry_Reset && PageValue == 0 && SrcInputType < Input_Digital)
2593   2              // 2-2
2594   2              {
2595   3                  RetValueL = 0;
2596   3                  ValueL = 1;
2597   3              }
2598   2              else if (CPCode == Color_Reset && PageValue == 0)
2599   2              // 2-3
2600   2              {
2601   3                  RetValueL = 0;
2602   3                  ValueL = 1;
2603   3              }
2604   2              else if( CPCode == ADJ_Clock && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
2605   2              // 2-4
2606   2              {
2607   3                  RetValueH = 0;
2608   3                  RetValueL = GetClockValue();
2609   3                  ValueH = 0;
2610   3                  ValueL = 100;
2611   3                  TPValue = 0x00;
2612   3              }
2613   2              else if (CPCode == ADJ_Brightness && PageValue == 0)
2614   2              // 2-5
2615   2              {
2616   3                  ValueL = MaxBrightnessValue - MinBrightnessValue;
2617   3                  RetValueL = UserPrefBrightness - MinBrightnessValue;
2618   3                  TPValue = 0x00;
2619   3              }
2620   2              else if (CPCode == ADJ_Contrast && PageValue == 0)
2621   2              // 2-6
2622   2              {
2623   3                  ValueL = ((WORD)(MaxContrastValue - MinContrastValue) *100) / (MaxContrastValue - MinContrastV
             -alue);
2624   3                  RetValueL = ((WORD)(UserPrefContrast - MinContrastValue) *100) / (MaxContrastValue - MinContra
             -stValue); //Benz 2007.4.15   20:32:03100;// UserPrefContrast - MinContrastValue;
2625   3                  TPValue = 0x00;
2626   3              }
2627   2              else if (CPCode == Select_Color_Preset && PageValue == 0)
2628   2              // 2-7
2629   2              {
2630   3                  //Benz 2007.4.15   12:09:45
2631   3                  ValueL = 0x0D; //0x0B
2632   3                  if (UserPrefColorTemp == CTEMP_6500K)
2633   3                      RetValueL = 0x05;
2634   3                              #if CT_sRGB_ENABLE
                          else if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = 0x01;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 44  

                                      #endif
2638   3                              #if CT_7500K_ENABLE
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = 0x04;
                                      #endif
2642   3                  else if (UserPrefColorTemp == CTEMP_9300K)
2643   3                      RetValueL = 0x08;
2644   3                  else if (UserPrefColorTemp == CTEMP_USER)
2645   3                      RetValueL = 0x0B;
2646   3                  TPValue = 0x00;
2647   3              }
2648   2              #if ColorTool_Clear_Time
2649   2              
2650   2              else if(CPCode == GetUserTime&& PageValue == 0)
2651   2              {
2652   3                      #if  Show_BackLightTimeValue
2653   3                              
2654   3                      TPValue = 0x00;
2655   3                      ValueH          =BlacklitTime_H;
2656   3                      ValueL          =0;
2657   3                      RetValueH       =BlacklitTime_M;
2658   3                      RetValueL       =BlacklitTime_S;        
2659   3                      
2660   3                      #endif
2661   3              }
2662   2                      //*/
2663   2              else if(CPCode == CleanUsedTime && PageValue == 0)
2664   2              {
2665   3                      if (PowerOnFlag)
2666   3                              Set_DDCCResetTimeFlag();
2667   3              }
2668   2                      
2669   2              else if(CPCode == AutoColorDDCCI&& PageValue == 0)
2670   2              {
2671   3                      
2672   3                              if(SrcInputType== Input_VGA)
2673   3                              {                       
2674   4                                      Set_DDCCIAutoColorFlag();
2675   4                              }
2676   3              }
2677   2                      
2678   2              #endif
2679   2      
2680   2              else if ((CPCode == ADJ_Red_Gain) && PageValue == 0)
2681   2              // 2-8
2682   2              {
2683   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2684   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefRedColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefRedColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefRedColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefRedColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefRedColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2696   3                      RetValueL =GetRedColorValue();
2697   3                      #endif
2698   3                  TPValue = 0x00;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 45  

2699   3              }
2700   2              else if ((CPCode == ADJ_Green_Gain) && PageValue == 0)
2701   2              // 2-9
2702   2              {
2703   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2704   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefGreenColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefGreenColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefGreenColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefGreenColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefGreenColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2716   3                      RetValueL =GetGreenColorValue();
2717   3                      #endif
2718   3                  TPValue = 0x00;
2719   3              }
2720   2              else if ((CPCode == ADJ_Blue_Gain) && PageValue == 0)
2721   2              // 2-10
2722   2              {
2723   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
2724   3                      #if 0
                          if (UserPrefColorTemp == CTEMP_SRGB)
                              RetValueL = (WORD)(UserPrefBlueColorSRGB - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_USER)
                              RetValueL = (WORD)(UserPrefBlueColorUser - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_6500K)
                              RetValueL = (WORD)(UserPrefBlueColor6500K - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_Normal)
                              RetValueL = (WORD)(UserPrefBlueColorNormal - MinColorValue)*100/MaxColorValue;
                          else if (UserPrefColorTemp == CTEMP_9300K)
                              RetValueL = (WORD)(UserPrefBlueColor9300K - MinColorValue)*100/MaxColorValue;
                              #else
2736   3                      RetValueL =GetBlueColorValue();
2737   3                      #endif
2738   3                  TPValue = 0x00;
2739   3              }
2740   2              else if( CPCode == Auto_Setup && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
2741   2              // 2-11
2742   2              {
2743   3                  RetValueL = 0;
2744   3                  ValueL = 1;
2745   3              }
2746   2              #if !ColorTool_Clear_Time
                      else if( CPCode == Auto_Color && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
                      // 2-11
                      {
                          RetValueL = 0;
                          ValueL = 1;
                      }
                      #endif
2754   2              else if( CPCode == ADJ_HorizontalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < 
             -Input_Digital )
2755   2              // 2-12
2756   2              {
2757   3                      //110527 Modify
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 46  

2758   3                  ValueH = 0; 
2759   3                  ValueL = 100; 
2760   3                  RetValueH = 0;
2761   3                  RetValueL = GetHPositionValue();
2762   3                  TPValue = 0x00;
2763   3              }
2764   2              else if (CPCode == ADJ_VerticalPos && PageValue == 0 && SrcInputType < Input_Digital)
2765   2              // 2-13
2766   2              {
2767   3              #if 0
                          ValueH = (MaxVStart - MinVStart) >> 8;
                          ValueL = (MaxVStart - MinVStart) &0x00FF;
                          RetValueH = (UserPrefVStart - MinVStart) >> 8;
                          RetValueL = (UserPrefVStart - MinVStart) &0x00FF;
                          TPValue = 0x00;
                      #else
2774   3                  RetValueH = 0x00;
2775   3                  RetValueL = GetVPositionValue();
2776   3                  ValueH = 0x0;
2777   3                  ValueL = 100;
2778   3                  TPValue = 0x00;
2779   3              #endif
2780   3              }
2781   2              else if( CPCode == ADJ_Phase && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
2782   2              // 2-14
2783   2              {
2784   3                  RetValueH = 0x00;
2785   3                  RetValueL = GetFocusValue();
2786   3                  ValueH = 0x0;
2787   3                  ValueL = 100;
2788   3                  TPValue = 0x00;
2789   3              }
2790   2              else if (CPCode == Select_InputSource)
2791   2              {
2792   3                  ValueH = 0x00;
2793   3                  ValueL = 0x04;
2794   3                  if(CURRENT_INPUT_IS_VGA())//( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digit
             -al)
2795   3                      RetValueL = 0x01;
2796   3                  else
2797   3                      RetValueH = 0x03;
2798   3                  TPValue = 0x00;
2799   3              }
2800   2              #if AudioFunc
2801   2                  else if (CPCode == ADJ_SpeakerVolume && PageValue == 0)
2802   2                  {
2803   3                      ValueH = 0;
2804   3                      ValueL = 100;
2805   3                      RetValueL = UserPrefVolume;
2806   3                      RetValueH = 0;
2807   3                      TPValue = 0x00;
2808   3                  }
2809   2      
2810   2                  else if (CPCode == AudioMute && PageValue == 0)
2811   2                  {
2812   3                      ValueH = 0;
2813   3                      ValueL = 100;
2814   3                      RetValueL = UserPrefMuteState?1:2;
2815   3                      RetValueH = 0;
2816   3                      TPValue = 0x00;
2817   3                  }                   
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 47  

2818   2              #endif
2819   2              #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL     
                      else if (CPCode == ADJ_Red_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefRedBlackLevel;
                          TPValue = 0;
                      }
                      else if (CPCode == ADJ_Green_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefGreenBlackLevel;
                          TPValue = 0;
                      }
                      else if (CPCode == ADJ_Blue_Blacklevel && PageValue == 0)
                      {
                          ValueH = 0x00;
                          ValueL = 100;
                          RetValueL = UserprefBlueBlackLevel;
                          TPValue = 0;
                      }
                      #endif  
2842   2              else if (CPCode == H_Frequency && PageValue == 0)
2843   2              {
2844   3                  ValueH = 0xFF;
2845   3                  ValueL = 0xFF;
2846   3                  WordValue = HFreq(SrcHPeriod) *10;
2847   3                  RetValueH = WordValue >> 8;
2848   3                  RetValueL = WordValue &0x00ff;
2849   3                  TPValue = 0x01;
2850   3              }
2851   2              else if (CPCode == V_Frequency && PageValue == 0)
2852   2              {
2853   3                  ValueH = 0xFF;
2854   3                  ValueL = 0xFF;
2855   3                  WordValue = HFreq(SrcHPeriod) *10;
2856   3                  WordValue = VFreq(WordValue, SrcVTotal);
2857   3                  RetValueH = WordValue >> 8;
2858   3                  RetValueL = WordValue &0x00ff;
2859   3                  TPValue = 0x01;
2860   3              }
2861   2              else if (CPCode == FlatPanellayout)
2862   2              {
2863   3                  ValueL = 8;
2864   3                  RetValueL = 1;
2865   3              }
2866   2              else if (CPCode == MonitorType && PageValue == 0)
2867   2              // 2-20
2868   2              {
2869   3                  RetValueH = 0;
2870   3                  RetValueL = 3;
2871   3                  ValueH = 0x00;
2872   3                  ValueL = 0x08;
2873   3                  TPValue = 0x00;
2874   3               }
2875   2              else if (CPCode == DisplayControlType)
2876   2              // Jeff add it in 2004~7る13らUと 04:46:32
2877   2              {
2878   3                  ValueH = 0xFF;
2879   3                  ValueL = 0x16;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 48  

2880   3                  RetValueH = 0;
2881   3                  RetValueL = 5; // Mean Mstar
2882   3              }
2883   2              else if (CPCode == FWLevel)
2884   2              {
2885   3                  ValueH = 0xFF;
2886   3                  ValueL = 0xFF;
2887   3                  RetValueL = Version;
2888   3                  RetValueH = Version>>16;
2889   3              }
2890   2      #if Enable_DDCCI_OSDEnable_EN
                      else if (CPCode == OSDEnable)
                      {
                          ValueH = 0x00;
                          ValueL = 0x02;      
                          if(DDCOSDDisEnableFlag)
                              RetValueL=1;  //F/W Version
                          else                
                              RetValueL=2;  //F/W Version
                      }
              #endif          
2901   2              else if (CPCode == ADJ_Language && PageValue == 0)
2902   2              // 2-17
2903   2              {
2904   3                  #if 1
2905   3                      ValueL = LANG_Nums;
2906   3                      if (UserPrefLanguage == LANG_Spanish)
2907   3                      RetValueL = LanSpanishCode;
2908   3                      else if (UserPrefLanguage == LANG_France)
2909   3                      RetValueL = LanFrenchCode;
2910   3                      else if (UserPrefLanguage == LANG_German)
2911   3                      RetValueL = LanGermanCode;
2912   3                      else if (UserPrefLanguage == LANG_Italian)
2913   3                      RetValueL = LanItalianCode;
2914   3                      else if (UserPrefLanguage == LANG_Russia)
2915   3                      RetValueL = LanRussianCode;
2916   3                      else if (UserPrefLanguage == LANG_Swedish)
2917   3                      RetValueL = LanSwedishCode;
2918   3                      else if (UserPrefLanguage == LANG_Polish)
2919   3                      RetValueL = LanPolishCode;                      
2920   3                      else if (UserPrefLanguage == LANG_Czech)
2921   3                      RetValueL = LanCzechCode;
2922   3                      else if (UserPrefLanguage == LANG_Portugues)
2923   3                      RetValueL = LanPortugueseCode_Brazil;
2924   3                      else if (UserPrefLanguage == LANG_SChina)
2925   3                      RetValueL = LanSChineseCode;
2926   3                      else if (UserPrefLanguage == LANG_TChina)
2927   3                      RetValueL = LanTChineseCode;
2928   3                      else if (UserPrefLanguage == LANG_Korea)
2929   3                      RetValueL = LanKoreanCode;
2930   3                      else if (UserPrefLanguage ==LANG_Japan )
2931   3                      RetValueL = LanJapaneseCode;
2932   3                      else if (UserPrefLanguage == LanDutchCode)      //120105 Modify
2933   3                      RetValueL = LANG_Dutch;
2934   3                      else if (UserPrefLanguage == LANG_Finnish)      //120105 Modify
2935   3                      RetValueL = LanFinnishCode;                     
2936   3                      else if (UserPrefLanguage == LANG_English)
2937   3                      RetValueL = LanEnglistCode;                             
2938   3                      RetValueH = 0x00;
2939   3                  #endif
2940   3              }
2941   2              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 49  

2942   2              #if 0//ENABLE_FREESYNC
                      else if (CPCode == VCP_FREESYNC_MODE)
                      {                        
                          //ValueH = 0x00;
                          //ValueL = VCP_FREESYNC_MODE_MAX_VALUE;
              
                          ValueH = 0x00;
                          ValueL = VCP_FREESYNC_MODE_ENABLE;
                          RetValueH = 0x00;
                          RetValueL = VCP_FREESYNC_MODE_ENABLE;
              
                      }
                      #endif  
2955   2              else if (CPCode == VCPVersion && PageValue == 0)
2956   2              {
2957   3                  RetValueL = 1;
2958   3                  RetValueH = 2;
2959   3                  ValueH = 0xFF;
2960   3                  ValueL = 0xFF;
2961   3              }
2962   2                  else if (CPCode == 0xFE)
2963   2                  {
2964   3             if (SIORxBuffer[0]=='R')
2965   3                  {
2966   4                      if (SIORxBuffer[1]=='M' && SIORxBuffer[2]=='N'&&SIORxBuffer[3]=='0')
2967   4                      {
2968   5                          TPValue=SIORxBuffer[3];
2969   5                          ValueH = SIORxBuffer[4];
2970   5                          if(SIORxBuffer[4]>='0'&&SIORxBuffer[4]<='3')
2971   5                          {   
2972   6                              BYTE i;
2973   6                                 i=SIORxBuffer[4]-'0';
2974   6                              ValueL = MODEL_TYPE[3*i];
2975   6                              RetValueH = MODEL_TYPE[3*i+1];
2976   6                              RetValueL = MODEL_TYPE[3*i+2];
2977   6                          }
2978   5                      } 
2979   4               #ifdef ReduceDDC
                              else if((SIORxBuffer[1]=='E' && SIORxBuffer[2]=='D'&&SIORxBuffer[3]=='I'))//'R' 'E'     'D'     'I'     'D'     'W'     'A'     
             -'Y'
                              #ifdef OnlyVGAEDIDInFlash
                              {//'R'  'E'     'D'     'I'     'D'     'V'     'G'     'A'
                                  TPValue='I';
                                  ValueH = 'D';
                                  ValueL = 'V';
                                  RetValueH = 'G';
                                  RetValueL = 'A';
                              }
                              #else
                              {//'R'  'E'     'D'     'I'     'D'     'F'     'L'     'H'
                                  TPValue='I';
                                  ValueH = 'D';
                                  ValueL = 'F';
                                  RetValueH = 'L';
                                  RetValueL = 'H';
                              }
                              #endif
                      #endif 
2999   4              #if HDCPKEY_IN_Flash
3000   4                      else if((SIORxBuffer[1]=='H' && SIORxBuffer[2]=='D'&&SIORxBuffer[3]=='C'))
3001   4                      {
3002   5                          ValueH = TCRCvalue / 256;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 50  

3003   5                          ValueL = TCRCvalue % 256;
3004   5                          RetValueH = 0x88;
3005   5                          RetValueL = 0x02;
3006   5      
3007   5                                      Clr_WriteHDCPcodeFlag();
3008   5                  }
3009   4              #endif 
3010   4              }
3011   3                      #ifdef  UseVGACableReadWriteAllPortsEDID
                                      else if(DDCBuffer[3]==0xEF)//else if(SIORxBuffer[0]==0xEF)
                                      {
                                              BYTE i,Length;
                                              WORD Addr;
              
                                              Length = DDCBuffer[7];
                                              Addr=(DDCBuffer[5]<<8)+DDCBuffer[6];
                                              if((DDCBuffer[4]>=VGA1&&DDCBuffer[4] <=MHL_HDMI2)||(DDCBuffer[4]>=EEPROM&&DDCBuffer[4] <=PanelSettingD
             -evice))        //130614 xiandi
                                              {
                                                      ReadDevice(DDCBuffer[4],  Addr,( BYTE* )&SIORxBuffer,Length);//Read EDID or HDCP KEY
                                                      for(i = 0; i < Length; i++)
                                                      {
                                                              DDCBuffer[i+1] = SIORxBuffer[i];
                                                      }
                                              }
                                              else
                                              {
                                                      ;
                                              }
                                              DDCBuffer[0]= 0x80+Length;
                                              return Length;
                                      }
                              #endif
3035   3                      
3036   3                 #if HDCPKEY_IN_Flash
3037   3                      else if(SIORxBuffer[0]==0xE1 &&  SIORxBuffer[1]==0xE2 &&  SIORxBuffer[2]==0x00 && SIORxBuffer[3]==0x00)
3038   3                      {
3039   4                          ValueH = TCRCvalue / 256;
3040   4                          ValueL = TCRCvalue % 256;
3041   4                          RetValueH = 0x00;
3042   4                          RetValueL = 0x00;
3043   4                                      Clr_WriteHDCPcodeFlag();
3044   4                      }
3045   3              #endif 
3046   3      
3047   3              }
3048   2      /***********************************************Zhifeng.Wu***********************************************/
3049   2              #define I_Menu_Command  SIORxBuffer[1]
3050   2      
3051   2               //For TPV Application
3052   2              else if (CPCode == TPV_App_Command&& PageValue == 0)
3053   2              {
3054   3                      if(SIORxBuffer[0]==IMenu_Application)//For AOC I-Menu Application
3055   3                      {
3056   4                              //For Other Luminance Menu
3057   4                              if(I_Menu_Command==ECO_Mode)
3058   4                              {
3059   5                               RetValueH = 0;
3060   5                               RetValueL = UserPrefECOMode;
3061   5                               ValueH = 0;
3062   5                               ValueL = ECO_Nums-1;
3063   5                              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 51  

3064   4      #if Enable_Gamma
                                      else if(I_Menu_Command==Gamma)
                                      {
                                       RetValueH = 0;
                                       RetValueL = UserPrefGamaMode;
                                       ValueH = 0;
                                       ValueL = GAMA_Nums-1;
                                      }
              #endif                  
3073   4                              else if(I_Menu_Command==DCR)
3074   4                              {
3075   5                               RetValueH = 0;
3076   5                               RetValueL = UserPrefDcrMode;
3077   5                               ValueH = 0;
3078   5                               ValueL = 1;
3079   5                              }
3080   4                              else if(I_Menu_Command==PB_Hue)
3081   4                              {
3082   5                              }
3083   4                              else if(I_Menu_Command==PB_Saturation)
3084   4                              {
3085   5                              }
3086   4                      }
3087   3              }
3088   2              #undef  I_Menu_Command
3089   2      /*******************************************************************************************************/
3090   2              
3091   2              else if ( CPCode == PowerMode )
3092   2              {
3093   3                  ValueL = 4;
3094   3                  if ( !PowerOnFlag )
3095   3                  {
3096   4                      RetValueL = 4;
3097   4                  }
3098   3                  else if ( PowerSavingFlag )
3099   3                  {
3100   4                      RetValueL = 2;
3101   4                  }
3102   3                  else
3103   3                  {
3104   4                      RetValueL = 1;
3105   4                  }
3106   3              }               
3107   2              else
3108   2              {
3109   3                  DDCBuffer[2] = 0x01;
3110   3                  RetValueL = 0x00;
3111   3                  ValueH = 0xFF;
3112   3                  ValueL = 0xFF;
3113   3              }
3114   2              //Setting---------------------------------End
3115   2              //Transmission----------------------------Start
3116   2              if (CommandCode == GETVCPFeature)
3117   2              {
3118   3                  if(CPCode==TPV_App_Command)
3119   3                      {
3120   4                              DDCBuffer[5] = ValueH;
3121   4                              DDCBuffer[6] = ValueL;
3122   4                              DDCBuffer[7] = RetValueH;
3123   4                              DDCBuffer[8] = RetValueL;
3124   4                      }
3125   3                      else
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 52  

3126   3                      {
3127   4                  DDCBuffer[4] = TPValue;
3128   4                  DDCBuffer[5] = ValueH;
3129   4                  DDCBuffer[6] = ValueL;
3130   4                  DDCBuffer[7] = RetValueH;
3131   4                  DDCBuffer[8] = RetValueL;
3132   4                      }
3133   3                  return 8;
3134   3              }
3135   2              else
3136   2              {
3137   3                  DDCBuffer[5] = TPValue;
3138   3                  DDCBuffer[6] = ValueH;
3139   3                  DDCBuffer[7] = ValueL;
3140   3                  DDCBuffer[8] = RetValueH;
3141   3                  DDCBuffer[9] = RetValueL;
3142   3                  return 9;
3143   3              }
3144   2              //Transmission----------------------------End
3145   2          }
3146   1          //GetValue------------------------------------------------------Start
3147   1          //SetValue------------------------------------------------------Start
3148   1          else if (CommandCode == SETVCPFeature || CommandCode == SETPagedVCP)
3149   1          {
3150   2              DDCBuffer[2] = 0x00; // Result Code
3151   2              ValueH = 0x00;
3152   2              ValueL = 0xFF;
3153   2              TPValue = 0x01;
3154   2              if (CPCode == NewControl && PageValue == 0)
3155   2              {
3156   3                  //Clr_DDCCINewControlFlag();
3157   3                  ValueL = 2;
3158   3              }
3159   2              else if (CPCode == ALL_Reset && PageValue == 0)
3160   2              // 3-1
3161   2              {
3162   3                  if (WordValue != 0)
3163   3                  {
3164   4                      Osd_Hide();//petit 20131024 only for I-Menu reset.
3165   4                      ResetAllSetting();
3166   4                      // wait for checking
3167   4                      //msWriteByte(BCR, 0x80);
3168   4                      //msWriteByte(BCG, 0x80);
3169   4                      //msWriteByte(BCB, 0x80);
3170   4                  }
3171   3                  ValueL = 1;
3172   3              }
3173   2              
3174   2              else if(CPCode == BriCon_Reset&& PageValue == 0)   // 3-2
3175   2              { 
3176   3                  if(WordValue != 0 )
3177   3                  {
3178   4                      UserPrefBrightness=DefBrightness;
3179   4                      UserPrefContrast=DefContrast;
3180   4      
3181   4      
3182   4                  
3183   4      
3184   4              mStar_AdjustBrightness( UserPrefBrightness);
3185   4              mStar_AdjustContrast(UserPrefContrast); //120413 Modify
3186   4              }
3187   3              ValueL = 1;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 53  

3188   3              }        
3189   2              else if( CPCode == Geometry_Reset && PageValue == 0 && INPUT_IS_VGA(rxInputPort))   //else if (CPC
             -ode == Geometry_Reset && PageValue == 0 && rxInputPort != Input_Digital)
3190   2              {
3191   3                  if( WordValue != 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Digital )   //if (WordValu
             -e != 0 && SrcInputType != Input_Digital)
3192   3                      ResetGeometry();
3193   3                  ValueL = 1;
3194   3                  TPValue = 0x00;
3195   3              }
3196   2              else if (CPCode == Color_Reset && PageValue == 0)
3197   2              // 3-3
3198   2              {
3199   3                  UserPrefRedColorUser = DefRedColor;
3200   3                  UserPrefGreenColorUser= DefGreenColor;
3201   3                  UserPrefBlueColorUser= DefBlueColor;
3202   3                      #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL     
                          UserprefRedBlackLevel = DefRedBlackLevel;
                          UserprefGreenBlackLevel = DefGreenBlackLevel;
                          UserprefBlueBlackLevel = DefBlueBlackLevel;
                          mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBla
             -ckLevel);
                              #endif
3208   3                  UserPrefColorTemp = CTEMP_Warm1; //CTEMP_9300K 20051115 wmz
3209   3                  if (WordValue != 0)
3210   3                      SetColorTemp();//Setcolortemp();
3211   3                  //Benz 2007.4.15   19:31:44SetColor();
3212   3                  ValueL = 1;
3213   3              }
3214   2              else if( CPCode == ADJ_Clock && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
3215   2              // 3-4
3216   2              {
3217   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3218   3                  {
3219   4                      UserPrefHTotal = ((WordValue *(MaxClock - MinClock) + 50) / 0x64 + MinClock);
3220   4                      drvADC_AdjustHTotal( UserPrefHTotal );                          
3221   4                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3222   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3223   4                      #else
                              NVRam_WriteByte(nvrModeAddr(HTotal), UserPrefHTotal);
                              #endif
3226   4                  }
3227   3                  TPValue = 0x00;
3228   3              }
3229   2              else if (CPCode == ADJ_Brightness && PageValue == 0)
3230   2              // 3-5
3231   2              {       
3232   3                      #if CT_sRGB_ENABLE
                              if((UserPrefECOMode == ECO_Standard)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))      //120609 Modi
             -fy
                              #else
3235   3                      if((UserPrefECOMode == ECO_Standard)&&(!UserPrefDcrMode))       //120609 Modify
3236   3                      #endif
3237   3                      {
3238   4                          UserPrefBrightness = RetValueL + MinBrightnessValue;
3239   4                          mStar_AdjustBrightness(UserPrefBrightness);
3240   4                      
3241   4                      }
3242   3                  ValueL = MaxBrightnessValue - MinBrightnessValue;
3243   3                  TPValue = 0x00;
3244   3              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 54  

3245   2              else if (CPCode == ADJ_Contrast && PageValue == 0)
3246   2              // 3-6
3247   2              {
3248   3                  //Osd_Hide();
3249   3                              #if CT_sRGB_ENABLE
                              if((UserPrefECOMode == ECO_Standard)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))      //1206
             -09 Modify
                                      #else
3252   3                              if((UserPrefECOMode == ECO_Standard)&&(!UserPrefDcrMode))       //120609 Modify
3253   3                              #endif
3254   3                      {
3255   4                          if (RetValueL <= (MaxContrastValue - MinContrastValue))
3256   4                          {
3257   5                              UserPrefContrast = (WORD)(RetValueL *(MaxContrastValue - MinContrastValue)) / 100+MinCont
             -rastValue;
3258   5      
3259   5                              mStar_AdjustContrast(UserPrefContrast);
3260   5                          }
3261   4                      }
3262   3                  ValueL = 100;
3263   3                  TPValue = 0x00;
3264   3              }
3265   2              else if (CPCode == Select_Color_Preset && PageValue == 0)
3266   2              // 3-7
3267   2              {
3268   3      
3269   3                   if (RetValueL == 0x05)
3270   3                      UserPrefColorTemp = CTEMP_6500K;
3271   3                           #if CT_sRGB_ENABLE
                          else if (RetValueL == 0x01)
                              UserPrefColorTemp = CTEMP_SRGB;
                                       #endif
3275   3                              #if CT_7500K_ENABLE
                          else if (RetValueL == 0x04)
                              UserPrefColorTemp = CTEMP_Normal;
                                      #endif
3279   3                  else if (RetValueL == 0x08)
3280   3                      UserPrefColorTemp = CTEMP_9300K;
3281   3                  else if (RetValueL == 0x0B)
3282   3                      UserPrefColorTemp = CTEMP_USER;
3283   3                              #if CT_sRGB_ENABLE
                                      if( UserPrefColorTemp == CTEMP_SRGB )   //121220 Modify
                                      {
                                              if( UserPrefECOMode != ECO_Standard )
                                              {
                                                      UserPrefECOMode = ECO_Standard;
                                              }
              #if Enable_Gamma                                
                                              if( UserPrefGamaMode != GAMA1 )
                                              {
                                                      UserPrefGamaMode = GAMA1;
                                                                              #if Enable_Gamma
                                                      mStar_SetupGamma( GAMA1 );
                                                                              #endif
                                              }
              #endif                          
                                              if(UserPrefDcrMode)
                                              {
                                                      UserPrefDcrMode = 0;
                                                      SetECO();
                                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                                              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 55  

                                      }
                                      #endif
3307   3                      SetColorTemp();//Setcolortemp();
3308   3                  ValueL = 0x0D; //0x0B
3309   3                  TPValue = 0x00;
3310   3              }
3311   2                      
3312   2              else if (CPCode == ADJ_Red_Gain && PageValue == 0)
3313   2              // 3-8
3314   2              {
3315   3                  if (UserPrefColorTemp == CTEMP_USER)
3316   3                  {
3317   4                      UserPrefRedColorUser=UserPrefRedColor = (WORD)RetValueL*( MaxColorValue - MinColorValue )/
             -100 + MinColorValue;          //120215 Modify
3318   4                      mStar_AdjustRedColor(UserPrefRedColor, UserPrefContrast);                                                                                                                       //120215 Modify
3319   4                  }
3320   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3321   3                  TPValue = 0x00;
3322   3              }
3323   2              else if (CPCode == ADJ_Green_Gain && PageValue == 0)
3324   2              // 3-9
3325   2              {
3326   3                  if (UserPrefColorTemp == CTEMP_USER)
3327   3                  {
3328   4                      UserPrefGreenColorUser = UserPrefGreenColor = (WORD)RetValueL*( MaxColorValue - MinColorVa
             -lue )/100 + MinColorValue;            //120215 Modify
3329   4                      mStar_AdjustGreenColor(UserPrefGreenColor, UserPrefContrast);                                                                                                                           //120215 Modi
             -fy
3330   4                  }
3331   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3332   3                  TPValue = 0x00;
3333   3              }
3334   2              else if (CPCode == ADJ_Blue_Gain && PageValue == 0)
3335   2              // 3-10
3336   2              {
3337   3                  if (UserPrefColorTemp == CTEMP_USER)
3338   3                  {
3339   4                      UserPrefBlueColorUser = UserPrefBlueColor = (WORD)RetValueL*( MaxColorValue - MinColorValu
             -e )/100 + MinColorValue;              //120215 Modify
3340   4                      mStar_AdjustBlueColor(UserPrefBlueColor, UserPrefContrast);                                                                                                                             //120215 Modify
3341   4                  }
3342   3                  ValueL = 100;//(MaxColorValue - MinColorValue);
3343   3                  TPValue = 0x00;
3344   3              }
3345   2              else if( CPCode == Auto_Setup && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
3346   2              // 3-11
3347   2              {
3348   3                  if( WordValue != 0 )   //if (WordValue != 0 && SrcInputType != Input_Digital)
3349   3                      AutoConfig();
3350   3                  ValueL = 1;
3351   3              }
3352   2              else if( CPCode == Auto_Color && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_D
             -igital )
3353   2              // 3-12
3354   2              {
3355   3                  if( WordValue != 0 )   //if (WordValue != 0 && SrcInputType != Input_Digital)
3356   3                      mStar_AutoColor();
3357   3                      #if Show_BackLightTimeValue
3358   3                      BlacklitTime_S = 0;
3359   3                      BlacklitTime_M = 0;
3360   3                      BlacklitTime_H = 0;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 56  

3361   3                      MonitorBackLightTime_S=BlacklitTime_S;
3362   3                      MonitorBackLightTime_M= BlacklitTime_M; 
3363   3                      MonitorBackLightTime_H=BlacklitTime_H;  
3364   3                   #if USEFLASH
3365   3                      //SaveMonitorSetting2();                        
3366   3                      UserPref_EnableFlashSaveBit( bFlashForceSaveMonitor2Bit );
3367   3                      //UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3368   3                      #else   
                                 NVRam_WriteByte(NVRAM_ADDR_MointorMember(MonitorFlag), MonitorFlags);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeS), MonitorBackLightTime_S);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeM), MonitorBackLightTime_M);
                                  NVRam_WriteByte(nvrMonitorAddr(BacklighttimeH), MonitorBackLightTime_H);
              
                              #endif
3375   3                    #endif
3376   3      
3377   3                  ValueL = 1;
3378   3              }
3379   2              else if( CPCode == ADJ_HorizontalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < 
             -Input_Digital )
3380   2              // 3-12
3381   2              {
3382   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3383   3                  {
3384   4                      UserPrefHStart = (WORD)(WordValue)*(MaxHStart-MinHStart)/100 + MinHStart;
3385   4                      mStar_AdjustHPosition(UserPrefHStart);
3386   4                                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3387   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3388   4                                      #else
                                              NVRam_WriteByte(nvrModeAddr(HStart), UserPrefHStart);
                                              #endif
3391   4                  }
3392   3                  TPValue = 0x00;
3393   3              }
3394   2              else if( CPCode == ADJ_VerticalPos && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < In
             -put_Digital )
3395   2              // 3-13
3396   2              {
3397   3                          UserPrefVStart = (WORD)WordValue*(MaxVStart-MinVStart)/100 + MinVStart;
3398   3                          mStar_AdjustVPosition(UserPrefVStart);
3399   3                                      
3400   3                      #if USEFLASH //Modify Request TPV FW Sting
3401   3                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3402   3                      #else
                              NVRam_WriteByte(nvrModeAddr(VStart), UserPrefVStart);
                              #endif
3405   3                      TPValue = 0x00;
3406   3              }
3407   2              else if( CPCode == ADJ_Phase && PageValue == 0 && CURRENT_INPUT_IS_VGA())//SrcInputType < Input_Di
             -gital )
3408   2              // 3-14
3409   2              {
3410   3                  //if( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digital)
3411   3                  {
3412   4                                      UserPrefPhase = WordValue*(MAX_PHASE_VALUE+1)/100 + 0.5;
3413   4                                      if(UserPrefPhase>MAX_PHASE_VALUE)
3414   4                                              UserPrefPhase=MAX_PHASE_VALUE;
3415   4                      drvADC_SetPhaseCode( UserPrefPhase );
3416   4                                      
3417   4                      #if USEFLASH //Modify Request TPV FW Sting  20170110
3418   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3419   4                      #else
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 57  

                              NVRam_WriteByte(nvrModeAddr(Phase), UserPrefPhase);
                              #endif
3422   4                  }
3423   3                  TPValue = 0x00;
3424   3              }
3425   2              else if (CPCode == DDCCI_Settings && PageValue == 0 )
3426   2              // 3-14
3427   2              {
3428   3                  if(CURRENT_INPUT_IS_VGA())//( SrcInputType < Input_Digital ) //if (SrcInputType != Input_Digit
             -al)
3429   3                  {
3430   4                      #if USEFLASH
3431   4                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3432   4                      #else
                              SaveModeSetting();
                              #endif
3435   4                  }
3436   3      
3437   3                  #if USEFLASH
3438   3                UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit);
3439   3                  #else
                          SaveMonitorSetting();
                          #endif
3442   3                  
3443   3                  TPValue = 0x00;
3444   3              }
3445   2              else if (CPCode == Select_InputSource && PageValue == 0)
3446   2              {
3447   3                  // Osd_Hide();
3448   3                  if (RetValueL == 0x01 || RetValueL == 0x02)
3449   3                  {
3450   4                     #if ENABLE_VGA_INPUT
3451   4                          ChangeSourceToAnalog();
3452   4                       #endif
3453   4                  }
3454   3                  if (RetValueL == 0x03 || RetValueL == 0x04)
3455   3                  {
3456   4                      #if Dual
3457   4                              #if INPUT_TYPE != INPUT_1A1H && INPUT_TYPE != INPUT_1A1DP
                                  ChangeSourceToDigital();
                                      #endif
3460   4                      #endif
3461   4                  }
3462   3                              #if ENABLE_HDMI //130821 xiandi
3463   3                              if (RetValueL == 0x11)
3464   3                              {
3465   4                                  
3466   4                    #if Dual
3467   4                      #if INPUT_TYPE == INPUT_1A1H1DP //131031 xiandi
                              ChangeSourceToDigital();
                              #else
3470   4                      ChangeSourceToHDMI();
3471   4                      #endif
3472   4                    #endif
3473   4                              }
3474   3                              #endif
3475   3                              #if ENABLE_DP_INPUT     //130821 xiandi
                                      if (RetValueL == 0x0F)
                                      {
                                              ChangeSourceToDP();
                                      }
                                      #endif
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 58  

3481   3                  TPValue = 0x00;
3482   3              }
3483   2              #if AudioFunc
3484   2                  else if (CPCode == ADJ_SpeakerVolume && PageValue == 0)
3485   2                  {
3486   3                      //Osd_Hide();
3487   3                      UserPrefVolume = RetValueL;
3488   3                              if(UserPrefMuteState)
3489   3                           {
3490   4                                 SwitchMute(MIA_DecValue);    // UserPrefMuteState=0;
3491   4                           }                          
3492   3                      mStar_AdjustVolume(UserPrefVolume);
3493   3                      TPValue = 0x00;
3494   3                  }
3495   2                  else if (CPCode == AudioMute && PageValue == 0)
3496   2                  {
3497   3                      //Osd_Hide();
3498   3                      if(RetValueL==0x01) 
3499   3                         {
3500   4                              UserPrefMuteState = 1;
3501   4                              SwitchMute(MIA_Nothing);    
3502   4                        }                     
3503   3                       else if(RetValueL==0x02) 
3504   3                         {
3505   4                              UserPrefMuteState = 0;
3506   4                              mStar_AdjustVolume(UserPrefVolume);
3507   4                        }             
3508   3                              
3509   3                      TPValue = 0x00;
3510   3                  }                   
3511   2              #endif
3512   2      #if Enable_DDCCI_OSDEnable_EN
                      else if(CPCode == OSDEnable&& PageValue == 0)
                      {
                          if(RetValueL==1)
                              Set_DDCOSDDisEnableFlag();
                          if(RetValueL==2)
                              Clr_DDCOSDDisEnableFlag();
                          TPValue = 0x00;
                      }
              #endif          
3522   2                      
3523   2                #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL           
                      else if ((CPCode == ADJ_Red_Blacklevel || CPCode == ADJ_Green_Blacklevel || CPCode == ADJ_Blue_Bla
             -cklevel) && PageValue == 0)
                      {
                          if (CPCode == ADJ_Red_Blacklevel)
                              UserprefRedBlackLevel = RetValueL;
                          else if (CPCode == ADJ_Green_Blacklevel)
                              UserprefGreenBlackLevel = RetValueL;
                          else if (CPCode == ADJ_Blue_Blacklevel)
                              UserprefBlueBlackLevel = RetValueL;
                          mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBla
             -ckLevel);
                          SaveMonitorSetting();
                      }
                      #endif  
3536   2              else if (CPCode == ADJ_Language && PageValue == 0)
3537   2              // 3-17
3538   2              {
3539   3                  //     UserPrefLanguage = RetValueL-1;
3540   3                  #if 1
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 59  

3541   3                      if (RetValueL == LanSpanishCode)
3542   3                      {
3543   4                      UserPrefLanguage = LANG_Spanish;
3544   4                      }
3545   3      
3546   3                      else if (RetValueL == LanFrenchCode)
3547   3                      {
3548   4                      UserPrefLanguage = LANG_France;
3549   4                      }
3550   3      
3551   3                      else if (RetValueL == LanGermanCode)
3552   3                      {
3553   4                      UserPrefLanguage = LANG_German;
3554   4                      }
3555   3      
3556   3                      else if (RetValueL == LanItalianCode)
3557   3                      {
3558   4                      UserPrefLanguage = LANG_Italian;
3559   4                      }
3560   3      
3561   3                      else if (RetValueL == LanRussianCode)
3562   3                      {
3563   4                      UserPrefLanguage = LANG_Russia;
3564   4                      }
3565   3      
3566   3                      else if (RetValueL == LanSwedishCode)
3567   3                      {
3568   4                      UserPrefLanguage = LANG_Swedish;
3569   4                      }
3570   3      
3571   3                      else if (RetValueL == LanPolishCode)
3572   3                      {
3573   4                      UserPrefLanguage = LANG_Polish;
3574   4                      }
3575   3      
3576   3                      else if (RetValueL == LanCzechCode)
3577   3                      {
3578   4                      UserPrefLanguage = LANG_Czech;
3579   4                      }
3580   3      
3581   3                      else if (RetValueL == LanPortugueseCode_Brazil)
3582   3                      {
3583   4                      UserPrefLanguage = LANG_Portugues;
3584   4                      }
3585   3      
3586   3                      else if (RetValueL == LanSChineseCode)
3587   3                      {
3588   4                      UserPrefLanguage = LANG_SChina;
3589   4                      }
3590   3      
3591   3                      else if (RetValueL == LanTChineseCode)
3592   3                      {
3593   4                      UserPrefLanguage = LANG_TChina;
3594   4                      }
3595   3      
3596   3                      else if (RetValueL == LanKoreanCode)
3597   3                      {
3598   4                      UserPrefLanguage = LANG_Korea;
3599   4                      }
3600   3      
3601   3                      else if (RetValueL == LanJapaneseCode)
3602   3                      {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 60  

3603   4                      UserPrefLanguage = LANG_Japan;
3604   4                      }
3605   3      
3606   3                      else if (RetValueL == LanDutchCode)     //120105 Modify
3607   3                      {
3608   4                      UserPrefLanguage = LANG_Dutch;
3609   4                      }
3610   3      
3611   3                      else if (RetValueL == LanFinnishCode)   //120105 Modify
3612   3                      {
3613   4                      UserPrefLanguage = LANG_Finnish;
3614   4                      }
3615   3                      else if (RetValueL ==LanEnglistCode)
3616   3                      // default
3617   3                      {
3618   4                      UserPrefLanguage = LANG_English; 
3619   4                      }       
3620   3                                      
3621   3                      ValueL = LANG_Nums;
3622   3                      TPValue = 0x00;
3623   3                  #endif
3624   3              }
3625   2              else if (CPCode == SyncType && PageValue == 0)
3626   2              // 2-19
3627   2              {
3628   3                  ValueL = 3;
3629   3                  RetValueL = 0;
3630   3              }
3631   2              else if( CPCode == PowerMode && PageValue == 0 )        //120301 Modify
3632   2              {
3633   3                  if( RetValueL == 0x01 )
3634   3                  {
3635   4                      if(!PowerOnFlag)
3636   4                      {
3637   5                                              PowerOnSystem();
3638   5                                              #if USEFLASH
3639   5                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3640   5                                              #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags );
                                                      #endif
3643   5                      }
3644   4                  }
3645   3                              else if( RetValueL == 0x04 )
3646   3                              {
3647   4                      if(PowerOnFlag)
3648   4                              {
3649   5                                              PowerOffSystem();
3650   5                                              #if USEFLASH
3651   5                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
3652   5                                              #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags );
                                                      #endif
3655   5                      }
3656   4                              }
3657   3                  TPValue = 0x00;
3658   3              }
3659   2      
3660   2               
3661   2      /***********************************************Zhifeng.Wu***********************************************/
3662   2      /*      #define I_Menu_Command      SIORxBuffer[1]
3663   2              #define I_Menu_Set_Value_H  SIORxBuffer[2]
3664   2              #define I_Menu_Set_Value        SIORxBuffer[3]
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 61  

3665   2               //For TPV Application
3666   2              else if (CPCode == TPV_App_Command&& PageValue == 0)
3667   2              {
3668   2                      if(SIORxBuffer[0]==IMenu_Application)//For AOC I-Menu Application
3669   2                      {
3670   2                              //For Other Luminance Menu
3671   2                              if((I_Menu_Command==ECO_Mode)&&(!UserPrefDcrMode))      //121122 Modify
3672   2                              {
3673   2                                      {
3674   2      
3675   2                                              ICE_MAIN_CTRL(0);                               
3676   2                                              ICE_SUB_CTRL(0);                                
3677   2                                      }
3678   2      
3679   2                                      if(UserPrefColorTemp==CTEMP_SRGB)
3680   2                                      {
3681   2                                              UserPrefColorTemp=CTEMP_Warm1;
3682   2                                      }
3683   2                                      UserPrefECOMode=I_Menu_Set_Value;
3684   2                                      SetECO();
3685   2                              }
3686   2                              #if CT_sRGB_ENABLE
3687   2                              else if((I_Menu_Command==Gamma)&&(UserPrefColorTemp!=CTEMP_SRGB)&&(!UserPrefDcrMode))   //120609 Modify
3688   2                              {
3689   2                                  #if Enable_Gamma
3690   2                                      UserPrefGamaMode=I_Menu_Set_Value;
3691   2                                      mStar_SetupGamma( UserPrefGamaMode );   //120308 Modify
3692   2                                      #endif
3693   2                              }
3694   2                              #endif
3695   2                              else if(I_Menu_Command==DCR)
3696   2                              {
3697   2                                  #if CT_sRGB_ENABLE
3698   2                                      if (UserPrefColorTemp == CTEMP_SRGB)
3699   2                                              UserPrefColorTemp = CTEMP_Warm1;
3700   2                                       #endif
3701   2                                      if(UserPrefDcrMode!=I_Menu_Set_Value)//duqq080806 test
3702   2                                              AdjustDcrMode(1);                                                
3703   2                              }
3704   2                              
3705   2                              //For Picture Boost Items
3706   2                      
3707   2                      #if ESaverPowerDownFunc
3708   2                              else if(I_Menu_Command==PB_AutoPowerDown)
3709   2                              {
3710   2                                  ESaverPowerDownCounter=0;
3711   2                                      if((!I_Menu_Set_Value_H)&&(!I_Menu_Set_Value))
3712   2                                      {
3713   2                          ESaverPowerDownCounter=0;
3714   2                                      }
3715   2                                      else
3716   2                                      {   
3717   2                                              ESaverPowerDownCounter=((WORD)I_Menu_Set_Value_H << 8) | ((WORD)I_Menu_Set_Value);
3718   2                                      }
3719   2                                      //Osd_Show();
3720   2                                      //Osd_Draw4Num(1,1,ESaverPowerDownCounter);
3721   2                              }
3722   2                      #endif
3723   2                      }
3724   2                      
3725   2              }
3726   2              #undef  I_Menu_Command
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 62  

3727   2              #undef  I_Menu_Set_Value_H
3728   2              #undef  I_Menu_Set_Value
3729   2      */
3730   2      /*******************************************************************************************************/
3731   2              else if (CPCode == 0xFE && PageValue == 0)
3732   2              {
3733   3                      #ifdef UseVGACableReadWriteAllPortsEDID
                                      if(DDCBuffer[3]==0xEF)
                                      {
                                              BYTE i,Length;
                                              WORD Addr;
                                              Addr=(DDCBuffer[5]<<8)+DDCBuffer[6];
                                              Length=DDCBuffer[0]-0x86;
                                      //      if(DDCBuffer[4]==HDMI1)
                                              {
                                                      for(i=0;i<Length;i++)
                                                      {
                                                              SIORxBuffer[i] = DDCBuffer[i+7];
                                                      }
                                              }
                      
                                              if((DDCBuffer[4]>=VGA1&&DDCBuffer[4] <=MHL_HDMI2)||(DDCBuffer[4]>=EEPROM&&DDCBuffer[4] <=PanelSettingD
             -evice))        //130614 xiandi
                                                      {
                                                      
                                                                      EnableReadDDCType=DDCBuffer[4];
                                                                      for(i=0; i<Length; i++)
                                                                      {
                                                                              NVRam_WriteByte(Addr+i, SIORxBuffer[i]);
                                                                       }      
                                                                      EnableReadDDCType=I2C_EEPROM;
                                                                      //*/
                                                              //WriteDevice(DDCBuffer[4] ,Addr,Length);//Write EDID or HDCP KEY
                                                      }
                                              else
                                              {
                                                      return 0;
                                              }
                                              DDCBuffer[0]=0x83;
                                              DDCBuffer[1]=0x00;
                                              DDCBuffer[2]=DDCBuffer[6];//(Addr<<8);
                                              DDCBuffer[3]=Length;
                                              return 3;
                                      }
                                      else if((DDCBuffer[3]==0xE1)&&(DDCBuffer[4]==0xA2))
                                      {
                                              if(DDCBuffer[6]==0x01)
                                              {
                                                      ///hw_ClrDDC_WP();//EDID In Flash should not disable ddc ram.
                                                      Set_WriteDeviceFlag();
                                                      g_wFDCRCValue = appFactorySetEdidWriteStart( DDCBuffer[6] );//VGA1_EDID|HDMI1_EDID;//
                                                       DDCBuffer[0] = 0x84;
                                                       DDCBuffer[1] = 0x02;
                                                  DDCBuffer[2] = g_wFDCRCValue >> 8;
                                                  DDCBuffer[3] = g_wFDCRCValue & 0xFF;
                                                 // DDCBuffer[4] = 0x03;
                                                      
                                              }
                                              else if(DDCBuffer[6]==0x00)
                                              {
                                                      hw_SetDDC_WP();
                                                      Clr_WriteDeviceFlag();
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 63  

                                                       DDCBuffer[1] = 0x02;
                                              }
                                      }
                                      else if(DDCBuffer[3]==0x04)
                                      {
                                              if (PowerOnFlag)
                                              {
                                                      hw_ClrAmberLed();
                                                      hw_ClrGreenLed();
                                                      //hw_ClrBlacklit();
                                                      #if USEFLASH
                                                      UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit);
                                                      #else
                                                      NVRam_WriteByte( nvrMonitorAddr( MonitorFlag ), MonitorFlags);
                                                      #endif
                                              }
                                      }
                                      else
                                      #endif
3807   3              
3808   3                      {
3809   4                      #if NewFactoryCommand
                                 BYTE tempValue;
                              #endif
3812   4                       
3813   4              #ifdef DATA_LENGTH_20_BYTE
3814   4                  BYTE i;
3815   4                  for(i=0;i<23;i++)
3816   4                      SIORxBuffer[i] = DDCBuffer[i+3];
3817   4              #else
                          SIORxBuffer[0] = DDCBuffer[3];
                          SIORxBuffer[1] = DDCBuffer[4];
                          SIORxBuffer[2] = DDCBuffer[5];
                          SIORxBuffer[3] = DDCBuffer[6];
                          SIORxBuffer[4] = DDCBuffer[7];
                          SIORxBuffer[5] = DDCBuffer[8];
                          SIORxBuffer[6] = DDCBuffer[9];
                          SIORxBuffer[7] = DDCBuffer[10];
                      #endif
3827   4      
3828   4                                      #if NewFactoryCommand
              //==========================NewFactoryCommand====================
                                      #define TPVCMD1    DDCBuffer[3]
                                      #define TPVCMD2    DDCBuffer[4]
                                      #define TPV_ValueH DDCBuffer[5]
                                      #define TPV_ValueL DDCBuffer[6]
              
                      #if 0//def WH_REQUEST//add by lwj 120828
                              #if 0//WH_REQUEST_DDCCI_POWERSAVING
                              if(TPVCMD1==0xD6)//POWER DOWN 
                                       {
                                              if(TPVCMD2==PowerOff)
                                                      {
                                                       PowerOffSystem();
                                                      }
                                              if(TPVCMD2==ForceIntoPowerSaving)
                                                       {
                                                #if MS_PM
                                                      if (!PowerSavingFlag)
                                                      {
                                                      hw_ClrBlacklit();
                                                      Set_ForcePowerSavingFlag();
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 64  

                                                      Set_DDCForcePowerSavingFlag();
                                                      }
                                              #else
                                                      Power_PowerOffSystem();
                                              #endif
              
                                                      hw_ClrGreenLed();
                                                      hw_SetAmberLed();
              
                                                      }
                                      }
                              #endif
                      #endif
                                              
                                      if(TPVCMD1==TPV_FactoryAutoAlignment)
                                      {
                                              if(TPVCMD2==SetFactoryMode)
                                              {
                                                      if(TPV_ValueL==SetOn)
                                                              {
                                                              Set_FactoryModeFlag();
                                                              Set_BurninModeFlag();
                                                              //120413 Modify for TPV Request
                                                              #if Enable_Gamma
                                                              if( UserPrefGamaMode != GAMA1 )
                                                              {
                                                                      UserPrefGamaMode = GAMA1;
                                                                      mStar_SetupGamma( GAMA1 );
                                                              }
                                                              #endif
                                                              if(UserPrefECOMode != ECO_Standard)
                                                              {
                                                                      UserPrefECOMode = ECO_Standard;
                                                                      SetECO();
                                                              }
                                                              if(UserPrefDcrMode)
                                                              {
                                                                      UserPrefDcrMode = 0;
                                                                      SetECO();
                                                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                                                              }
              
                                                              UserPrefBrightness = DefBrightness;
                                                              UserPrefContrast = DefContrast;
              
                                                              mStar_AdjustBrightness(UserPrefBrightness);
                                                              mStar_AdjustContrast(UserPrefContrast);
              
                                                              DDCBuffer[1] = 0x02;    
                                                              }
                                                      else if(TPV_ValueL==SetOff)
                                                              {
                                                              Clr_FactoryModeFlag();
                                                              DDCBuffer[1] = 0x04;    
                                                      
                                                              }
                                                       #if !USEFLASH
                                                          NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                                       #else
                                                       UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                                                       #endif
                                              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 65  

                                              else if(TPVCMD2==NVMInit)
                                              {
                                              }
                                              else if(TPVCMD2==SetBurnMode)
                                              {
                                                      if(TPV_ValueL==SetOn)
                                                      {
                                                              Set_BurninModeFlag();
                                                              Set_DoBurninModeFlag();         //120703 Modify for TPV Request
                                                      }
                                                      else if(TPV_ValueL==SetOff)
                                                      {
                                                              Clr_BurninModeFlag();
                                                              Clr_DoBurninModeFlag();         //120703 Modify for TPV Request
                                                      }
                                                      else if(TPV_ValueL==2)//burnin room checklater
                                                              ;
                                              #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                                              #else
                                  SaveMonitorSetting();
                                              #endif
                                              #if USEFLASH
                                                              Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                                        if(MonitorSetting.MonitorFlag==MonitorFlags)
                                                   {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }       
                                                       
                                                #else
                                                      NVRam_ReadByte(nvrMonitorAddr(MonitorFlag), &tempValue);
                                                   if(tempValue== MonitorFlags)
                                                      {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
                                      #endif
                                              
                                              }
                                              else if(TPVCMD2==ClearBacklitTime)
                                              {
                                                      #if USEFLASH
                                                      #else
                                                      SaveBlacklitTime();
                                                      
                                                      NVRam_ReadTbl(BlacklitTimeAddr, (BYTE*)(&tempValue), 4);
                                                         if(tempValue==0)
                                                            {
                                                              DDCBuffer[1]=0x02;
                                                              }
                                                         else
                                                           {
                                                              DDCBuffer[1]=0x04;
                                                              }
                                                      #endif
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 66  

                                              
                                                      
                                              }
                                              else if(TPVCMD2==SetDPSAndICareEnable)          //130311 Modify
                                              {
              
                                              }
                                              else if(TPVCMD2==SetProduceMode)
                                              {
                                                      #if !USEFLASH
                                                      WORD temp,temp1;
                                                      #endif
                                                      if(TPV_ValueL==SetOn)
                                                      {
                                                              #if AudioFunc
                                                                       UserPrefVolume=90;     //120920 Modify for PE Request
                                                               mStar_AdjustVolume(UserPrefVolume);                    //130107_23 Henry 
                                                              #endif
                                                   #if USEFLASH
                                                       FactoryProductModeValue=ProductModeOnValue;
                                                       SaveFactorySetting();
                                                                                               SaveMonitorSetting();
                                                            #else
                                                              {
                                                      temp=ProductModeOnValue;
                                                      NVRam_WriteTbl(ProductModeAddr, (BYTE*)(&temp), 2);
                                                                                              #if AudioFunc
                                                                                              NVRam_WriteByte(nvrMonitorAddr(Volume), UserPrefVolume);
                                                                                              #endif
                                                              }
                                                             #endif
                                                      }
                                                      else if(TPV_ValueL==SetOff) 
                                                      {
                                                      #if USEFLASH
                                                          FactoryProductModeValue=ProductModeOffValue;
                                                          SaveFactorySetting();
                                                            #else
                                                              {
                                                         temp=ProductModeOffValue;
                                                          NVRam_WriteTbl(ProductModeAddr, (BYTE*)(&temp), 2);
                                                              }
                                                              #endif
                                                      }
                                                  #if USEFLASH
                                                                              Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
                                                  if(FactorySetting.ProductModeValue==FactoryProductModeValue)
                                                   {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
              
                                                     #else
                                                           NVRam_ReadTbl(ProductModeAddr, (BYTE*)(&temp1), 2);
                                                   if(temp1==temp)
                                                      {
                                                      DDCBuffer[1]=0x02;
                                                      }
                                                  else
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 67  

                                                   {
                                                      DDCBuffer[1]=0x04;
                                                      }
                                             #endif
                                                                         
              
                                              }
                                              else if(TPVCMD2==LogoONOFF)//  2011.8.3   
                                                 {
                                                   if(TPV_ValueH==0x06)       //120420 Modify
                                                      {
                                                        if(TPV_ValueL==0x01)
                                                              {
                                                                UserPrefLogoON=1;
                                                                      #if USEFLASH
                                                                      SaveFactorySetting();
                                                                      #else
                                                                         NVRam_WriteByte(nvrFactoryAddr(LogoON), UserPrefLogoON);
                                                                      #endif
              
                                                              }
                                                        else
                                                              {
                                                                UserPrefLogoON=0;
                                                                      #if USEFLASH
                                                                      SaveFactorySetting();
                                                                      #else
                                                                          NVRam_WriteByte(nvrFactoryAddr(LogoON), UserPrefLogoON);
                                                                      #endif
              
                                                              }
                                                       
                                                      }
                                                      else if(TPV_ValueH==0x03)       //120301 Modify
                                                      {
                                                              if( TPV_ValueL == SetOn )
                                                              {
                                                                      if(!UserPrefDcrMode)
                                                                      {
                                                                              AdjustDcrMode(1);
                                                                              #if !USEFLASH
                                                                              NVRam_WriteByte( nvrMonitorAddr( DcrMode ), UserPrefDcrMode );
                                                                              #else
                                                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                                              #endif
                                                                      }
                                                              }
                                                              else if( TPV_ValueL == SetOff )
                                                              {
                                                                      if(UserPrefDcrMode)
                                                                      {
                                                                              AdjustDcrMode(1);
                                                                              #if !USEFLASH
                                                                              NVRam_WriteByte( nvrMonitorAddr( DcrMode ), UserPrefDcrMode );
                                                                              #else
                                                                              UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                                              #endif
                                                                      }
                                                              }
                                                      }
                                                  }                           
                                              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 68  

                                              #if PanelminiLVDS ||PANEL_VCOM_ADJUST   //110229 Modify
                                              else if(TPVCMD2==AdjPanelVCOM)
                                              {
                                                      #if VCOM_TYPE == VCOM_MAXIM     || VCOM_TYPE == VCOM_SMIM ||VCOM_TYPE == VCOM_TPSIM     //120322 Modify
                                                      WordValue = (( TPV_ValueH << 8 ) | TPV_ValueL );
                                                      WordValue = WordValue + VCOM_VALUE_OFFSET;
                                                      if( WordValue >= MAX_VCOM_VALUE )
                                                              FactorySetting.VcomValue = MAX_VCOM_VALUE;
                                                      else
                                                              FactorySetting.VcomValue = WordValue & 0x3FF;
                                                      #else
                                                      if( TPV_ValueL >= 0x7F )
                                                              FactorySetting.VcomValue = 0x7F;
                                                      else
                                                              FactorySetting.VcomValue = TPV_ValueL;
                                                      #endif
                                                      msWriteMiniLVDSi2c_Vcom_DAC(FactorySetting.VcomValue);
                                                      #if USEFLASH
                                                              SaveFactorySetting();
                                                      #else
                                                                      #if VCOM_TYPE == VCOM_MAXIM || VCOM_TYPE == VCOM_SMIM ||VCOM_TYPE == VCOM_TPSIM //120413 Modify
                                                              NVRam_WriteWord( nvrFactoryAddr( VcomValue ), FactorySetting.VcomValue );
                                                                      #else
                                                              NVRam_WriteByte( nvrFactoryAddr( VcomValue ), FactorySetting.VcomValue );
                                                                      #endif
                                                      #endif
                                              }
                                              #endif
                                              #if HDCPKEY_IN_Flash
                                              else if(TPVCMD2==HDCPReadWriteStart)
                                              {
                                                      Set_WriteHDCPcodeFlag();
              
                                                      TCRCvalue = 0;
                                                      Power_TurnOffLed();
                                                      //Flash_Erase_FreeBuffer(FLASH_KEY_HDCP,0); // jeff add it in 2009 0907
                                                      bFlashWriteFactory = TRUE;
                                                      
                                  #if 0 // Enable_Cache
                                  MCU_DisableCache();
                                  #endif
              
                                                      #if !((CHIP_ID == CHIP_TSUM9|| CHIP_ID == CHIP_TSUMF) && ENABLE_CABLE_5V_EDID)
                                                      FlashSectorErase(TRUE, HDCPKEYSET_START);
                                                      FlashDisableWP(HDCPKEYSET_START);
                                                      #endif
                                              }
                                              #endif
                                              #if Enable_Gamma
                                              else if(TPVCMD2==AdjGammaMode)
                                              {
                                                 UserPrefGamaMode = TPV_ValueL;
                                 mStar_SetupGamma( UserPrefGamaMode );
                                              }
                                              #endif
              
                                      }       
                                      
                                      else if(TPVCMD1==TPV_AdjRedGain)
                                      {
                                          UserPrefRedColor = TPV_ValueL; // for CT
                              //mStar_AdjustRedColor(UserPrefRedColor, UserPrefContrast);
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 69  

                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjGreenGain)
                                      {
                                          UserPrefGreenColor = TPV_ValueL; // for CT
                              //mStar_AdjustGreenColor(UserPrefGreenColor, UserPrefContrast);
                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjBlueGain)
                                      {
                                          UserPrefBlueColor = TPV_ValueL; // for CT
                              //mStar_AdjustBlueColor(UserPrefBlueColor, UserPrefContrast);
                                              mStar_AdjustRGBColor(UserPrefContrast, UserPrefRedColor, UserPrefGreenColor, UserPrefBlueColor);        //120
             -105 Modify
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjContrast)       
                                      {
                              UserPrefContrast = TPV_ValueL;
                              UserPrefContrast = UserPrefContrast + MinContrastValue;//checklater
                              mStar_AdjustContrast(UserPrefContrast);                         
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_AdjBrightness)     
                                      {
                              UserPrefBrightness = TPV_ValueL;
                              mStar_AdjustBrightness(UserPrefBrightness);                     
                                              DDCBuffer[1]=0x02;
                                      }
                                      else if(TPVCMD1==TPV_SetDefLanguage)    
                                      {
                             
                                      #if 1   //120322 Modify
                                              if (TPV_ValueL == LanSpanishCode)
                                                      {
                                      UserPrefLanguage = LANG_Spanish;
                                                      }
                                                      
                                  else if (TPV_ValueL == LanFrenchCode)
                                      {
                                      UserPrefLanguage = LANG_France;
                                      }
                                                      
                                  else if (TPV_ValueL == LanGermanCode)
                                      {
                                      UserPrefLanguage = LANG_German;
                                      }
                                                      
                                  else if (TPV_ValueL == LanItalianCode)
                                      {
                                      UserPrefLanguage = LANG_Italian;
                                      }
                                                      
                                  else if (TPV_ValueL == LanRussianCode)
                                      {
                                      UserPrefLanguage = LANG_Russia;
                                      }
                                                      
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 70  

                                  else if (TPV_ValueL == LanSwedishCode)
                                      {
                                      UserPrefLanguage = LANG_Swedish;
                                      }
                                                      
                                  else if (TPV_ValueL == LanPolishCode)
                                      {
                                      UserPrefLanguage = LANG_Polish;
                                      }
                                                      
                                  else if (TPV_ValueL == LanCzechCode)
                                      {
                                      UserPrefLanguage = LANG_Czech;
                                      }
                                                                
                                              else if (TPV_ValueL == LanPortugueseCode_Brazil)
                                      {
                                      UserPrefLanguage = LANG_Portugues;
                                      }
                                        
                                  else if (TPV_ValueL == LanSChineseCode)
                                      {
                                      UserPrefLanguage = LANG_SChina;
                                      }
                                                      
                                  else if (TPV_ValueL == LanTChineseCode)
                                      {
                                      UserPrefLanguage = LANG_TChina;
                                      }
                                                      
                                  else if (TPV_ValueL == LanKoreanCode)
                                      {
                                      UserPrefLanguage = LANG_Korea;
                                      }
                                                      
                                  else if (TPV_ValueL == LanJapaneseCode)
                                      {
                                      UserPrefLanguage = LANG_Japan;
                                      }
                                                                              
                                                      else if (TPV_ValueL == LanDutchCode)    //120105 Modify
                                      {
                                                              UserPrefLanguage = LANG_Dutch;
                                      }
                                                      
                                                      else if (TPV_ValueL == LanFinnishCode)  //120105 Modify
                                      {
                                                              UserPrefLanguage = LANG_Finnish;
                                      }
              
                                  else if (TPV_ValueL ==LanEnglistCode)
                                  // default
                                                              {
                                      UserPrefLanguage = LANG_English; 
                                      }       
                                      #if CHIP_ID == CHIP_TSUMV       //130924 henry  petit update 20131017
                                      Set_LoadOSDDataFlag();  
                                      if(MenuPageIndex>=MainMenu&&MenuPageIndex<=ExitMenu)
                                      {
                                              Osd_Hide();
                                                      MenuPageIndex=RootMenu;
                                      }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 71  

                                      #else
                                              //For Select SChinese/TChinese/Korean Language Font Error Issue
                                      LoadLanguageStatusPropfont();   //120105 Modify
                                      #endif
                              #endif
                              #if !USEFLASH
                                  NVRam_WriteByte(nvrMonitorAddr(Language), UserPrefLanguage);
                              #else
                                  SaveMonitorSetting();
                              #endif
                               #if USEFLASH
                                                      Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                   if(MonitorSetting.Language==UserPrefLanguage)
                                           {
                                              DDCBuffer[1]=0x02;
                                              }
                                          else
                                           {
                                              DDCBuffer[1]=0x04;
                                              }       
                                
                            #else
                                         NVRam_ReadByte(nvrMonitorAddr(Language), &tempValue);
                                   if(tempValue==UserPrefLanguage)
                                      {
                                      DDCBuffer[1]=0x02;
                                      }
                                  else
                                   {
                                      DDCBuffer[1]=0x04;
                                      }
                                  
                             #endif
                                               
                                              
                                      }
                                      else if(TPVCMD1==TPV_SelectInput)       
                                      {
                                      
                                      }
                                      else if(TPVCMD1==TPV_SelectGamma)       
                                      {
                                      
                                      }                       
                                      else if(TPVCMD1==TPV_RestorFactory)     
                                      {
              
                                                              {
                                                           if( ResetAllSetting())
                                                      DDCBuffer[1]=0x02;
                                                           else
                                                    DDCBuffer[1]=0x04;
                                                              }
              
                                              ForceDelay1ms(50);
                            
                              }                       
                                      else if(TPVCMD1==TPV_AutoColor) //120723 Modify
                                      {
                                              if (mStar_AutoColor())
                                              {
                                                      #if Show_BackLightTimeValue
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 72  

                                                      BlacklitTime_S = 0;
                                                      BlacklitTime_M = 0;
                                                      BlacklitTime_H = 0;
                                                      MonitorBackLightTime_S=BlacklitTime_S;
                                                      MonitorBackLightTime_M= BlacklitTime_M; 
                                                      MonitorBackLightTime_H=BlacklitTime_H;  
                                                    #endif
                                                      if (CheckFactorySettingOutOfRange())
                                                      {
                                                              #if 1//USEFLASH         //131105 Henry For AutoColor Not Save
                                                              Init_FactorySetting();
                                                              SaveFactorySetting();
                                                              #else
                                                              Init_MonitorSetting();
                                                              SaveMonitorSetting();
                                                              #endif
                                                              DDCBuffer[1]=0x04;
                                                      }
                                                      else
                                                      {
                                                              #if 1//USEFLASH         //131105 Henry For AutoColor Not Save
                                                              SaveFactorySetting();
                                                              #else
                                                              SaveMonitorSetting();
                                                              #endif
                                                              DDCBuffer[1]=0x02;
                                                      #if 0//def WH_REQUEST           //Fay 2013/9/13
                                                              Set_EnableShowFactoryMenuFlag();
                                                      #else
                                                              Delay1ms(200);
                                                              MenuPageIndex = FactoryMenu;
              
                                                              MenuItemIndex = 0;
                                                              Osd_SetPosition(0,100);//20140903  for BJ PE
                                                              DrawOsdMenu();
                                                              
                                                              //Osd_SetPosition(0,100);
                                                      #endif
                                                      }
                                                   #if USEFLASH
                                                      //SaveMonitorSetting2();                        
                                                      UserPref_EnableFlashSaveBit( bFlashForceSaveMonitor2Bit );
                                                      //UserPref_EnableFlashSaveBit( bFlashSaveMonitorBit );
                                                      #else   
                                                         NVRam_WriteByte(NVRAM_ADDR_MointorMember(MonitorFlag), MonitorFlags);
                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeS), MonitorBackLightTime_S);
                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeM), MonitorBackLightTime_M);
                                                          NVRam_WriteByte(nvrMonitorAddr(BacklighttimeH), MonitorBackLightTime_H);
              
                                                      #endif
                                              }       
                                              else
                                              {
                                                      #if 1//USEFLASH                 //131105 Henry For AutoColor Not Save
                                                      SaveFactorySetting();
                                                      #else
                                                      SaveMonitorSetting();
                                                      #endif
              
                                                      DDCBuffer[1]=0x04;
                                              }
                                      }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 73  

                                      else if(TPVCMD1==TPV_AutoConfig)
                                      {
                                              if (mStar_AutoGeomtry())
                                              {
                                                     CheckModeSettingRange();
                                               
                                                      DDCBuffer[1]=0x02;
                                              }
                                              else
                                                      DDCBuffer[1]=0x04;
              
                                                SaveModeSetting();
                                      }
                                      else if(TPVCMD1==TPV_SaveOrRecallColTmp)        
                                      {
                                              //#define ColTemp               DDCBuffer[4]
                                              //#define InpSrc          DDCBuffer[5]
                                              //#define ActFlag         DDCBuffer[6]
              
                                              #if 1//WH_REQUEST_DDCCI
                                              
                                                               if( TPVCMD2 == 0x81 )//for quick Set_ColorTemp  //only for WH 20120906 lwj
                                                               {              
                                              
                                                       //9300   
                                                                       UserPrefRedColorCool1 = SIORxBuffer[2];
                                                                       UserPrefGreenColorCool1 = SIORxBuffer[3];
                                                                       UserPrefBlueColorCool1 = SIORxBuffer[4];
                                                                              //Normal                                                
                                                                       UserPrefRedColorNormal = SIORxBuffer[5];
                                                                       UserPrefGreenColorNormal = SIORxBuffer[6];
                                                                       UserPrefBlueColorNormal = SIORxBuffer[7];      
                                                                       //6500
                                                                       UserPrefRedColorWarm1 = SIORxBuffer[8];
                                                                       UserPrefGreenColorWarm1 = SIORxBuffer[9];
                                                                       UserPrefBlueColorWarm1 = SIORxBuffer[10];
                                                                       #if CT_sRGB_ENABLE
                                                                               //SRGB
                                                                       UserPrefRedColorSRGB = SIORxBuffer[11];
                                                                       UserPrefGreenColorSRGB = SIORxBuffer[12];
                                                                       UserPrefBlueColorSRGB = SIORxBuffer[13];
                                                                       #endif
                                              
                                                                       
                                                                       #if USEFLASH
                                                                       SaveFactorySetting();
                                                                       #else
                                                                       SaveMonitorSetting();
                                                                      #endif
                                                               
                                                                      #if USEFLASH
                                                                       Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                                                       tempValue=MonitorSetting.ColorTemp;
                                                                       Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
                                                                      #else
                                                                       NVRam_ReadByte(nvrMonitorAddr(ColorTemp), &tempValue);
                                                                       NVRam_ReadTbl(MonitorSettingAddr, (BYTE*) &MonitorSetting, MonitorSettingSize);
                                                                      #endif
                                                                      // recommand = OK_READY;                                                                          
                                                               }
                                              #endif
              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 74  

                                              if(TPV_ValueL)
                                              {
                                                      switch(TPVCMD2)
                                                      {
                                                          #if CT_sRGB_ENABLE
                                                              case ColorTempSRGB:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_SRGB;
                                                                      UserPrefRedColor = UserPrefRedColorSRGB;
                                                                      UserPrefGreenColor = UserPrefGreenColorSRGB;
                                                                      UserPrefBlueColor = UserPrefBlueColorSRGB;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadSRGBSetting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
              
                                                                      break;
                                                               #endif
                                                              case ColorTempNative:
              
                                                                      break;
                                                              case ColorTemp4000K:
              
                                                                      break;
                                                              case ColorTemp5000K:
              
                                                                      break;
                                                              case ColorTemp6500K:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_Warm1;
                                                                      UserPrefRedColor = UserPrefRedColorWarm1;
                                                                      UserPrefGreenColor = UserPrefGreenColorWarm1;
                                                                      UserPrefBlueColor = UserPrefBlueColorWarm1;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadWarm1Setting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
              
                                                                      break;
                                                              case ColorTemp7500K:
                                                                      UserPrefColorTemp = CTEMP_Normal;
                                                                      UserPrefRedColor = UserPrefRedColorNormal;
                                                                      UserPrefGreenColor = UserPrefGreenColorNormal;
                                                                      UserPrefBlueColor = UserPrefBlueColorNormal;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK ReadNormalSetting();
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
                                                                      break;
                                                              case ColorTemp8200K:
              
                                                                      break;
                                                              case ColorTemp9300K:
                                                                      
                                                                      UserPrefColorTemp = CTEMP_Cool1;
                                                                      ReadColorTempSetting(); // 2006/11/10 6:59PM by KK      ReadCool1Setting();
                                                                      UserPrefRedColor = UserPrefRedColorCool1;
                                                                      UserPrefGreenColor = UserPrefGreenColorCool1;
                                                                      UserPrefBlueColor = UserPrefBlueColorCool1;
                                                                      mStar_AdjustBrightness(UserPrefBrightness);
                                                                      mStar_AdjustContrast(UserPrefContrast);
              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 75  

              
                                                                      break;
                                                              case ColorTemp10000K:
              
                                                                      break;
                                                              case ColorTemp11500K:
              
                                                                      break;
                                                              case ColorTempUser:
              
                                                                      break;
                                                              case SaveAllColorTemp:                                  
                                                                      SaveFactorySetting();
                                                                      break;
                                                              
                                                              default:
                                                                      break;                                                  
                                                      }                       
                                                      DDCBuffer[1]=0x02;      
                                              }
                                              else
                                              {
                                                      switch(TPVCMD2)
                                                      {
                                                          #if CT_sRGB_ENABLE
                                                              case ColorTempSRGB:
                                                                      UserPrefColorTemp = CTEMP_SRGB;
                                                                      UserPrefRedColorSRGB = UserPrefRedColor;
                                                                      UserPrefGreenColorSRGB = UserPrefGreenColor;
                                                                      UserPrefBlueColorSRGB = UserPrefBlueColor;
                                                                      break;
                                                               #endif
                                                              case ColorTempNative:
              
                                                                      break;
                                                              case ColorTemp4000K:
              
                                                                      break;
                                                              case ColorTemp5000K:
              
                                                                      break;
                                                              case ColorTemp6500K:
                                                                      UserPrefColorTemp = CTEMP_Warm1;
                                                                      UserPrefRedColorWarm1 = UserPrefRedColor;
                                                                      UserPrefGreenColorWarm1 = UserPrefGreenColor;
                                                                      UserPrefBlueColorWarm1 = UserPrefBlueColor;
              
              
                                                                      break;
                                                              case ColorTemp7500K:
                                                                      UserPrefColorTemp = CTEMP_Normal;
                                                                      UserPrefRedColorNormal= UserPrefRedColor;
                                                                      UserPrefGreenColorNormal= UserPrefGreenColor;
                                                                      UserPrefBlueColorNormal= UserPrefBlueColor;
              
              
                                                                      break;
                                                              case ColorTemp8200K:
              
                                                                      break;
                                                              case ColorTemp9300K:
                                                                      
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 76  

                                                                      
                                                                      UserPrefColorTemp = CTEMP_Cool1;
                                                                      UserPrefRedColorCool1 = UserPrefRedColor;
                                                                      UserPrefGreenColorCool1 = UserPrefGreenColor;
                                                                      UserPrefBlueColorCool1 = UserPrefBlueColor;
              
              
                                                                      //Osd_Draw4Num(0,1,UserPrefRedColor);
                                                                      //Osd_Draw4Num(0,2,UserPrefRedColorCool1);
                                                                      break;
                                                              case ColorTemp10000K:
              
                                                                      break;
                                                              case ColorTemp11500K:
              
                                                                      break;
                                                              case ColorTempUser:
              
                                                                      break;
                                                              case SaveAllColorTemp:                                          
                                                                      SaveFactorySetting();
                                                                      break;
                                                              default:
                                                                      break;                                                  
                                                      }
                                                      //Osd_Draw4Num(0,0,11);
                                                      //Osd_Show();                           
                                                      SaveFactorySetting();
                                              
                                              #if USEFLASH
                                    //Flash_ReadMonitorSet(0, (BYTE*)&MonitorSetting, MonitorSettingSize);    
                                    Flash_ReadMonitorSet((BYTE*)&MonitorSetting, MonitorSettingSize);
                                       tempValue=MonitorSetting.ColorTemp;
                                      //Flash_ReadFactorySet(0, (BYTE*)&FactorySetting, FactorySettingSize);  
                                      Flash_ReadFactorySet((BYTE*)&FactorySetting, FactorySettingSize);
                                              
                                              //msWriteByte(SC0_34,tempValue);
                                              //msWriteByte(SC0_35,UserPrefBlueColorCool1);
                                              #else
                                              NVRam_ReadByte(nvrMonitorAddr(ColorTemp), &tempValue);
                                              NVRam_ReadTbl(MonitorSettingAddr, (BYTE*) &MonitorSetting, MonitorSettingSize);
                                            NVRam_ReadTbl(FactorySettingAddr, (BYTE*) &FactorySetting, FactorySettingSize);
                                      #endif
                                              switch(tempValue)
                                              {
                                                      #if CT_sRGB_ENABLE
                                                              case  CTEMP_SRGB:
                                                                      #if USEFLASH
                                                              if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                      FactorySetting.RedColorsRGB== UserPrefRedColor&&
                                                                      FactorySetting.GreenColorsRGB== UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorsRGB == UserPrefBlueColor)
                                                              #else
                                                              if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                      FactorySetting.RedColorsRGB== UserPrefRedColor&&
                                                                      FactorySetting.GreenColorsRGB== UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorsRGB == UserPrefBlueColor)
                                                                      #endif
                                                                      DDCBuffer[1]=0x02;
                                                              else
                                                                      DDCBuffer[1]=0x04;
                                                                      break;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 77  

                                                               #endif
                                                              case CTEMP_Warm1:
                                                                      #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorWarm1 == UserPrefRedColor&&
                                                                              FactorySetting.GreenColorWarm1 == UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorWarm1 == UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorWarm1 == UserPrefRedColor&&
                                                                              FactorySetting.GreenColorWarm1 == UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorWarm1 == UserPrefBlueColor)
                                                                              #endif
                                                                              DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                              
                                                                      break;
                                                              case CTEMP_Normal:
                                                                              #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorNormal== UserPrefRedColor&&
                                                                              FactorySetting.GreenColorNormal== UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorNormal== UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&
                                                                              FactorySetting.RedColorNormal== UserPrefRedColor&&
                                                                              FactorySetting.GreenColorNormal== UserPrefGreenColor&&
                                                                              FactorySetting.BlueColorNormal== UserPrefBlueColor)
                                                                              #endif
                                                                              DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                              
                                                                      break;
                                                              
                                                              case CTEMP_Cool1:
                                                                      #if USEFLASH
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&                               
                                                                      FactorySetting.RedColorCool1 == UserPrefRedColor&&
                                                                      FactorySetting.GreenColorCool1 == UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorCool1 == UserPrefBlueColor)
                                                                      #else
                                                                      if( MonitorSetting.ColorTemp==UserPrefColorTemp&&                               
                                                                      FactorySetting.RedColorCool1 == UserPrefRedColor&&
                                                                      FactorySetting.GreenColorCool1 == UserPrefGreenColor&&
                                                                      FactorySetting.BlueColorCool1 == UserPrefBlueColor)
                                                                      #endif
                                                                      DDCBuffer[1]=0x02;
                                                                      else
                                                                              DDCBuffer[1]=0x04;
                                                                      //Osd_Draw4Num(0,1,UserPrefRedColor);
                                                                      //Osd_Draw4Num(0,2,UserPrefRedColorCool1);
                                                                      msWriteByte(SC0_36,DDCBuffer[1]);
              
                                                                      break;
                                                              
                                                              default:
                                                                      break;                                                  
                                                      }
                                                      
                                              }
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 78  

                                              //#undef ColTemp
                                              //#undef InpSrc
                                              //#undef ActFlag
                                      
                                      }
                                      #if HDCPKEY_IN_Flash
                                      else if(TPVCMD1==TPV_HDCPReadWriteStart&&WriteHDCPcodeFlag)     
                                      {
                                      #if ((CHIP_ID == CHIP_TSUM9 || CHIP_ID == CHIP_TSUMF) && ENABLE_CABLE_5V_EDID)
                              WORD wTemp;
                              if(SIO_TYPE2 < (HDCPKEY_SIZE/HDCP_BLOCK_LENGTH))
                                  Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, SIO_TYPE2, HDCP_BLOCK_LENGTH, &SIORxBuffer[
             -3], HDCP_BLOCK_LENGTH);
                              else if(SIO_TYPE2 == (HDCPKEY_SIZE/HDCP_BLOCK_LENGTH))
                              {   Flash_Write_Factory_KeySet(FLASH_KEY_HDCP, SIO_TYPE2, HDCP_BLOCK_LENGTH, &SIORxBuffer[
             -3], HDCPKEY_SIZE%HDCP_BLOCK_LENGTH);
                                  for(wTemp=0; wTemp<HDCPKEY_SIZE; wTemp++)
                                  {
                                      TCRCvalue = CRC16(FlashReadByte(g_wKEYSET_START+wTemp), TCRCvalue);
                                  }
                                                      Set_LoadHDCPKeyFlag();
                                                      Power_TurnOnGreenLed();
                              }
                                      #else
                                                    BYTE i;
                                                  for (i = 0; i < HDCP_BLOCK_LENGTH; i++)
                                                  {//SIO_TYPE2==HDCP BANK NO    SIORxBuffer[3+i]==HDCP DATA
                                                      if(HDCP_BLOCK_LENGTH*SIO_TYPE2+i<HDCPKEY_SIZE)
                                                      {
                                                          FlashHDCPWriteByte((HDCPKEYSET_START+HDCP_BLOCK_LENGTH*SIO_TYPE2+i),SIORxBuf
             -fer[3+i]);
                                                          TCRCvalue = CRC16(FlashReadByte(HDCPKEYSET_START+HDCP_BLOCK_LENGTH*SIO_TYPE2
             -+i), TCRCvalue);
                                                                                                              
                                                      }
                                                                              
                                                  }
                                                 
                                                  if (SIO_TYPE2==HDCPKEY_SIZE/HDCP_BLOCK_LENGTH)//HDCP WRITE END
                                                  {
                                                      Set_LoadHDCPKeyFlag();
                                                              bFlashWriteFactory = FALSE;
                                                              FlashEnableWP();
              
                                                         #if 0 //Enable_Cache
                                                   
                                                      #if Enable_Cache
                                                          CACHE_ENABLE();  //MCU_EnableCache();
                                                      #else
                                                          CACHE_DISABLE();
                                                      #endif
                                                   #endif
              
                                                      Power_TurnOnGreenLed();
                                                  }
                                      #endif
                                      }       
                                      #endif
                                      else if(TPVCMD1==TPV_SelectGamma)       
                                      {
                                      }       
              
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 79  

              
                                      
              
                                      
                                      #undef TPV_ValueH
                                      #undef TPV_ValueL                       
                                      #undef TPVCMD1
              //==========================NewFactoryCommand=================
              
                                      #endif
4783   4                              {
4784   5                              #if 1//ndef WH_REQUEST
4785   5                              AOCAlign();
4786   5                              #endif
4787   5      
4788   5                              }
4789   4      
4790   4                      }   
4791   3              }
4792   2      #if JRY_Color_Tool_Functing
4793   2             else if(CPCode == 0x7B && PageValue == 0)
4794   2             {
4795   3                  Resault=JRYColorToolControl();
4796   3             }
4797   2      #endif
4798   2              else
4799   2              {
4800   3                  DDCBuffer[2] = 0x01;
4801   3              }
4802   2              //Setting----------------------------------End
4803   2              //Transmission-----------------------------Start
4804   2              if (CommandCode == SETVCPFeature)
4805   2              {
4806   3                #if  JRY_Color_Tool_Functing
4807   3                 if(CPCode == 0x7B)   
4808   3                  return Resault;
4809   3                 else
4810   3              #endif
4811   3                      {
4812   4                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit);
4813   4                           return 9;
4814   4                      }        
4815   3              }
4816   2              else
4817   2              {
4818   3                  DDCBuffer[0] = 0x89;
4819   3                  DDCBuffer[1] = 0xC7;
4820   3                  DDCBuffer[3] = PageValue;
4821   3                  DDCBuffer[4] = CPCode;
4822   3                  DDCBuffer[5] = TPValue;
4823   3                  DDCBuffer[6] = ValueH;
4824   3                  DDCBuffer[7] = ValueL;
4825   3                  DDCBuffer[8] = RetValueH;
4826   3                  DDCBuffer[9] = RetValueL;
4827   3                  return 9;
4828   3              }
4829   2              //Transmission-------------------------------End
4830   2          }
4831   1          //SetValue------------------------------------------------------End
4832   1          else if (CommandCode == SaveCurrentSetting)
4833   1          // 1-10
4834   1          {
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 80  

4835   2              //SaveUserPref();
4836   2              #if USEFLASH
4837   2              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit|bFlashSaveModeBit);
4838   2              #else
                      SaveMonitorSetting();
                      SaveModeSetting();
                      #endif
4842   2              
4843   2              return 0;
4844   2          }
4845   1          else if (CommandCode == GETVCPPage)
4846   1          // 1-11
4847   1          {
4848   2              DDCBuffer[0] = 0x83;
4849   2              DDCBuffer[1] = 0xC5;
4850   2              DDCBuffer[2] = 0;
4851   2              DDCBuffer[3] = 3;
4852   2              return 3;
4853   2          }
4854   1          DDCBuffer[0] = 0x80;
4855   1          return 0;
4856   1      }
4857          
4858          #else
              
              BYTE AlignControl(void)
              {
                  BYTE CommandCode, CPCode, ValueL, RetValueH, RetValueL, PageValue;
                  BYTE TPValue;
                  WORD WordValue, ValueH;
                      WORD XDATA g_wFDCRCValue = 0;
              #if JRY_Color_Tool_Functing
                  BYTE  XDATA Resault;
               #endif
                  CommandCode = DDCBuffer[1];
                  PageValue = 0;
              
              
                  
                  if (CommandCode == SETVCPFeature)
                  // 1-1
                  {
                      CPCode = DDCBuffer[2];
                      RetValueH = DDCBuffer[3];
                      RetValueL = DDCBuffer[4];
                      WordValue = ((WORD)DDCBuffer[3] << 8) | ((WORD)DDCBuffer[4]);
                  }
                  else if (CommandCode == SETPagedVCP)
                  // 1-5
                  {
                      PageValue = DDCBuffer[2];
                      CPCode = DDCBuffer[3];
                      RetValueH = DDCBuffer[4];
                      RetValueL = DDCBuffer[5];
                      WordValue = ((WORD)DDCBuffer[4] << 8) | ((WORD)DDCBuffer[5]);
                  }
                  else if (CommandCode == GETVCPFeature)
                  // 1-2
                  {
                      CPCode = DDCBuffer[2];
                  }
                  else if (CommandCode == GETPagedVCP)
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 81  

                  // 1-4
                  {
                      PageValue = DDCBuffer[2];
                      CPCode = DDCBuffer[3];
                  }   
                 else
                 {
                      RetValueH = CAP_VCP[4];
                      RetValueL = DVI_CAP_VCP[5];   
                              DDCBuffer[0] = 0x80;
                              return 0;
                 }
                      
              
                 if (CommandCode == GETVCPFeature || CommandCode == GETPagedVCP)
                  {
                      //Initial-----------------------Start
                      if (CommandCode == GETVCPFeature)
                      {
                          if(CPCode==TPV_App_Command)
                              {
                              DDCBuffer[0] = 0x88;
                              DDCBuffer[1] = 0x02;
                              DDCBuffer[2] = 0x00;
                              DDCBuffer[3] = IMenu_Application;
                              //DDCBuffer[4] = SIORxBuffer[1];//ExtByte
                              }
                          else
                              {
                          DDCBuffer[0] = 0x88;
                          DDCBuffer[1] = 0x02;
                          DDCBuffer[2] = 0x00;
                          DDCBuffer[3] = CPCode;
                          DDCBuffer[4] = 0x01;
                          ValueH = 0x00;
                          ValueL = 0xFF;
                          RetValueH = 0x00;
                          TPValue = 0x01;
                      }
                      }
                      else
                      {
                          DDCBuffer[0] = 0x89;
                          DDCBuffer[1] = 0xC7;
                          DDCBuffer[2] = 0x00;
                          DDCBuffer[3] = PageValue;
                          DDCBuffer[4] = CPCode;
                          DDCBuffer[5] = 0x01;
                          ValueH = 0x00;
                          ValueL = 0xFF;
                          RetValueH = 0x00;
                          TPValue = 0x01;
                      }
                      //Initial-----------------------End
                      //Setting---------------------------------Start
                      if (CPCode == NewControl && PageValue == 0)
                      {
                           /*if(DDCCINewControlFlag)
                          RetValueL = 2;
                          else*/
                          RetValueL = 1;
                          ValueL = 2;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 82  

                      }  
                 #if ENABLE_HDMI_DRR_MCCS
                      else if(CPCode == VCP_FREESYNC_MODE)
                      {   
                          TPValue = 0x00;
                          ValueH = 0x00;
                          ValueL = 0x01;
                          RetValueH = 0x00;
                          if(UserprefFreeSyncMode)
                              RetValueL=1;
                          else
                              RetValueL =0;// USER_PREF_FREESYNCMODE;
                      }
              #endif
                              
                      #if ColorTool_Clear_Time
                      
                      else if(CPCode == GetUserTime&& PageValue == 0)
                      {
                              #if  Show_BackLightTimeValue
                                      
                              TPValue = 0x00;
                              ValueH          =BlacklitTime_H;
                              ValueL          =0;
                              RetValueH       =BlacklitTime_M;
                              RetValueL       =BlacklitTime_S;        
                              
                              #endif
                      }
                              //*/
                      else if(CPCode == CleanUsedTime && PageValue == 0)
                      {
                              if (PowerOnFlag)
                                      Set_DDCCResetTimeFlag();
                      }
                              
                      else if(CPCode == AutoColorDDCCI&& PageValue == 0)
                      {
                              
                                      if(SrcInputType== Input_VGA)
                                      {                       
                                              Set_DDCCIAutoColorFlag();
                                      }
                      }
                              
                      #endif
                        else
                      {
                          DDCBuffer[2] = 0x01;
                          RetValueL = 0x00;
                          ValueH = 0xFF;
                          ValueL = 0xFF;
                      }
                      //Setting---------------------------------End
                      //Transmission----------------------------Start
                      if (CommandCode == GETVCPFeature)
                      {
                          if(CPCode==TPV_App_Command)
                              {
                                      DDCBuffer[5] = ValueH;
                                      DDCBuffer[6] = ValueL;
                                      DDCBuffer[7] = RetValueH;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 83  

                                      DDCBuffer[8] = RetValueL;
                              }
                              else
                              {
                          DDCBuffer[4] = TPValue;
                          DDCBuffer[5] = ValueH;
                          DDCBuffer[6] = ValueL;
                          DDCBuffer[7] = RetValueH;
                          DDCBuffer[8] = RetValueL;
                              }
                          return 8;
                      }
                      else
                      {
                          DDCBuffer[5] = TPValue;
                          DDCBuffer[6] = ValueH;
                          DDCBuffer[7] = ValueL;
                          DDCBuffer[8] = RetValueH;
                          DDCBuffer[9] = RetValueL;
                          return 9;
                      }
                      //Transmission----------------------------End
                  }
              
                  //SetValue------------------------------------------------------Start
                  else if (CommandCode == SETVCPFeature || CommandCode == SETPagedVCP)
                  {
                    /*
                      //if(!DisplayLogoFlag)
                     // Osd_Hide();
                     */
                      DDCBuffer[2] = 0x00; // Result Code
                      ValueH = 0x00;
                      ValueL = 0xFF;
                      TPValue = 0x01;
              
              #if JRY_Color_Tool_Functing
                      if(CPCode == 0x7B && PageValue == 0)
                     {
                          Resault=JRYColorToolControl();
                     }
                        else
              #endif
                      {
                          DDCBuffer[2] = 0x01;
                      }
                      //Setting----------------------------------End
                      //Transmission-----------------------------Start
                      if (CommandCode == SETVCPFeature)
                      {
                        #if  JRY_Color_Tool_Functing
                         if(CPCode == 0x7B)   
                          return Resault;
                         else
                      #endif
                              //else
                                   return 9;
                      }
                      else
                      {
                          DDCBuffer[0] = 0x89;
                          DDCBuffer[1] = 0xC7;
C51 COMPILER V9.01   DDC2BI                                                                03/09/2023 15:39:13 PAGE 84  

                          DDCBuffer[3] = PageValue;
                          DDCBuffer[4] = CPCode;
                          DDCBuffer[5] = TPValue;
                          DDCBuffer[6] = ValueH;
                          DDCBuffer[7] = ValueL;
                          DDCBuffer[8] = RetValueH;
                          DDCBuffer[9] = RetValueL;
                          return 9;
                      }
                      //Transmission-------------------------------End
                  }
                  else
                  {
                              AOCAlign();
                   }
                  DDCBuffer[0] = 0x80;
                  return 0;
              }
              
              #endif
5103          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6138    ----
   CONSTANT SIZE    =    513    ----
   XDATA SIZE       =   ----       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      17
   IDATA SIZE       =      3    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
