C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MENUFUNC
OBJECT MODULE PLACED IN .\obj\MenuFunc.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\..\UI\HkcOsd\MenuFunc.c OPTIMIZE(SIZE) BROWSE INCDIR(..\..\DRIVER\INC;.
                    -.\..\KERNEL\SCALER\INC;..\..\KERNEL\SYSTEM\INC;..\..\LIB\INC;..\..\PANEL\INC;..\..\BOARD;..\..\DRIVER\INC;..\..\KERNEL\S
                    -YSTEM\INC\AOC2011;..\..\DRIVER\extDEVICE\INC;..\..\MODEL;..\..\CONFIG;..\..\PANEL;..\..\UI\F_LOGO\INC;..\..\UI\HkcOsd\IN
                    -C) DEFINE(ModelName=JRY_TESTBOARD_C_BOARD) DEBUG OBJECTEXTEND PRINT(.\list\MenuFunc.lst) OBJECT(.\obj\MenuFunc.obj)

line level    source

   1          #include "types.h"
   2          #include "board.h"
   3          #include "global.h"
   4          #include "keypaddef.h"
   5          #include "menudef.h"
   6          #include "ms_reg.h"
   7          #include "debug.h"
   8          #include "msosd.h"
   9          #include "power.h"
  10          #include "misc.h"
  11          #include "autofunc.h"
  12          #include "nvram.h"
  13          #include "userpref.h"
  14          #include "mstar.h"
  15          #include "ms_rwreg.h"
  16          #include "adjust.h"
  17          #include "mcu.h"
  18          #include "menustr.h"
  19          #include "Gamma.h"
  20          #include "ddc2bi.h"
  21          #include "GPIO_DEF.h"
  22          #include "drvosd.h"
  23          #include "msosdfunction.h"
  24          #include "drvadc.h"
  25          #include "menufunc.h"       //2012.08.14 Stone.yu
  26          
  27              #include "MsDLC.H"
  28              #include "MsACE.H"
  29              #include "MsRegTV.h"
  30              #include "Panel.h"
  31          
  32          #if ENABLE_HDCP
  33              #include "MsHDCP.h"
  34          #endif
  35          #if ENABLE_RTE
                  #include "drvmsovd.h"
              #endif
  38          #if ENABLE_HDMI
  39          #include "MsHDMI.h"
  40          #include "msHDMIACE.h"
  41          #endif
  42          #if 1//USEFLASH
  43              #include "msflash.h"
  44          #endif 
  45          #if MS_PM
  46          #include "MS_PM.h"
  47          #endif
  48          #include "MsID_V1.h"
  49          #ifdef TSUMXXT//#if( ChipID == TSUMXXT )                //110311 Modify
              #include "msADC.h"
              #endif
  52          #if PanelminiLVDS || PANEL_VCOM_ADJUST  //110229 Modify
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 2   

              #include "msMiniLVDSI2c.h"
              #endif
  55          
  56          #if CHIP_ID==CHIP_TSUMU
              #include "msscaler.h"
              #elif CHIP_ID == CHIP_TSUM2
              #include "msscaler_2.h"
              #endif
  61          
  62          #if ENABLE_FREESYNC
              #include "ComboApp.h"
              #endif
  65          
  66          #include "panel_mwe_default.h"
  67          ////////////////////////////////////
  68          #include "drvMcu.h"
  69          #include "drvmStar.h"
  70          ///////////////////////////////////
  71          
  72          void SaveUserPref(void);
  73          void ReadWarm1Setting(void);
  74          void ReadWarm2Setting(void);
  75          void ReadNormalSetting(void);
  76          void ReadCool1Setting(void);
  77          void ReadCool2Setting(void);
  78          void ReadSRGBSetting(void);
  79          extern Bool ExecuteKeyEvent(MenuItemActionType menuAction);
  80          #if FreeSyncSwitchEDID  
              extern Bool  FreeSyncEDIDSwitch(BYTE Input, BYTE OnOff);
              #endif
  83          #if Enable_Expansion
  84              void SetExpansionMode(void);
  85              Bool AdjustExpansionMode(MenuItemActionType action);
  86          #endif
  87          WORD DecIncValue(MenuItemActionType action, WORD value, WORD minValue, WORD maxValue, BYTE step);
  88          WORD GetScale100Value(WORD value, WORD minValue, WORD maxValue);
  89          void SetYCMColor(MenuItemActionType action, WORD color, WORD value);
  90          void SetECO(void);
  91          void ReadColorTempSetting(void);
  92          void ReadUserSetting(void);
  93          extern void mStar_SetUserPref(void);
  94          #if Enable_Gamma
              extern void mStar_SetupGamma(BYTE GamaMode);
              #endif
  97          #if ENABLE_DeltaE
              extern void LoadDeltaEColorMode(BOOL bWindow, BYTE ModeIndex, BOOL Enable);//Hans 120223 need modify
              #endif
 100          
 101          
 102          
 103          
 104          #if  ENABLE_OSD_LowBlueLight  
 105          WORD DecIncValueCirculate( MenuItemActionType action, WORD value, WORD minValue, WORD maxValue, BYTE step 
             -);
 106          #endif
 107          #if 0      
              extern Bool AdjustSuperResolution(void);
              extern Bool SetSR_DEMOSize(BYTE ucSize,WORD DEMO_Hsize);
              #endif
 111          //void Save9300KSetting(void);
 112          //void Save6500KSetting(void);
 113          
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 3   

 114          BYTE* code ColorTempPtr[][5]=
 115          {
 116            { &UserPrefRedColorWarm1, &UserPrefGreenColorWarm1, &UserPrefBlueColorWarm1},
 117          #if CT_7500K_ENABLE     
                {&UserPrefRedColorNormal, &UserPrefGreenColorNormal, &UserPrefBlueColorNormal},
              #endif  
 120            {&UserPrefRedColorCool1, &UserPrefGreenColorCool1, &UserPrefBlueColorCool1},
 121            #if CT_sRGB_ENABLE
                {&UserPrefRedColorSRGB, &UserPrefGreenColorSRGB, &UserPrefBlueColorSRGB},
                #endif
 124            {&UserPrefRedColorUser, &UserPrefGreenColorUser, &UserPrefBlueColorUser},
 125          };
 126          
 127          #if LowBlueLightType == LowBlueLight_SharpFunc
              BYTE code LBLColorTempPtr[5][3]=
              {
                {128,128,128},
                {128,128,118},
                {128,128,108},
                {128,128,98},
                {128,128,88},
              };
              #endif
 137          
 138          static  xdata g8TempValue;
 139          
 140          #if MWEFunction
 141              //////////////////////////////////////////////////////////////////////////
 142              // Matrix for convert to sRGB space
 143              //////////////////////////////////////////////////////////////////////////
 144              code short tSRGB[3][3] =
 145              {
 146              { 1096, -43, -28 }, // R  1.0694, -0.0424, -0.0270
 147              { - 21,   1063, -18 }, // G -0.0204,  1.0376, -0.0172
 148              { - 1,   34,   991 }  // B -0.0009,  0.0330,  0.9679
 149          
 150              };
 151              code short tNormalColorCorrectionMatrix[3][3] =
 152              {
 153                  { 1024,    0,           0},
 154             {      0,    1024,           0},
 155             {    0,     0,               1024}
 156          };
 157            
 158                  
 159              //DLC Table......
 160              BYTE code t_MWEDLC_Linear_Table[] =
 161              {
 162             0x07,0x17,0x27,0x37,0x47,0x57,0x67,0x77,0x87,0x97,0xA7,0xB7,0xC7,0xD7,0xE7,0xF7,
 163             0x87,0x9B,0x0F,0xC2,0xBD,0x4E,0xC6,0xFD,0xF3,0x3E,0xE9,0x35,0x75,0xED,0x76,0x8D,
 164             0xC1,0x74,0xD4,0x3C,0x3A,0x18,0xE0,0x0A,0xD6,0xE3,0x33,0x0C,0x0A,0x84,0xB7,0xA0,
 165              };
 166              code short t_Normal_ColorSettingTable[][3] =
 167             {
 168             0x0400, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000,
 169             0x0400,-0x03CC, 0x03CC,-0x00A6, 0x02B3,-0x0534, 0x06CB,-0x06C1,
 170            -0x07B3, 0x057D, 0x0676,-0x065D, 0x0289, 0x0336,-0x0106, 0x0015,
 171            -0x0831, 0x0100,-0x0000, 0x0000,-0x0000, 0x0000, 0x0000, 0x0000,
 172             };
 173          
 174          
 175          
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 4   

 176          #if 0
              void IndependentColorControl(void)
              {
                  BYTE i,j;
                  
              #if CHIP_ID>= CHIP_TSUMV
              
                  // 111129 coding
                  for(i=0;i<3;i++)    // define range R/G/B
                  msWriteByte(SC9_04+i, tColorRangeTbl[i]);
              
                  for(i=0;i<6;i++) // active range R/G/B/C/M/Y
                  msWriteByte(SC9_08+i, tColorActiveRangeTbl[i]);
              
                  if (FullEnhanceFlag )
                      j=0;
                  else if (SkinFlag )
                      j=1;
                  else if(BlueFlag )
                      j=2;
                  else if(GreenFlag )
                      j=3;
                  else if ( ColorAutoDetectFlag)
                      j=4;
              
                  for(i=0;i<6;i++) // saturation R/G/B/C/M/Y
                      msWriteByte(SC9_14+i, tColorControlSatTbl[j][i]);
              
                  for(i=0;i<6;i++) // hue R/G/B/C/M/Y
              
                      msWriteByte(SC9_0E+i, tColorControlHueTbl[j][i]);
              
                  for(i=0;i<6;i++) // brightness R/G/B/C/M/Y
                      msWriteByte(SC9_1A+i, tColorControlBriTbl[j][i]);
              #elif CHIP_ID==CHIP_TSUMU
                  // 111129 coding
                  for(i=0;i<3;i++)    // define range R/G/B
                  msWriteByte(SC9_04+i, tColorRangeTbl[i]);
              
                  for(i=0;i<6;i++) // active range R/G/B/C/M/Y
                  msWriteByte(SC9_08+i, tColorActiveRangeTbl[i]);
              
                  if (FullEnhanceFlag )
                      j=0;
                  else if (SkinFlag )
                      j=1;
                  else if(BlueFlag )
                      j=2;
                  else if(GreenFlag )
                      j=3;
                  else if ( ColorAutoDetectFlag)
                      j=4;
              
                  for(i=0;i<6;i++) // saturation R/G/B/C/M/Y
                      msWriteByte(SC9_14+i, tColorControlSatTbl[j][i]);
              
                  for(i=0;i<6;i++) // hue R/G/B/C/M/Y
              
                      msWriteByte(SC9_0E+i, tColorControlHueTbl[j][i]);
              
                  for(i=0;i<6;i++) // brightness R/G/B/C/M/Y
                      msWriteByte(SC9_1A+i, tColorControlBriTbl[j][i]);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 5   

              
              #else
              
                  // 111129 coding
                  for(i=0;i<3;i++)    // define range R/G/B
                  msWriteByte(SC6_31+i, tColorRangeTbl[i]);
              
                  for(i=0;i<6;i++) // active range R/G/B/C/M/Y
                  msWriteByte(SC6_34+i, tColorActiveRangeTbl[i]);
              
                  if (FullEnhanceFlag )
                      j=0;
                  else if (SkinFlag )
                      j=1;
                  else if(BlueFlag )
                      j=2;
                  else if(GreenFlag )
                      j=3;
                  else if ( ColorAutoDetectFlag)
                      j=4;
              
                  for(i=0;i<6;i++) // saturation R/G/B/C/M/Y
                      msWriteByte(SC6_3A+i, tColorControlSatTbl[j][i]);
              
                  for(i=0;i<6;i++) // hue R/G/B/C/M/Y
                  
                      msWriteByte(SC6_40+i, tColorControlHueTbl[j][i]);
                  
                  for(i=0;i<6;i++) // brightness R/G/B/C/M/Y
                      msWriteByte(SC6_46+i, tColorControlBriTbl[j][i]);
              #endif
                  
                  if(DemoFlag)
                  {
                      ICE_MAIN_CTRL(0);
                      ICE_SUB_CTRL(1);
                  }
                  else
                  {
                      ICE_SUB_CTRL(0);
                      ICE_MAIN_CTRL(1);
                  }
              
              }
                 
              #if !ENABLE_HDMI
                  void SetColorBoostWindow(BYTE mode)
                  {
                      if (DemoFlag)
                          mode = COLORBOOST_HALF;
                      if (mode != COLORBOOST_OFF)
                      {
                          if (DemoFlag)
                              msAdjustVideoContrast( SUB_WINDOW, DefContrastBase + DefContrast );
                          else
                              msAdjustVideoContrast( SUB_WINDOW, DefContrastBase + UserPrefContrast );
                                          
                          if (mode == COLORBOOST_HALF)
                          {
                              UserPrefBFHSize = PanelWidth / 2;
                              UserPrefBFVSize = PanelHeight;
                              UserPrefBFHStart = 0;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 6   

                              UserPrefBFVStart = 0;
                          }
                          else if (mode == COLORBOOST_FULL)
                          {
                              UserPrefBFHSize = PanelWidth;
                              UserPrefBFVSize = PanelHeight;
                              UserPrefBFHStart = 0;
                              UserPrefBFVStart = 0;
                          }
                                      if(DemoFlag)    
                                       { 
                                         msAccSetup(UserPrefBFHStart, UserPrefBFHSize, UserPrefBFVStart, UserPrefBFVSize);
                                         msAccOnOff(1);
                                       }
              
                      }
                      else
                      // COLORBOOST_OFF
                      {
                          msAccOnOff(0);
                      }
                  }
              #endif
                  void SetColorEnhance(bit enable)
                  {
                      BYTE *pColorTable;
                      enable = 1;
                              
              
                      if (UserPrefDcrMode)
                      {
                              pColorTable = ( BYTE * )t_Normal_ColorSettingTable;
                              LoadACETable(SUB_WINDOW, pColorTable, DefHue, DefSaturation, 0x80 ); //  UserPrefSubContrast  );
                              msAccOnOff(1);
                              msDlcOnOff(1);
                      }
                      else if (FullEnhanceFlag || SkinFlag || BlueFlag || GreenFlag || DemoFlag || ColorAutoDetectFlag)
                      {
                      
                          if (FullEnhanceFlag || ColorAutoDetectFlag || GreenFlag|| BlueFlag|| SkinFlag)
                                   IndependentColorControl();
                          else
                          {
                              //msWriteByte(0x00, 0x06);
                              //msWriteByte(0x30, 0x00);
                              //msWriteByte(0x00, 0x00);
                              ICE_MAIN_CTRL(0);
                              ICE_SUB_CTRL(0);
                          }
                          if (GreenFlag || SkinFlag)
                          {
                              //msWriteByte(BK0_00, 0x03);
                              //msWriteByte(BK3_72, 0x6a);
                              //msWriteByte(BK3_73, 0x6a);
                              //msWriteByte(BK3_74, 0x6a);
                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x6a, 0x6a, 0x6a);
                              
                          }
                          else if (ColorAutoDetectFlag)
                          {
                              //msWriteByte(BK0_00, 0x03);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 7   

                              //msWriteByte(BK3_72, 0x60);
                              //msWriteByte(BK3_73, 0x60);
                              //msWriteByte(BK3_74, 0x60);
                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x60, 0x60, 0x60);
                          }
                          else
                          {
                              //msWriteByte(BK0_00, 0x03);
                              //msWriteByte(BK3_72, 0x70);
                              //msWriteByte(BK3_73, 0x70);
                              //msWriteByte(BK3_74, 0x70);
                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x70, 0x70, 0x70);
                          }
                      }
                              else
                      {
                              //msWriteByte(0x00, 0x06);
                              //msWriteByte(0x30, 0x00);
                              //msWriteByte(0x00, 0x00);
                              ICE_MAIN_CTRL(0);
                              ICE_SUB_CTRL(0);
                       }
                  }
              
              #if ENABLE_HDMI
              void SetColorBoostWin( BYTE mode )
              {
                if( DemoFlag)
                    mode =  COLORBOOST_HALF;
              
                if( mode != COLORBOOST_OFF)
                {
                      if(IsColorspaceRGB()&& !SETUP_PATH_R2Y())       //130608 xiandi
                          msAdjustPCContrast( MAIN_WINDOW, UserPrefContrast );        //120611 Modify
                      else
                          msAdjustVideoContrast( MAIN_WINDOW, UserPrefContrast );     //120611 Modify
                          //msAdjustVideoContrast( SUB_WINDOW, DefContrastBase + UserPrefContrast );
                              if (DemoFlag)   //120922 Modify
                                      msAdjustVideoContrast( SUB_WINDOW, DefContrastBase + DefContrast );
              
                    if(mode == COLORBOOST_HALF )
                    {
                        UserPrefBFHSize = PanelWidth / 2;
                        UserPrefBFVSize = PanelHeight;
                        UserPrefBFHStart = 0;
                        UserPrefBFVStart = 0;
                    }
                    else if(mode == COLORBOOST_FULL)
                    {
                        UserPrefBFHSize = PanelWidth ;
                        UserPrefBFVSize = PanelHeight;
                        UserPrefBFHStart = 0;
                        UserPrefBFVStart = 0;
                    }
              
                        if(DemoFlag)
                              {
                              msAccSetup( UserPrefBFHStart, UserPrefBFHSize, UserPrefBFVStart, UserPrefBFVSize );
                              if(IsColorspaceRGB())   //130608 xiandi
                                      msAccOnOff(1);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 8   

                               else 
                                      {               //130110_23 Henry
                                      msWriteByte(SC0_5C, msReadByte(SC0_5C)|BIT3);
                              #if CHIP_ID==CHIP_TSUMU //121211 Modify
                                      msAccOnOff( 1 );
                              #endif
                                      }
                              }
                        else
                              {
                              if(IsColorspaceRGB())   //130608 xiandi
                                      msAccOnOff(0);
                               else 
                                      {                       //130110_23 Henry
                                      msWriteByte(SC0_5C, msReadByte(SC0_5C)&~BIT3);          
                              #if CHIP_ID==CHIP_TSUMU //121211 Modify
                                      msAccOnOff( 0 );
                              #endif
                                      }
                              }
                              
                }
                else // COLORBOOST_OFF
                {
                        msAccSetup( 0, 0, 0, 0 );
                  //msAccOnOff( 0 );
                }
              
              }
              
              void SetColorMatrix( void )
              {
                  BYTE *pColorTable;
                      
                  if( UserPrefDcrMode)
                  {
                      pColorTable = ( BYTE * )t_Normal_ColorSettingTable;
                              LoadACETable(SUB_WINDOW, pColorTable, UserPrefHue, UserPrefSaturation, 0x80 ); //  UserPrefSubContrast  
             -);
                      //msAccOnOff( 1 );
                      //msDlcOnOff( 1 );
                  }
                  else  if ( FullEnhanceFlag || SkinFlag || BlueFlag || GreenFlag || DemoFlag ||ColorAutoDetectFlag)   /
             -/NormalSkin+GreenENhance+BlueEnhance
                  {
                      
                          if (FullEnhanceFlag || ColorAutoDetectFlag || GreenFlag|| BlueFlag|| SkinFlag)
                                    IndependentColorControl();
                          else
                          {
                              //msWriteByte(0x00, 0x06);
                              //msWriteByte(0x30, 0x00);
                              //msWriteByte(0x00, 0x00);
                              ICE_MAIN_CTRL(0);
                              ICE_SUB_CTRL(0);
                          }
                                 if (GreenFlag || SkinFlag)
                          {
                              //msWriteByte(BK0_00, 0x03);
                              //msWriteByte(BK3_72, 0x6a);
                              //msWriteByte(BK3_73, 0x6a);
                              //msWriteByte(BK3_74, 0x6a);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 9   

                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x7a, 0x7a, 0x7a);
                             // msAdjustSubBrightness(SUB_WINDOW, 0x6a, 0x6a, 0x6a);
                          }
                          else if (ColorAutoDetectFlag)
                          {
                              //msWriteByte(BK0_00, 0x03);
                              //msWriteByte(BK3_72, 0x60);
                              //msWriteByte(BK3_73, 0x60);
                              //msWriteByte(BK3_74, 0x60);
                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x79, 0x79, 0x79);
                            //  msAdjustSubBrightness(SUB_WINDOW, 0x60, 0x60, 0x60);
                          }
                          else
                          {
                              //msWriteByte(BK0_00, 0x03);
                              //msWriteByte(BK3_72, 0x70);
                              //msWriteByte(BK3_73, 0x70);
                              //msWriteByte(BK3_74, 0x70);
                              //msWriteByte(BK0_00, 0x00);
                              msAdjustSubBrightness(SUB_WINDOW, 0x7C, 0x7C, 0x7C);
                          }
                      }
                      else
                      {
                          //msWriteByte(0x00, 0x06);
                          //msWriteByte(0x30, 0x00);
                          //msWriteByte(0x00, 0x00);
                          ICE_MAIN_CTRL(0);
                          ICE_SUB_CTRL(0);
                  }
              }
              
              void SetColorSpace( void )
              {
                  #if ENABLE_HDMI
                  BYTE XDATA ucDomain;
                  #endif
              
                  #if ENABLE_HDMI
                  ucDomain = 0x00;
                  if(!IsColorspaceRGB())      //130608 xiandi
                      ucDomain = 0xFF;
                  #endif
              
                  if ( DemoFlag ||BlueFlag||SkinFlag||GreenFlag||ColorAutoDetectFlag||FullEnhanceFlag)
                  {
                      #if ENABLE_HDMI
                      if (ucDomain)
                      {
                      
                
                          if(DemoFlag)
                              {
                              //SetMainWinVideoDomain(ucDomain);              //SetMainWinColorControl(ucDomain);             
                              msWriteByte(SC0_5C, msReadByte(0x5C)|BIT3);
                              }
                              else
                              {
                                      msWriteByte(0x02, msReadByte(0x02)|BIT3);
                                      msWriteByte(SC0_5C, msReadByte(0x5C)&~BIT3);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 10  

                              }
                      }
                      else
                      #endif
                      if(DemoFlag)
                      msAccOnOff( 1 );
                  }
                  else
                  {
                      #if ENABLE_HDMI && CHIP_ID!=CHIP_TSUMU  //121211 Modify
                      if (ucDomain)
                          msWriteByte(SC0_5C, msReadByte(0x5C)&~BIT3);
                      else
                      #endif
                          msAccOnOff(0);
                      #if ENABLE_HDMI
                      //SetMainWinVideoDomain(0);     //SetMainWinColorControl(0);
                      if (ucDomain)
                          msWriteByte(0x02, msReadByte(0x02)|BIT3);
                      #endif
                  }
              }
              #endif
              
              //================================================================================
              Bool AdjustColorBoostMode(MenuItemActionType action)
              {
                  action = 0;
                  if (!DemoFlag)
                  {
                      Clr_DemoFlag();
                  }
                  Clr_SkinFlag();
                  Clr_GreenFlag();
                  Clr_BlueFlag();
                  Clr_ColorAutoDetectFlag();
                  Clr_PictureBoostFlag();
              
                  //if (UserPrefDcrMode)
                      //SetECO();
                  UserPrefDcrMode = 0;
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
                  
                  if (FullEnhanceFlag)
                  // clr
                  {
                      Clr_FullEnhanceFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_OFF);   
                      #else
                      SetColorBoostWindow(COLORBOOST_OFF);
                      #endif
                  }
                  else
                  // set
                  {
                      Set_FullEnhanceFlag();
                      
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 11  

              
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_FULL);  
                      #else
                      SetColorBoostWindow(COLORBOOST_FULL);
                      #endif
                  }
                  #if ENABLE_HDMI
                  SetColorMatrix();
                  SetColorSpace();
                  #else
                  SetColorEnhance(1);
                  #endif
                  
                  #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                  #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #endif
                  //Benz 2007.4.24   9:50:19          Osd_Draw4Num(7,1,UserPrefColorFlags);
                  return TRUE;
              }
              
              //================================================================================
              Bool AdjustSkinProtectMode(MenuItemActionType action)
              {
                  action = action;
                  if (!DemoFlag)
                  {
                      Clr_DemoFlag();
                  }
                  Clr_GreenFlag();
                  Clr_FullEnhanceFlag();
                  Clr_BlueFlag();
                  Clr_ColorAutoDetectFlag();
                  Clr_PictureBoostFlag();
                  
              
                  //if (UserPrefDcrMode)
                      //SetECO();
                  UserPrefDcrMode = 0;
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
              
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
              
                  if (SkinFlag)
                  {
                      Clr_SkinFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_OFF);        
                      #else
                      SetColorBoostWindow(COLORBOOST_OFF);
                      #endif
                  }
                  else
                  {
                      Set_SkinFlag();
                      
                      #if ENABLE_HDMI
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 12  

                      SetColorBoostWin(COLORBOOST_FULL);        
                      #else
                      SetColorBoostWindow(COLORBOOST_FULL);
                      #endif
                  }
                  #if ENABLE_HDMI
                  SetColorMatrix();
                  SetColorSpace();    
                  #else
                  SetColorEnhance(1);
                  #endif
                  
                  #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                  #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #endif
                  //Benz 2007.4.24   9:50:24  Osd_Draw4Num(6,1,UserPrefColorFlags);
                  return TRUE;
              }
              Bool AdjustGreenEnhanceMode(MenuItemActionType action)
              {
                  action = action;
                  if (!DemoFlag)
                  {
                      Clr_DemoFlag();
                  }
                  Clr_SkinFlag();
                  Clr_FullEnhanceFlag();
                  Clr_BlueFlag();
                  Clr_ColorAutoDetectFlag();
                  Clr_PictureBoostFlag();
              
                  //if (UserPrefDcrMode)
                      //SetECO();
                  UserPrefDcrMode = 0;
              
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
                  
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
                  
                  if (GreenFlag)
                  {
                      Clr_GreenFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_OFF);
                      #else
                      SetColorBoostWindow(COLORBOOST_OFF);
                      #endif
                  }
                  else
                  {
                      Set_GreenFlag();
                      
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_FULL);
                      #else
                      SetColorBoostWindow(COLORBOOST_FULL);
                      #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 13  

                  }
                  #if ENABLE_HDMI
                  SetColorMatrix();
                  SetColorSpace();
                  #else
                  SetColorEnhance(1);
                  #endif
                  #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                  #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #endif
                  //Benz 2007.4.24   9:50:28          Osd_Draw4Num(5,1,UserPrefColorFlags);
                  return TRUE;
              }
              Bool AdjustBlueEnhanceMode(MenuItemActionType action)
              {
                  action = action;
                  if (!DemoFlag)
                  {
                      Clr_DemoFlag();
                  }
                  // color boost menu
                  Clr_FullEnhanceFlag();
                  Clr_GreenFlag();
                  Clr_SkinFlag();
                  Clr_ColorAutoDetectFlag();
                  
                  // picture boost menu
                  Clr_PictureBoostFlag();
                  // DCR function
                  //if (UserPrefDcrMode)
                      //SetECO();
                  UserPrefDcrMode = 0;
              
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
              
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
                  
                  if (BlueFlag)
                  {
                      Clr_BlueFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_OFF);
                      #else
                      SetColorBoostWindow(COLORBOOST_OFF);
                      #endif
                  }
                  else
                  {
                      Set_BlueFlag();
                      
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_FULL);
                      #else
                      SetColorBoostWindow(COLORBOOST_FULL);
                      #endif
                  }
                  #if ENABLE_HDMI
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 14  

                  SetColorMatrix();
                  SetColorSpace();
                  #else
                  SetColorEnhance(1);
                  #endif
                  #if !USEFLASH
                       NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                  #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #endif
                  //Benz 2007.4.24   9:50:33          Osd_Draw4Num(4,1,UserPrefColorFlags);
                  return TRUE;
              }
              
              Bool AdjustAutoDetectMode(MenuItemActionType action)
              {
                  action = action;
                  if (!DemoFlag)
                  // when demo on, don't clear the demo flag
                  {
                      Clr_DemoFlag();
                  }
                  // color boost menu
                  Clr_FullEnhanceFlag();
                  Clr_GreenFlag();
                  Clr_BlueFlag();
                  Clr_SkinFlag();
                  // picture boost menu
                  Clr_PictureBoostFlag();
                  // DCR function
                  //if (UserPrefDcrMode)
                      //SetECO();
                  UserPrefDcrMode = 0;
              
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
              
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
                  
                  if (ColorAutoDetectFlag)
                  {
                      Clr_ColorAutoDetectFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_OFF);
                      #else
                      msDlcOnOff(_DISABLE);
                      SetColorBoostWindow(COLORBOOST_OFF);
                      #endif
                  }
                  else
                  {
                      Set_ColorAutoDetectFlag();
                      #if ENABLE_HDMI
                      SetColorBoostWin(COLORBOOST_FULL);
                      #else
                      LoadDLCTable(t_MWEDLC_Linear_Table);
                      msDlcOnOff(_DISABLE);
                      SetColorBoostWindow(COLORBOOST_FULL);
                      #endif
                  }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 15  

                  #if ENABLE_HDMI
                  SetColorMatrix();
                  SetColorSpace();
                  #else
                  SetColorEnhance(1);
                  #endif
                  #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                  #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #endif
                  //Benz 2007.4.24   9:50:40          Osd_Draw4Num(3,1,UserPrefColorFlags);
                  return TRUE;
              }
              
              
              #if 0
              Bool AdjustDCBOff( MenuItemActionType action )
              {
                  action = action;
                  Clr_FullEnhanceFlag();
                  Clr_GreenFlag();
                  Clr_BlueFlag();
                  Clr_SkinFlag();
                  Clr_ColorAutoDetectFlag();
                  Clr_PictureBoostFlag();
                  
                  UserPrefDcrMode = 0;
                  UserPrefECOMode = ECO_Standard;
              
                  {
                    ICE_MAIN_CTRL(0);
                    ICE_SUB_CTRL(0);
                  }
                  SetECO();
                  if(DemoFlag)        //130624 Modify
                  {
                              msAdjustSubBrightness(SUB_WINDOW, 0x7c, 0x7c, 0x7c);
                  }
                  return TRUE;
                  
              }
              #endif
              
              
              
              
              #if 1  //2006-08-29 Andy
              Bool SetBFSize(BYTE ucSize)
              {
                  #if ENABLE_HDMI
                  BYTE XDATA ucDomain;
                  #endif
              
                  #if ENABLE_HDMI
                  ucDomain = 0x00;
                  if(!IsColorspaceRGB())      //130608 xiandi
                      ucDomain = 0xFF;
                  #endif
              
                  if (!PictureBoostFlag)
                  {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 16  

                      #if !ENABLE_HDMI
                      msAccOnOff(0);
                      msDlcOnOff(0);
                      #endif
                      UserPrefBFHSize = 0;
                      UserPrefBFVSize = 0;
                      UserPrefBFHStart = 0;
                      UserPrefBFVStart = 0;
                      UserPrefBFSize= ucSize = 1; //Benz 2007.4.14   14:34:23
                  }
                  else
                  {
                      if (ucSize == 1)  // H:5 V:5
                      {
                          UserPrefBFHSize = (DISPLAY_WIDTH+4) / 8;    //120204 Modify
                          UserPrefBFVSize = PanelHeight / 8; // / 5;
                      }
                      else if (ucSize == 2)          // H:5 V:3
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH / 5;                //120204 Modify
                          UserPrefBFVSize = PanelHeight / 5; // / 3;
                      }
                      else if (ucSize == 3)     //  H4 V:4
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH / 4;                //120204 Modify
                          UserPrefBFVSize = PanelHeight / 4;
                      }
                      else if (ucSize == 4)       //  H3 V:3
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH / 3;                //120204 Modify
                          UserPrefBFVSize = PanelHeight / 3;
                      }
                      else if (ucSize == 5)        //  H2 V:2
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH / 2;                //120204 Modify
                          UserPrefBFVSize = PanelHeight / 2;
                      }
                      else if (ucSize == 6)        //  H2 V:1
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH / 2;                //120204 Modify
                          UserPrefBFVSize = PanelHeight;
                      }
                      else if (ucSize == 7)       //  Full
                      {
                          UserPrefBFHSize = DISPLAY_WIDTH;                    //120204 Modify
                          UserPrefBFVSize = PanelHeight;
                      }
                              else    //120204 Modify
                              {
                              UserPrefBFHStart = 0;
                              UserPrefBFVStart = 0;
                              }
                              msAdjustVideoContrast( SUB_WINDOW, UserPrefSubContrast );
                              msAccSetup(UserPrefBFHStart *( DISPLAY_WIDTH - UserPrefBFHSize)/20 + HSTART_OFFSET, (UserPrefBFHStart *(
             - DISPLAY_WIDTH - UserPrefBFHSize)/20 + UserPrefBFHSize + HSTART_OFFSET), UserPrefBFVStart *( PanelHeight- UserPrefBFVSiz
             -e)/20, (UserPrefBFVStart *( PanelHeight- UserPrefBFVSize)/20 + UserPrefBFVSize));     //120204 Modify
                      #if ENABLE_HDMI
                      //msAdjustSubBrightness( UserPrefSubBrightness );
                              msAdjustSubBrightness( SUB_WINDOW, UserPrefSubBrightness, UserPrefSubBrightness, UserPrefSubBrightness )
             -;
                      #else
                      msAccOnOff(1);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 17  

                      #endif
                  }
                  
                  #if ENABLE_HDMI
                  if ( PictureBoostFlag)
                  {
                      #if ENABLE_HDMI && CHIP_ID!=CHIP_TSUMU  //121211 Modify
                      if (ucDomain)
                      {
                         // SetMainWinVideoDomain(ucDomain);  //SetMainWinColorControl(ucDomain);
                          msWriteByte(SC0_5C, msReadByte(0x5C)|BIT3);
                      }
                      else
                      #endif
                          msAccOnOff( 1 );
                  }
                  else
                  {
                      #if ENABLE_HDMI && CHIP_ID!=CHIP_TSUMU  //121211 Modify
                      if (ucDomain)
                          msWriteByte(SC0_5C, msReadByte(0x5C)&~BIT3);
                      else
                      #endif
                          msAccOnOff(0);
                      #if ENABLE_HDMI
                      //SetMainWinVideoDomain(0);     //SetMainWinColorControl(0);
                      if (ucDomain)
                          msWriteByte(0x02, msReadByte(0x02)|BIT3);
                      #endif
                  }
                  #endif
                  return TRUE;
              }
              
              #if ENABLE_HDMI
              Bool AdjustBrightFrameSize(BYTE ucSize)
              {
                if ( ucSize == 1 )        // H:5 V:5
                {
                    UserPrefBFHSize = DISPLAY_WIDTH /8;       //120204 Modify
                    UserPrefBFVSize = PanelHeight /8; // / 5;// 20130109
                }
                else if ( ucSize == 2 ) // H:5 V:3
                {
                    UserPrefBFHSize = DISPLAY_WIDTH / 5;      //120204 Modify
                    UserPrefBFVSize = PanelHeight /5; // / 3;// 20130109
                }
                else if ( ucSize == 3 ) //  H4 V:4
                {
                    UserPrefBFHSize = DISPLAY_WIDTH / 4;      //120204 Modify
                    UserPrefBFVSize = PanelHeight / 4;
                }
                else if ( ucSize == 4 ) //  H3 V:3
                {
                    UserPrefBFHSize = DISPLAY_WIDTH / 3;      //120204 Modify
                    UserPrefBFVSize = PanelHeight / 3;
                }
                else if ( ucSize == 5 ) //  H2 V:2
                {
                    UserPrefBFHSize = DISPLAY_WIDTH / 2;      //120204 Modify
                    UserPrefBFVSize = PanelHeight / 2;
                }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 18  

                else if ( ucSize == 6 ) //  H2 V:1
                {
                    UserPrefBFHSize = DISPLAY_WIDTH / 2;      //120204 Modify
                    UserPrefBFVSize = PanelHeight;
                }
                else if ( ucSize == 7 ) //  Full
                {
                    UserPrefBFHSize = DISPLAY_WIDTH;          //120204 Modify
                    UserPrefBFVSize = PanelHeight;
                }
              
                UserPrefBFHStart = 0;
                UserPrefBFVStart = 0;
                msAccSetup(UserPrefBFHStart *( DISPLAY_WIDTH - UserPrefBFHSize)/20 + HSTART_OFFSET, (UserPrefBFHStart *(
             - DISPLAY_WIDTH - UserPrefBFHSize)/20 + UserPrefBFHSize + HSTART_OFFSET), UserPrefBFVStart *( PanelHeight- UserPrefBFVSiz
             -e)/20, (UserPrefBFVStart *( PanelHeight- UserPrefBFVSize)/20 + UserPrefBFVSize));     //120204 Modify
                //msAccOnOff( 1 );
                      #if CHIP_ID==CHIP_TSUMU //121211 Modify
                      msAccOnOff( 1 );
                      #endif
              
                  return TRUE;
              }
              #endif
              //---------------------------------------------------------------
              Bool AdjustBFSize(MenuItemActionType action)
              {
                  WORD tempValue;
                  tempValue = DecIncValue(action, UserPrefBFSize, 1, 7, 1);
                  if (tempValue == UserPrefBFSize)
                  {
                      return FALSE;
                  }
                    UserPrefBFSize = tempValue;
                      UserPrefBFHStart = 0;   //120204 Modify
                      UserPrefBFVStart = 0;   //120204 Modify
                      //printData("UserPrefBFSize=%d",UserPrefBFSize);
                  #if ENABLE_HDMI
                  AdjustBrightFrameSize(UserPrefBFSize);      //
                  #else
                  SetBFSize(UserPrefBFSize);//SetBFSize();
                  #endif
                  return TRUE;
              }
              WORD GetBFSizeValue(void)
              {
                  return GetScale100Value(UserPrefBFSize, 0, 7);
              }
                      //---------------------------------------------------------------
                      Bool AdjustBFHstart(MenuItemActionType action)
                      {
                          WORD tempValue;
                          if (UserPrefBFSize == 1)
                          {
                              tempValue = DecIncValue(action, UserPrefBFHStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 2)
                          {
                              tempValue = DecIncValue(action, UserPrefBFHStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 3)
                          {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 19  

                              tempValue = DecIncValue(action, UserPrefBFHStart, 0, 20, 1);    //120112 Modify //120112 Modi
             -fy
                          }
                          else if (UserPrefBFSize == 4)
                          {
                              tempValue = DecIncValue(action, UserPrefBFHStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 5 || UserPrefBFSize == 6)
                          {
                              tempValue = DecIncValue(action, UserPrefBFHStart, 0, 20, 1);    //120112 Modify
                          }
                          else
                          {
                              tempValue = 0;
                          }
              /*                                              //130123_2 Henry For Can Not Adjust BFPosition After 25 In DP Source
                          if (tempValue == UserPrefHStart)
                          {
                              return FALSE;
                          }
              */
                          UserPrefBFHStart = tempValue;
                          tempValue = UserPrefBFHStart * ( DISPLAY_WIDTH - UserPrefBFHSize)/20 + HSTART_OFFSET;       //120204
             - Modify
                                      msAccSetup(tempValue, (UserPrefBFHSize + tempValue), UserPrefBFVStart *( DISPLAY_HEIGHT- UserPrefBFVSiz
             -e)/20, (UserPrefBFVStart *( DISPLAY_HEIGHT- UserPrefBFVSize)/20 + UserPrefBFVSize));  //120112 Modify
                          return TRUE;
                      }
                      WORD GetBFHstartValue(void)
                      {
                          if (UserPrefBFSize == 2)
                          {
                              return GetScale100Value(UserPrefBFHStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 3)
                          {
                              return GetScale100Value(UserPrefBFHStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 4)
                          {
                              return GetScale100Value(UserPrefBFHStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 5 || UserPrefBFSize == 6)
                          {
                              return GetScale100Value(UserPrefBFHStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 1)
                          {
                              return GetScale100Value(UserPrefBFHStart, 0, 20);       //120112 Modify
                          }
                          else
                          {
                              return 0;
                          }
                      }
                      //---------------------------------------------------------------
                      Bool AdjustBFVstart(MenuItemActionType action)
                      {
                          WORD tempValue;
                          if (UserPrefBFSize == 6 || UserPrefBFSize == 7)
                          {
                              tempValue = 0;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 20  

                          }
                          else if (UserPrefBFSize == 1)
                          {
                              tempValue = DecIncValue(action, UserPrefBFVStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 2)
                          {
                              tempValue = DecIncValue(action, UserPrefBFVStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 4)
                          {
                              tempValue = DecIncValue(action, UserPrefBFVStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 3)
                          {
                              tempValue = DecIncValue(action, UserPrefBFVStart, 0, 20, 1);    //120112 Modify
                          }
                          else if (UserPrefBFSize == 5)
                          {
                              tempValue = DecIncValue(action, UserPrefBFVStart, 0, 20, 1);    //120112 Modify
                          }
                          /*
                          if ( tempValue == UserPrefVStart )
                          {
                          return FALSE;
                          }
                           */
                          UserPrefBFVStart = tempValue;
                          tempValue = UserPrefBFVStart * ( DISPLAY_HEIGHT - UserPrefBFVSize) / 20;    //120112 Modify         //13
             -0117 Henry
                          //tempValue = UserPrefBFVStart * ( PanelHeight- UserPrefBFVSize) / 20;      //120112 Modify
                          msAccSetup(UserPrefBFHStart *( DISPLAY_WIDTH - UserPrefBFHSize)/20 + HSTART_OFFSET, UserPrefBF
             -HStart *( DISPLAY_WIDTH - UserPrefBFHSize)/20 + UserPrefBFHSize + HSTART_OFFSET, tempValue, (tempValue + UserPrefBFVSize
             -));        //120204 Modify
                          return TRUE;
                      }
                      WORD GetBFVstartValue(void)
                      {
                          if (UserPrefBFSize == 1)
                          {
                              return GetScale100Value(UserPrefBFVStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 2)
                          {
                              return GetScale100Value(UserPrefBFVStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 4)
                          {
                              return GetScale100Value(UserPrefBFVStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 3)
                          {
                              return GetScale100Value(UserPrefBFVStart, 0, 20);       //120112 Modify
                          }
                          else if (UserPrefBFSize == 5)
                          {
                              return GetScale100Value(UserPrefBFVStart, 0, 20);       //120112 Modify
                          }
                          else
                          {
                              return 0;
                          }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 21  

                      }
              //================================================================================
              Bool AdjustBF_Switch(MenuItemActionType action)
              {
                  action = action;
                  Clr_ColorAutoDetectFlag();
                  Clr_FullEnhanceFlag();
                  Clr_GreenFlag();
                  Clr_BlueFlag();
                  Clr_SkinFlag();
                  Clr_DemoFlag();
                  
              
                  //if (UserPrefDcrMode)
                      //SetECO();
                      UserPrefDCBMode = DCBMode_Off;  //120204 Modify
              
                  {
                    ICE_MAIN_CTRL(0);                         //120204 Modify
                    ICE_SUB_CTRL(0);                          //120204 Modify
                      }
                  UserPrefDcrMode = 0;
                      #if CHIP_ID == CHIP_TSUMC || CHIP_ID == CHIP_TSUMD||CHIP_ID == CHIP_TSUM9||CHIP_ID == CHIP_TSUMF        //130705
             - xiandi
                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                      #endif
                  UserPrefECOMode = ECO_Standard;
                  SetECO();
              
                  #if ENABLE_HDMI
                  msDlcOnOff(_DISABLE);
                  #endif
                  
                  if (PictureBoostFlag)
                  {
                      //msWriteByteMask(SC7_40, 0, BIT4); 
                      Clr_PictureBoostFlag();
                      #if ENABLE_HDMI
                      UserPrefBFSize = 1 ;    // recall default setting=> BFSize=1, position(0,0)
                      #endif
                      SetBFSize(UserPrefBFSize);//SetBFSize();
                      CSC_SUB_ENABLE(0);      //120204 Modify
                  }
                  else
                  {
                      Set_PictureBoostFlag();
                      //msWriteByteMask(SC7_40, BIT4, BIT4); 
                      if(SETUP_PATH_RGB())                    //121213 Modify
                              CSC_SUB_ENABLE(1);
                      else
                              CSC_SUB_ENABLE(0);
              
              
                      #if !ENABLE_HDMI
                      UserPrefBFSize = 1; // recall default setting=> BFSize=1, position(0,0)
                      #endif
                      SetBFSize(UserPrefBFSize);//SetBFSize();
                      #if !ENABLE_HDMI
                      SetColorEnhance(1);
                      #endif
                              
                      #if 1//!ENABLE_HDMI
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 22  

                              //msAdjustSubBrightness(UserPrefSubBrightness);
                              //msAdjustSubBrightness( SUB_WINDOW, UserPrefSubBrightness, UserPrefSubBrightness, UserPrefSubBrightness
             - );
                              //LoadACETable(SUB_WINDOW, t_Normal_ColorSettingTable, UserPrefHue, UserPrefSaturation, UserPrefSubContr
             -ast ); //  UserPrefSubContrast  );
                              mStar_AdjustContrast(UserPrefContrast); //120524 Modify
                      //msAdjustVideoContrastRGB(SUB_WINDOW, UserPrefSubContrast, 0x80, 0x80, 0x80);  //120524 Modify
                              msAdjustSubBrightness( SUB_WINDOW, UserPrefSubBrightness, UserPrefSubBrightness, UserPrefSubBrightness )
             -;
                              LoadACETable(SUB_WINDOW, ( BYTE * )t_Normal_ColorSettingTable, UserPrefHue, UserPrefSaturation, UserPref
             -SubContrast ); //  UserPrefSubContrast  );
                              //LoadACETable ( MAIN_WINDOW, ( BYTE * ) t_Normal_ColorSettingTable, DefHue, DefSaturation, UserPrefCont
             -rast ); // /UserPrefSubContrast
                              #endif
                  }
                  #if !USEFLASH
                              NVRam_WriteByte(nvrMonitorAddr(ColorFlag), UserPrefColorFlags);
                      #else
                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                      #endif
                  return TRUE;
              }
              #endif
                  //---------------------------------------------------------------
              #if 0
                  extern XDATA BYTE g_ucVideoSaturation;
                  extern XDATA BYTE g_ucVideoHue;
                  //================================================================================
                  Bool AdjustHue(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefHue, MIN_VIDEO_HUE, MAX_VIDEO_HUE, 1);
                      if (tempValue == UserPrefHue)
                      {
                          return FALSE;
                      }
                      UserPrefHue = tempValue;
                              msAdjustVideoHue( SUB_WINDOW, UserPrefHue );
                      return TRUE;
                  }
                  WORD GetHue100Value(void)
                  {
                      return GetScale100Value(UserPrefHue, MIN_VIDEO_HUE, MAX_VIDEO_HUE);
                  }
                  //================================================================================
                  Bool AdjustSaturation(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefSaturation, MIN_VIDEO_SATURATION, MAX_VIDEO_SATURATION, 1)
             -;
                      if (tempValue == UserPrefSaturation)
                      {
                          return FALSE;
                      }
                      UserPrefSaturation = tempValue;
                              msAdjustVideoSaturation( SUB_WINDOW, UserPrefSaturation );
                      return TRUE;
                  }
                  WORD GetSaturation100Value(void)
                  {
                      return GetScale100Value(UserPrefSaturation, MIN_VIDEO_SATURATION, MAX_VIDEO_SATURATION);
                  }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 23  

              
              #endif
                  //================================================================================
                  //================================================================================
                  Bool AdjustSubContrast(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefSubContrast, MinSubContrast, MaxSubContrast, 2);
                      if (tempValue == UserPrefSubContrast)
                      {
                          return FALSE;
                      }
                      UserPrefSubContrast = tempValue;
                              msAdjustVideoContrast( SUB_WINDOW, UserPrefSubContrast );
                      //NVRam_WriteByte( nvrMonitorAddr( SubContrast ), UserPrefSubContrast);
                      return TRUE;
                  }
                  WORD GetSubContrast100Value(void)
                  {
                      return GetScale100Value(UserPrefSubContrast, MinSubContrast, MaxSubContrast);
                  }
                  //================================================================================
                  Bool AdjustSubBrightness(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefSubBrightness, MinSubBrightness, MaxSubBrightness, 1);  //1
             -11223 Modify
                      if (tempValue == UserPrefSubBrightness)
                      {
                          return FALSE;
                      }
                      UserPrefSubBrightness = tempValue;
                      //msAdjustSubBrightness(UserPrefSubBrightness);
                              msAdjustSubBrightness( SUB_WINDOW, UserPrefSubBrightness, UserPrefSubBrightness, UserPrefSubBrightness )
             -;
                      return TRUE;
                  }
                  #if 0
                      WORD GetSubBrightnessValue(void)
                      {
                          return UserPrefSubBrightness;
                      }
                  #endif
                  WORD GetSubBrightness100Value(void)
                  {
                      return GetScale100Value(UserPrefSubBrightness, MinSubBrightness, MaxSubBrightness);
                  }
              #endif
1380          #endif
1381          //================================================================================
1382          WORD DecIncValue(MenuItemActionType action, WORD value, WORD minValue, WORD maxValue, BYTE step)
1383          {
1384   1          if (action == MIA_IncValue || action == MIA_InvDecValue)
1385   1          {
1386   2              if (value >= maxValue)
1387   2              {
1388   3                  return value;
1389   3              }
1390   2              minValue = value + step;
1391   2              if (minValue > maxValue)
1392   2              {
1393   3                  minValue = maxValue;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 24  

1394   3              }
1395   2              value = minValue;
1396   2          }
1397   1          else
1398   1          // Decrease value
1399   1          {
1400   2              if (value <= minValue)
1401   2              {
1402   3                  return value;
1403   3              }
1404   2              maxValue = value - step;
1405   2              if (maxValue < minValue)
1406   2              {
1407   3                  maxValue = minValue;
1408   3              }
1409   2              value = maxValue;
1410   2          }
1411   1          return value;
1412   1      }
1413          WORD GetScale100Value(WORD value, WORD minValue, WORD maxValue)
1414          {
1415   1          maxValue = (maxValue <= minValue)?minValue:(maxValue - minValue);
1416   1          //maxValue = maxValue - minValue;
1417   1          value = value - minValue;
1418   1          if (value > 650)
1419   1          {
1420   2              value /= 2;
1421   2              maxValue /= 2;
1422   2          }
1423   1          value = ((WORD)value *100+maxValue / 2) / maxValue;
1424   1          value %=101;
1425   1         return value;
1426   1      }
1427          extern BYTE  xdata MenuItemIndex;
1428          extern BYTE  xdata MenuPageIndex;
1429          Bool ResetOsdTimer(void)
1430          {
1431   1          if (!FactoryModeFlag)
1432   1          {
1433   2              
1434   2              OsdCounter = UserPrefOsdTime;
1435   2          }
1436   1      
1437   1              #if Hot_Corss_ColorSelect|| Hot_Corss_FY_ColorSelect || Hot_Corss_FND_Select
                      if (MenuPageIndex==HotCorssMenu)
                              OsdCounter=0;
                      #endif
1441   1              
1442   1        //  else if(MenuPageIndex == SettingMenu && MenuItemIndex == 0) // 20130409 TPV request 
1443   1       //   {
1444   1      //OsdCounter = 10;
1445   1       //   }
1446   1          return TRUE;
1447   1      }
1448          Bool EnablePowerDownCounter(void)
1449          {
1450   1      
1451   1          {
1452   2          #if  (DP_PRETEST || HDMI_PRETEST)
                      PowerDownCounter = 30;
                  #else
1455   2              PowerDownCounter = 6;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 25  

1456   2          #endif
1457   2          }
1458   1          //Set_ForcePowerSavingFlag();
1459   1      #if ENABLE_DEBUG
                      printData("PowerDownCounter:       %d", PowerDownCounter);
              #endif
1462   1          
1463   1          return TRUE;
1464   1      }
1465          
1466          #if 0  //2006-08-10 Andy
                  Bool PowerOffSystem(void)
                  {
                      printMsg("turn off");
                      Power_TurnOffLed();
                      Power_PowerOffSystem();
                      Clr_PowerOnFlag();
                      Clr_FactoryModeFlag();
                      Clr_DisplayLogoFlag();
                      Clr_DoModeSettingFlag();
                      // printData("Power-off Monitor Flag %d",MonitorFlags);
                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                      return TRUE;
                  }
              #endif
1481          Bool PowerOffSystem(void)
1482          {
1483   1          Clr_PowerOnFlag();
1484   1          Clr_FactoryModeFlag();
1485   1          Clr_BurninModeFlag();
1486   1          Clr_DisplayLogoFlag();
1487   1          Clr_DoModeSettingFlag();
1488   1          Clr_DoBurninModeFlag();
1489   1          
1490   1          // 120426 coding addition
1491   1          Clr_BackToUnsupportFlag();
1492   1          Clr_BackToStandbyFlag();
1493   1      
1494   1      
1495   1         
1496   1          Power_TurnOffLed();
1497   1          // 090819 coding, dc off should set ddc wp to protect
1498   1          hw_SetDDC_WP();
1499   1      #if MWEFunction     //110223 Modify for turn on BF and change to the source of nosignal will show garbage
1500   1              msAccSetup( 0, 0, 0, 0 ); //110408 Modify
1501   1              msAccOnOff(0);
1502   1      #endif
1503   1      
1504   1      #if ESaverPowerDownFunc
1505   1          ESaverPowerDownCounter=0;
1506   1      #endif
1507   1      
1508   1          
1509   1      #if ENABLE_HDMI
1510   1          mstar_HDMIAudioMute(0);
1511   1          hw_SetMute();
1512   1      #endif
1513   1      
1514   1      
1515   1          #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                  #else
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 26  

1518   1              SaveMonitorSetting();
1519   1          #endif
1520   1          
1521   1          #if 0//ENABLE_HDCP
                      msDisableHDCP();
                  #endif
1524   1          
1525   1              #if !MS_PM      //120921 Modify for power consumption
                      #if ENABLE_HDCP // 120531 coding reserved
                      msPullLowHPD2();
                      #endif
                      #endif
1530   1              
1531   1              #if ENABLE_DP_INPUT  //130815 xiandi follow trunk
                      #if ((CHIP_ID == CHIP_TSUMC)||( CHIP_ID == CHIP_TSUMD)||(CHIP_ID == CHIP_TSUM9)||(CHIP_ID == CHIP_TSUMF))
                      DPOffSQ()               
                      #if DP_DCOFFHPDLOW
                      DPRxHPDDisable();
                      #endif
                      #else
                      DPRxDCHPD( TRUE );
                      #endif
                      #endif
1541   1      
1542   1          Power_PowerOffSystem();
1543   1          
1544   1      #if ENABLE_DP_INPUT&&CHIP_ID==CHIP_TSUMU
                    gDPInfo.bDPDCoff = 1;
                    g_bDoDPInit = FALSE;
                    // DPRxHPDDisable();      
              #endif
1549   1      
1550   1      #if     (MS_PM)
1551   1              msPM_SetFlag_PMDCoff();
1552   1      #endif
1553   1      
1554   1              #if ENABLE_HDCP // 120531 coding reserved
1555   1              msPullLowHPD1();
1556   1              #endif
1557   1      
1558   1      
1559   1      
1560   1      #if ENABLE_DP_INPUT && ENABLE_DP_PS_CTRL
                              CLR_DP_PS_CTRL_CHARGE();  
              #endif
1563   1      
1564   1          return TRUE;
1565   1      }
1566          Bool PowerOnSystem(void)
1567          {
1568   1      
1569   1          Clr_PowerOffFlag();
1570   1          Set_PowerOnFlag();
1571   1          Clr_DoKeyCountFlag();
1572   1          PowerKeyCounter=0;
1573   1      
1574   1          Power_TurnOnGreenLed();
1575   1          
1576   1          
1577   1          Power_PowerOnSystem();
1578   1              
1579   1              #if ENABLE_DP_INPUT  //130815 xiandi follow trunk
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 27  

                      #if ((CHIP_ID == CHIP_TSUMC)||( CHIP_ID == CHIP_TSUMD) || (CHIP_ID == CHIP_TSUM9)|| (CHIP_ID == CHIP_TSUM
             -F))
                      #if  !DP_DCOFFHPDLOW
                      if(DP_GetSquelch( 0x2FFFE ) && !(DPFastLink(TRUE)))
                      #endif
                      #endif
                      {
                              DPRxHPDDisable();
                              ForceDelay1ms(100);
                              DPRxHPDEnable();
                      }
                      #endif
1591   1      
1592   1      #if 0//ENABLE_HDCP // 120531 coding reserved
                      msPullHighHPD2();
              #endif
1595   1              
1596   1      
1597   1      
1598   1      
1599   1          //Set_ShowInputInfoFlag();
1600   1          #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(MonitorFlag), MonitorFlags);
                  #else
1603   1              SaveMonitorSetting();
1604   1          #endif   
1605   1      
1606   1          #if DisplayPowerOnLogo
1607   1              if(!(FactoryModeFlag
1608   1              ))
1609   1          {
1610   2              Set_DisplayLogoFlag();
1611   2              //      if(CHIP_ID!=CHIP_TSUMU)         //131011 fay
1612   2              msWriteByte(IOSDC2, 0x02); //Disable color bit setting
1613   2              // 091005 coding
1614   2              mStar_AdjustBrightness(100);
1615   2          }
1616   1              else
1617   1              {
1618   2                      Set_LoadOSDDataFlag();  //120611 Modify
1619   2              }
1620   1          #endif
1621   1              #ifdef OffPower           //090331 xiandi.yu Auto Off Power
                  AutoPowerOffMTime=0;
                  AutoPowerOffHTime=0;
                      ShowOffPowerWarningFlag = 0;
                      #endif
1626   1              
1627   1          #if ESaverPowerDownFunc
1628   1              ESaverPowerDownCounter=0;
1629   1          #endif
1630   1      
1631   1          mStar_SetupFreeRunMode();
1632   1          mStar_SetupInputPort();
1633   1      #if DEBUG_PRINTDATA                             
                 printMsg("ePM_EXIT_PM  222222222222");
              #endif
1636   1      
1637   1      
1638   1              #if ENABLE_HDCP // 120531 coding reserved
1639   1              msPullHighHPD1();
1640   1              #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 28  

1641   1              
1642   1      
1643   1      #if ENABLE_DP_INPUT && ENABLE_DP_PS_CTRL
                      SET_DP_PS_CTRL_CHARGE();  
              #endif
1646   1      
1647   1          return TRUE;
1648   1      }
1649          Bool EnterRootMenu(void)
1650          {
1651   1          OsdCounter = 0;
1652   1          return TRUE;
1653   1      }
1654          //================================================================================
1655          //================================================================================
1656          //================================================================================
1657          Bool AdjustContrast(MenuItemActionType action)
1658          {
1659   1          WORD tempValue;
1660   1      
1661   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                              g8TempValue =  UserPrefContrast_Preset;
                      else
              #endif  
1666   1         g8TempValue = UserPrefContrast;
1667   1      
1668   1               tempValue = DecIncValue(action, g8TempValue, MinContrastValue, MaxContrastValue, 1);
1669   1      
1670   1               if (tempValue == g8TempValue)
1671   1               {
1672   2                   return FALSE;
1673   2               }
1674   1                                g8TempValue = tempValue;
1675   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                                UserPrefContrast_Preset= g8TempValue;
                      else
              #endif          
1680   1      {
1681   2               UserPrefContrast = g8TempValue;
1682   2               UserPrefContrastUser = UserPrefContrast;                        
1683   2      }                
1684   1               mStar_AdjustContrast(g8TempValue);
1685   1      
1686   1      
1687   1          //SaveMonitorSetting(); // need check again
1688   1          return TRUE;
1689   1      }
1690          
1691          WORD GetContrastValue(void)
1692          {
1693   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                              g8TempValue =  UserPrefContrast_Preset;
                      else
              #endif  
1698   1         g8TempValue = UserPrefContrast;
1699   1         
1700   1         return GetScale100Value(g8TempValue, MinContrastValue, MaxContrastValue);;
1701   1      }
1702          //====================================================
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 29  

1703          Bool AdjustBrightness(MenuItemActionType action)
1704          {
1705   1          WORD tempValue;
1706   1      
1707   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                              g8TempValue =  UserPrefBrightness_Preset;
                      else
              #endif  
1712   1                      g8TempValue = UserPrefBrightness;
1713   1            {
1714   2              if(action !=MIA_Nothing)        //130627 gordon
1715   2              {
1716   3                  tempValue = DecIncValue(action, g8TempValue, 0, 100, 1);
1717   3                  if (tempValue == g8TempValue)
1718   3                  {
1719   4                      return FALSE;
1720   4                  }
1721   3                      g8TempValue = tempValue;
1722   3      
1723   3      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                                UserPrefBrightness_Preset = g8TempValue;
                      else
              #endif  
1728   3                      {
1729   4                    UserPrefBrightness = g8TempValue;
1730   4                     UserPrefBrightnessUser = UserPrefBrightness;
1731   4                      }                  
1732   3              }       
1733   2      
1734   2                
1735   2                mStar_AdjustBrightness(g8TempValue);
1736   2      
1737   2            } 
1738   1      
1739   1      
1740   1          //SaveMonitorSetting(); // need changed again
1741   1          return TRUE;
1742   1      }
1743          
1744          WORD GetBrightnessValue(void)
1745          {
1746   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                              g8TempValue =  UserPrefBrightness_Preset;
                      else
              #endif  
1751   1           g8TempValue = UserPrefBrightness;
1752   1           return g8TempValue; //GetScale100Value(UserPrefBrightness, 0, 100);
1753   1      }
1754          //====================================================
1755          Bool AdjustFocus(MenuItemActionType action)
1756          {
1757   1          WORD tempValue;
1758   1              tempValue=DecIncValue(action, UserPrefPhase, 0, MAX_PHASE_VALUE, 1);
1759   1              if (tempValue==UserPrefPhase)
1760   1                      return FALSE;
1761   1              UserPrefPhase=tempValue;
1762   1              drvADC_SetPhaseCode(UserPrefPhase);
1763   1          return TRUE;
1764   1      }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 30  

1765          
1766          WORD GetFocusValue(void)
1767          {
1768   1              return (SrcInputType!=Input_VGA) ? 50 : GetScale100Value(UserPrefPhase, 0, MAX_PHASE_VALUE);    //111223 Mod
             -ify
1769   1          //return UserPrefPhase;
1770   1      }
1771          
1772          //====================================================
1773          Bool AdjustClock(MenuItemActionType action)
1774          {
1775   1          WORD tempValue;
1776   1          tempValue = DecIncValue(action, UserPrefHTotal, MinClock, MaxClock, 1);
1777   1          if (tempValue == UserPrefHTotal)
1778   1          {
1779   2              return FALSE;
1780   2          }
1781   1          UserPrefHTotal = tempValue;
1782   1      #if !ENABLE_MENULOAD||!ENABLE_SW_DOUBLE_BUFFER
1783   1              mStar_WaitForDataBlanking();                    //110930 Rick add for avoid noise while adjust clock value - C_FOS_5    
1784   1              #endif
1785   1          drvADC_AdjustHTotal(UserPrefHTotal);
1786   1          return TRUE;
1787   1      }
1788          
1789          WORD GetClockValue(void) // adjust range
1790          {
1791   1          return GetScale100Value(UserPrefHTotal, MinClock, MaxClock);
1792   1      }
1793          //#define MaxHStart   UserPrefAutoHStart+50
1794          //#define MinHStart   UserPrefAutoHStart-50
1795          //====================================================
1796          Bool AdjustHPosition(MenuItemActionType action)
1797          {
1798   1          WORD tempValue;
1799   1          //  tempValue=DecIncValue(action, UserPrefHStart, 0, 2*StandardModeHStart, 1);
1800   1      
1801   1      if(action == MIA_IncValue)
1802   1              action = MIA_DecValue;
1803   1      else
1804   1              action = MIA_IncValue;
1805   1              
1806   1          tempValue = DecIncValue(action, UserPrefHStart, MinHStart, MaxHStart, 1);
1807   1          if (tempValue == UserPrefHStart)
1808   1          {
1809   2              return FALSE;
1810   2          }
1811   1          UserPrefHStart = tempValue;
1812   1          mStar_AdjustHPosition(UserPrefHStart);
1813   1          return TRUE;
1814   1      }
1815          
1816          WORD GetHPositionValue(void)
1817          {
1818   1          return GetScale100Value(UserPrefHStart, MinHStart, MaxHStart); //, 0);
1819   1          // return GetScale100Value(UserPrefHStart, MinHStart, MaxHStart);
1820   1      }
1821          //====================================================
1822          //#define MaxVStart 2*UserPrefAutoVStart-1
1823          //#define MinVStart 1  // 2006/10/26 4:18PM by Emily  0
1824          //====================================================
1825          Bool AdjustVPosition(MenuItemActionType action)
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 31  

1826          {
1827   1          WORD tempValue;
1828   1          if (DecVScaleFlag)
1829   1              tempValue = DecIncValue(action, UserPrefVStart, (DecVScaleValue / 2), 100+(DecVScaleValue / 2), 1)
             -;
1830   1          else
1831   1          #if 1 //2004/01/15 num11
1832   1                  tempValue = DecIncValue(action, UserPrefVStart, MinVStart, MaxVStart, 1);
1833   1          #else
                      tempValue = DecIncValue(action, UserPrefVStart, 0, 2 *StandardModeVStart, 1);
                  #endif
1836   1          if (tempValue == UserPrefVStart)
1837   1          {
1838   2              return FALSE;
1839   2          }
1840   1          UserPrefVStart = tempValue;
1841   1          mStar_AdjustVPosition(UserPrefVStart);
1842   1          return TRUE;
1843   1      }
1844          
1845          WORD GetVPositionValue(void)
1846          {
1847   1          //Osd_Draw4Num(11,1,UserPrefVStart);
1848   1          //Osd_Draw4Num(11,2,DecVScaleFlag);
1849   1          //Osd_Draw4Num(18,1,VScaleDecValue);
1850   1          //Osd_Draw4Num(18,2,DecVScaleFlag);
1851   1          if (DecVScaleFlag)
1852   1              return GetScale100Value(UserPrefVStart, (DecVScaleValue / 2), 100+(DecVScaleValue / 2));
1853   1          else
1854   1          #if 1 //2004/01/15 num11
1855   1                  return GetScale100Value(UserPrefVStart, MinVStart, MaxVStart);
1856   1          #else
                      return GetScale100Value(UserPrefVStart, 0, 2 *StandardModeVStart);
                  #endif
1859   1      }
1860          //====================================================
1861          #if AudioFunc
1862          #if CHIP_ID==CHIP_TSUMU
              extern void msAudioEARout_Mute( Bool EnableMute );
              #endif
1865          
1866          #if EANBLE_MUTE_ON_OFF   
1867          Bool SwitchMute(MenuItemActionType action)
1868          {
1869   1      
1870   1             if ((action == MIA_DecValue)||(action == MIA_IncValue))
1871   1              {
1872   2                  UserPrefMuteState = UserPrefMuteState?0:1;
1873   2              }
1874   1      
1875   1              if (UserPrefMuteState)
1876   1              {
1877   2                      //hw_SetMute();
1878   2                  #if USE_DAC_ADJ
                              msWriteByteMask( REG_2C6A, BIT4, BIT4 );
                              #endif
1881   2                      #if CHIP_ID==CHIP_TSUMU
                              //msAudioEARout_Mute( TRUE);    
                              #endif          
1884   2                    mStar_AdjustVolume(0);    
1885   2              }
1886   1              else
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 32  

1887   1              {
1888   2                      //if(bAudioInputStatus == AudioInput_Spk)
1889   2                      //hw_ClrMute();
1890   2                      #if CHIP_ID==CHIP_TSUMU
                              //msAudioEARout_Mute( FALSE);   
                              #endif
1893   2                      #if USE_DAC_ADJ
                              msWriteByteMask( REG_2C6A, BIT0, BIT4 );
                              #endif
1896   2      
1897   2                   mStar_AdjustVolume(UserPrefVolume);
1898   2              }
1899   1          
1900   1              return TRUE;
1901   1      }
1902          #endif
1903              Bool AdjustVolume(MenuItemActionType action)
1904              {
1905   1              WORD tempValue;
1906   1          if((action !=MIA_DecValue)&&(action !=MIA_IncValue))
1907   1              return FALSE;
1908   1              tempValue = DecIncValue(action, UserPrefVolume, MinVolume, MaxVolume, 1);
1909   1      
1910   1              if (tempValue == UserPrefVolume)
1911   1              {
1912   2                  return FALSE;
1913   2              }
1914   1              UserPrefVolume = tempValue;
1915   1      
1916   1              if(UserPrefMuteState)
1917   1           {
1918   2                 SwitchMute(MIA_DecValue);    // UserPrefMuteState=0;
1919   2           }
1920   1       
1921   1              mStar_AdjustVolume(UserPrefVolume);
1922   1              return TRUE;
1923   1          }
1924              WORD GetVolumeValue(void)
1925              {
1926   1                      return GetScale100Value(UserPrefVolume, MinVolume, MaxVolume);
1927   1          }
1928          #endif
1929          
1930          #if OsdAdjustHVPos_Enable
1931          //=====================================================
1932          Bool AdjustOSDHPosition(MenuItemActionType action)
1933          {
1934   1          WORD tempValue;
1935   1          tempValue = DecIncValue(action, UserPrefOsdHStart, 0, 100, 1);              //120119 Modify
1936   1          if (tempValue == UserPrefOsdHStart)
1937   1          {
1938   2              return FALSE;
1939   2          }
1940   1          UserPrefOsdHStart = tempValue;
1941   1      
1942   1          mStar_WaitForDataBlanking();
1943   1          Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
1944   1      
1945   1          return TRUE;
1946   1      }
1947          WORD GetOSDHPositionValue(void)
1948          {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 33  

1949   1          return GetScale100Value(UserPrefOsdHStart, 0, 100);
1950   1          //   return ( UserPrefOsdHStart % 101 );
1951   1      }
1952          //================================================================================
1953          Bool AdjustOSDVPosition(MenuItemActionType action)
1954          {
1955   1          WORD tempValue;
1956   1          tempValue = DecIncValue(action, UserPrefOsdVStart, 0, 100, 1); //0729 New Spec
1957   1          if (tempValue == UserPrefOsdVStart)
1958   1          {
1959   2              return FALSE;
1960   2          }
1961   1          UserPrefOsdVStart = tempValue;
1962   1          
1963   1          mStar_WaitForDataBlanking();
1964   1          if (UserPrefOsdVStart == 100)
1965   1              Delay1ms(8);
1966   1          
1967   1          Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
1968   1      
1969   1          return TRUE;
1970   1      }
1971          WORD GetOSDVPositionValue(void)
1972          {
1973   1          return GetScale100Value(UserPrefOsdVStart, 0, 100);
1974   1          //return GetScale100Value(UserPrefOsdVStart, 0, 100);
1975   1      }
1976          #endif
1977          //================================================================================
1978          Bool AdjustOSDTransparence(MenuItemActionType action)
1979          {
1980   1          WORD tempValue;
1981   1          tempValue = DecIncValue(action, UserPrefOsdTrans, 0, 4, 1); //0729 New Spec
1982   1          if (tempValue == UserPrefOsdTrans)
1983   1          {
1984   2              return FALSE;
1985   2          }
1986   1          UserPrefOsdTrans = tempValue;
1987   1          Osd_SetTransparence(UserPrefOsdTrans);
1988   1      #if Enable_OsdEngine1
               Osd_SetOsdEngine(1);
                  Osd_SetTransparence(UserPrefOsdTrans);
               Osd_SetOsdEngine(0);
              #endif
1993   1          return TRUE;
1994   1      }
1995          WORD GetOSDTransparence(void)
1996          {
1997   1          return GetScale100Value(UserPrefOsdTrans, 0, 4);
1998   1      }
1999          //================================================================================
2000          Bool AdjustOSDTime(MenuItemActionType action)
2001          {
2002   1          WORD tempValue;
2003   1          tempValue = DecIncValue(action, UserPrefOsdTime, 5, 120, 5); // 071218 modified for osd time out
2004   1          if (tempValue == UserPrefOsdTime)
2005   1          {
2006   2              return FALSE;
2007   2          }
2008   1          UserPrefOsdTime = tempValue;
2009   1          return TRUE;
2010   1      }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 34  

2011          WORD GetOSDTimeValue(void)
2012          {
2013   1          return UserPrefOsdTime;
2014   1      }
2015          WORD GetOSDTime100Value(void)
2016          {
2017   1          return GetScale100Value(UserPrefOsdTime, 0, 120); // 071218 modified for osd time out
2018   1      }
2019          
2020          
2021          #if !Enable_Adjust_SharpnessMenu
2022          #ifdef OffPower           //090331 xiandi.yu Auto Off Power
              Bool AdjustAutoPowerOff(MenuItemActionType action)
              {
                  WORD tempValue;
              
                  tempValue = DecIncValue(action, UserPrefAutoPowerOff, MinAutoPowerOffTime, MaxAutoPowerOffTime, 1); 
                  
                  if (tempValue == UserPrefAutoPowerOff)
                  {
                      return FALSE;
                  }
                  UserPrefAutoPowerOff = tempValue;
                  AutoPowerOffMTime=0;
                  AutoPowerOffHTime=0;
                      ShowOffPowerWarningFlag = 0;
                  
                  return TRUE;
              }
                  WORD GetAutoPowerOffValue(void)
                  {
                      return UserPrefAutoPowerOff;
                  }
              #endif
2045          #endif
2046          #if Enable_YMC
                  // bit 7 6 5 4 3 2 1 0
                  //         Y C M R G B
                  void SetYCMColor(MenuItemActionType action, WORD color, WORD value)
                  {
                      //printData("color %d", color);
                      //printData("value %d", value);
                      if (color &BIT5)
                      // Y
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefYColor >= MaxColorValue)
                                  UserPrefYColor = MaxColorValue;
                              else
                                  UserPrefYColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefYColor == 0 || ((UserPrefYColor - value) <= 0))
                                  UserPrefYColor = 0;
                              else
                                  UserPrefYColor -= value;
                          }
                          //printData("y %d", UserPrefYColor);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 35  

                      }
                      if (color &BIT4)
                      // C
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefCColor >= MaxColorValue)
                                  UserPrefCColor = MaxColorValue;
                              else
                                  UserPrefCColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefCColor == 0 || ((UserPrefCColor - value) <= 0))
                                  UserPrefCColor = 0;
                              else
                                  UserPrefCColor -= value;
                          }
                          //printData("c %d", UserPrefCColor);
                      }
                      if (color &BIT3)
                      // M
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefMColor >= MaxColorValue)
                                  UserPrefMColor = MaxColorValue;
                              else
                                  UserPrefMColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefMColor == 0 || ((UserPrefMColor - value) <= 0))
                                  UserPrefMColor = 0;
                              else
                                  UserPrefMColor -= value;
                          }
                          //printData("m %d", UserPrefMColor);
                      }
                      if (color &BIT2)
                      // Red
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefRedColor >= MaxColorValue)
                                  UserPrefRedColor = MaxColorValue;
                              else
                                  UserPrefRedColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefRedColor == 0 || ((UserPrefRedColor - value <= 0)))
                                  UserPrefRedColor = 0;
                              else
                                  UserPrefRedColor -= value;
                          }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 36  

                          //printData("red %d", UserPrefRedColor);
                          UserPrefRedColorUser = UserPrefRedColor;
                          mStar_AdjustRedColor(UserPrefRedColorUser, UserPrefContrast);
                      }
                      if (color &BIT1)
                      // Green
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefGreenColor >= MaxColorValue)
                                  UserPrefGreenColor = MaxColorValue;
                              else
                                  UserPrefGreenColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefGreenColor == 0 || ((UserPrefGreenColor - value <= 0)))
                                  UserPrefGreenColor = 0;
                              else
                                  UserPrefGreenColor -= value;
                          }
                          //printData("green %d", UserPrefGreenColor);
                          UserPrefGreenColorUser = UserPrefGreenColor;
                          mStar_AdjustGreenColor(UserPrefGreenColorUser, UserPrefContrast);
                      }
                      if (color &BIT0)
                      // Blue
                      {
                          if (action == MIA_IncValue)
                          // inc
                          {
                              if (value + UserPrefBlueColor >= MaxColorValue)
                                  UserPrefBlueColor = MaxColorValue;
                              else
                                  UserPrefBlueColor += value;
                          }
                          else
                          // dec
                          {
                              if (UserPrefBlueColor == 0 || ((UserPrefBlueColor - value <= 0)))
                                  UserPrefBlueColor = 0;
                              else
                                  UserPrefBlueColor -= value;
                          }
                          //printData("blue %d", UserPrefBlueColor);
                          UserPrefBlueColorUser = UserPrefBlueColor;
                          mStar_AdjustBlueColor(UserPrefBlueColorUser, UserPrefContrast);
                      }
                  }
                  //====================================================
                  Bool AdjustYColor(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefYColor, MinColorValue, MaxColorValue, 1);       //120204 Modify
                      if (tempValue == UserPrefYColor)
                      {
                          return FALSE;
                      }
                      if (action == MIA_IncValue)
                      // Y=R+G ; C=G+B ; M=B+R
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 37  

                      {
                          SetYCMColor(action, 0x1e, tempValue - UserPrefYColor); // YCMRGB:01 1110
                      }
                      else
                      {
                          SetYCMColor(action, 0x1e, UserPrefYColor - tempValue); // YCMRGB:01 1110
                      }
                      UserPrefYColor = tempValue;
                      #if UsesRGB
                          mStar_AdjustContrast(UserPrefContrast);
                      #endif
                      return TRUE;
                  }
                  WORD GetYColorValue(void)
                  {
                      return GetScale100Value(UserPrefYColor, MinColorValue, MaxColorValue);  //120204 Modify
                  }
                  //====================================================
                  Bool AdjustCColor(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefCColor, MinColorValue, MaxColorValue, 1);       //120204 Modify
                      if (tempValue == UserPrefCColor)
                      {
                          return FALSE;
                      }
                      if (action == MIA_IncValue)
                      // Y=R+G ; C=G+B ; M=B+R
                          SetYCMColor(action, 0x2b, tempValue - UserPrefCColor);
                      // YCMRGB:10 1011
                      else
                          SetYCMColor(action, 0x2b, UserPrefCColor - tempValue);
                      // YCMRGB:10 1011
                      UserPrefCColor = tempValue;
                      #if UsesRGB
                          mStar_AdjustContrast(UserPrefContrast);
                      #endif
                      return TRUE;
                  }
                  WORD GetCColorValue(void)
                  {
                      return GetScale100Value(UserPrefCColor, MinColorValue, MaxColorValue);  //120204 Modify
                  }
                  //====================================================
                  Bool AdjustMColor(MenuItemActionType action)
                  {
                      WORD tempValue;
                      tempValue = DecIncValue(action, UserPrefMColor, MinColorValue, MaxColorValue, 1);       //120204 Modify
                      if (tempValue == UserPrefMColor)
                      {
                          return FALSE;
                      }
                      if (action == MIA_IncValue)
                      // Y=R+G ; C=G+B ; M=B+R
                          SetYCMColor(action, 0x35, tempValue - UserPrefMColor);
                      // YCMRGB:11 0101
                      else
                          SetYCMColor(action, 0x35, UserPrefMColor - tempValue);
                      // YCMRGB:11 0101
                      UserPrefMColor = tempValue;
                      #if UsesRGB
                          mStar_AdjustContrast(UserPrefContrast);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 38  

                      #endif
                      return TRUE;
                  }
                  WORD GetMColorValue(void)
                  {
                      return GetScale100Value(UserPrefMColor, MinColorValue, MaxColorValue);  //120204 Modify
                  }
              #endif
2267          //====================================================
2268          //====================================================
2269          Bool AdjustBlueColor(MenuItemActionType action)
2270          {
2271   1          WORD tempValue;
2272   1      #if 0//defined(WH_REQUEST) && WH_REQUEST_OSD
                       tempValue = DecIncValue(action, UserPrefBlueColor, MinColorValue, MaxColorValue, 2);   
              #else
2275   1              tempValue = DecIncValue(action, UserPrefBlueColor, MinColorValue, MaxColorValue, 2);    //120204 Modify
2276   1      #endif
2277   1          if (tempValue == UserPrefBlueColor)
2278   1          {
2279   2              return FALSE;
2280   2          }
2281   1          #if Enable_YMC
                      if (UserPrefColorTemp == CTEMP_USER)
                      // R=Y+M B=M+C G=C+Y
                      {
                          if (action == MIA_IncValue)
                          // Y=R+G ; C=G+B ; M=B+R
                              SetYCMColor(action, 0x18, tempValue - UserPrefBlueColor);
                          // YCMRGB:01 1000
                          else
                              SetYCMColor(action, 0x18, UserPrefBlueColor - tempValue);
                          // YCMRGB:01 1000
                      }
                  #endif
2294   1          UserPrefBlueColor = tempValue;
2295   1          UserPrefBlueColorUser = UserPrefBlueColor;
2296   1          #if UsesRGB
                      mStar_AdjustContrast(UserPrefContrast);
                  #else
2299   1              mStar_AdjustBlueColor(UserPrefBlueColorUser, UserPrefContrast);
2300   1          #endif
2301   1          return TRUE;
2302   1      }
2303          
2304          WORD GetBlueColorValue(void)
2305          {
2306   1          return GetScale100Value(UserPrefBlueColor, MinColorValue, MaxColorValue);   //120204 Modify
2307   1      }
2308          //====================================================
2309          Bool AdjustGreenColor(MenuItemActionType action)
2310          {
2311   1          WORD tempValue;
2312   1      #if 0//defined(WH_REQUEST) && WH_REQUEST_OSD
                      tempValue = DecIncValue(action, UserPrefGreenColor, MinColorValue, MaxColorValue, 2);
              #else
2315   1              tempValue = DecIncValue(action, UserPrefGreenColor, MinColorValue, MaxColorValue, 2);   //120204 Modify
2316   1      #endif
2317   1          if (tempValue == UserPrefGreenColor)
2318   1          {
2319   2              return FALSE;
2320   2          }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 39  

2321   1          #if Enable_YMC
                      if (UserPrefColorTemp == CTEMP_USER)
                      // R=Y+M B=M+C G=C+Y
                      {
                          if (action == MIA_IncValue)
                          // Y=R+G ; C=G+B ; M=B+R
                              SetYCMColor(action, 0x30, tempValue - UserPrefGreenColor);
                          // YCMRGB:11 0000
                          else
                              SetYCMColor(action, 0x30, UserPrefGreenColor - tempValue);
                          // YCMRGB:11 0000
                      }
                  #endif
2334   1          UserPrefGreenColor = tempValue;
2335   1          UserPrefGreenColorUser = UserPrefGreenColor;
2336   1          #if UsesRGB
                      mStar_AdjustContrast(UserPrefContrast);
                  #else
2339   1              mStar_AdjustGreenColor(UserPrefGreenColorUser, UserPrefContrast);
2340   1          #endif
2341   1          #if 0
                      if (UserPrefDcrMode == 1)
                      // jeff add in 1112
                      {
                          msAccOnOff(0); // 2006/11/9 11:27PM by Emily test
                          UserPrefColorFlags = 0;
                          UserPrefDcrMode = 0;
                          ReadColorTempSetting();
                      }
                  #endif
2351   1          return TRUE;
2352   1      }
2353          WORD GetGreenColorValue(void)
2354          {
2355   1          return GetScale100Value(UserPrefGreenColor, MinColorValue, MaxColorValue);  //120204 Modify
2356   1      }
2357          //====================================================
2358          Bool AdjustRedColor(MenuItemActionType action)
2359          {
2360   1          WORD tempValue;
2361   1      #if 0//defined(WH_REQUEST) && WH_REQUEST_OSD
                       tempValue = DecIncValue(action, UserPrefRedColor, MinColorValue, MaxColorValue, 2);    //120204 Modify
              #else
2364   1              tempValue = DecIncValue(action, UserPrefRedColor, MinColorValue, MaxColorValue, 2); //120204 Modify
2365   1      #endif
2366   1          if (tempValue == UserPrefRedColor)
2367   1          {
2368   2              return FALSE;
2369   2          }
2370   1          #if Enable_YMC
                      if (UserPrefColorTemp == CTEMP_USER)
                      // R=Y+M B=M+C G=C+Y
                      {
                          if (action == MIA_IncValue)
                          // Y=R+G ; C=G+B ; M=B+R
                          {
                              SetYCMColor(action, 0x28, tempValue - UserPrefRedColor); // YCMRGB:10 1000
                          }
                          else
                          {
                              SetYCMColor(action, 0x28, UserPrefRedColor - tempValue); // YCMRGB:10 1000
                          }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 40  

                      }
                  #endif
2385   1          UserPrefRedColor = tempValue;
2386   1          UserPrefRedColorUser = UserPrefRedColor;
2387   1          #if UsesRGB
                      mStar_AdjustContrast(UserPrefContrast);
                  #else
2390   1              mStar_AdjustRedColor(UserPrefRedColorUser, UserPrefContrast);
2391   1          #endif
2392   1          #if 0
                      if (UserPrefDcrMode == 1)
                      // jeff add in 1112
                      {
                          msAccOnOff(0); // 2006/11/9 11:27PM by Emily test
                          UserPrefColorFlags = 0;
                          UserPrefDcrMode = 0;
                          ReadColorTempSetting();
                      }
                  #endif
2402   1          return TRUE;
2403   1      }
2404          WORD GetRedColorValue(void)
2405          {
2406   1          return GetScale100Value(UserPrefRedColor, MinColorValue, MaxColorValue);    //120204 Modify
2407   1      }
2408          
2409          #if ENABLE_DeltaE
              Bool CheckNVRamGammaValueEmpty(void)
              {
                  BYTE temp3x3Value, tempGammaValue;
                  BYTE i;
              
                  for ( i = 0; i < 10; i++ )
                  {
                      NVRam_ReadByte(RM_COLORSPACE_TRANS_BASEADDR_SRGB+i, &temp3x3Value);
                      NVRam_ReadByte(BGammaTblEndAddr-i, &tempGammaValue);
              
                      if (temp3x3Value==0x00 || temp3x3Value==0xFF || tempGammaValue==0x00 || tempGammaValue==0xFF)
                          continue;
                      else
                          return FALSE;
                  }
              
                  return TRUE;
              
              }
              #endif
2430          
2431          //====================================================
2432          #if ENABLE_DeltaE
              Bool ColorTempCtrl(ColorTempType colortemp)
              {
                  //xdata ColorType CT;
              
                 // UserPrefContrast =  *ColorTempPtr[colortemp][1];
                 // UserPrefBrightness =  *ColorTempPtr[colortemp][0];
                 // UserPrefRedColor =  *ColorTempPtr[colortemp][2];
                 // UserPrefGreenColor =  *ColorTempPtr[colortemp][3];
                 // UserPrefBlueColor =  *ColorTempPtr[colortemp][4];
                 // CT.u8Red     =*(ColorTempPtr[colortemp][2]);
                 // CT.u8Green   =*(ColorTempPtr[colortemp][3]);
                 // CT.u8Blue    =*(ColorTempPtr[colortemp][4]);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 41  

              
                  mStar_WaitForDataBlanking();
                //  mStar_AdjustRGBColor(UserPrefContrast, CT.u8Red, CT.u8Green, CT.u8Blue);
                //  mStar_AdjustBrightness(UserPrefBrightness);
              
              #if ENABLE_DeltaE
                  if (colortemp == CTEMP_SRGB)
                  {
                      if(!CheckNVRamGammaValueEmpty())
                      {
                                  #if ENABLE_USE_NewDeltaE
                                      LoadDeltaEColorMode(0, 0, 1); // Load delta -E measure value
                                      #else
                          LoadDeltaEColorMode(0, 1, 1); // Load delta -E measure value
                                      #endif 
                      }
                      GammaContent = GAMAContent_GAMA_sRGB;
                  }
                  else
                  {
                      mStar_SetupGamma( UserPrefGamaMode );
                      msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamma enable.  
                  }
              #endif
              
                  return TRUE;
              }
              #endif
2473          Bool SetColorTemp(void)
2474          {
2475   1          ReadColorTempSetting();
2476   1      #if ENABLE_DeltaE
                      if (UserPrefColorTemp == CTEMP_SRGB)
                      {
                              if(!CheckNVRamGammaValueEmpty())
                              {    
                                  mStar_WaitForDataBlanking();
                                      #if ENABLE_USE_NewDeltaE
                                      LoadDeltaEColorMode(0, 0, 1); // Load delta -E measure value
                                      #else
                                      LoadDeltaEColorMode(0, 1, 1); // Load delta -E measure value 
                                      #endif
                              }
                              GammaContent = GAMAContent_GAMA_sRGB;
                      }
                      else
                      {
                              mStar_SetupGamma( UserPrefGamaMode );
                              msWriteByteMask(SCE_02,  0, _BIT2|_BIT1 | _BIT0);  // fix-gamma/color-matrix/de-gamma enable.  
                      }
              #endif
2496   1          //if (UserPrefColorTemp == CTEMP_SRGB)
2497   1          //{
2498   1          //    UserPrefECOMode = ECO_Standard;
2499   1          //}
2500   1          //Set_SaveSettingFlag();//1020
2501   1          return TRUE;
2502   1      }
2503          Bool AdjustColorTempMode(MenuItemActionType action)
2504          {
2505   1          BYTE temp;
2506   1      
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 42  

2507   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                              g8TempValue =  UserPrefColorTemp_Preset;
                      else
              #endif
2512   1         g8TempValue =  UserPrefColorTemp;
2513   1      
2514   1          temp = g8TempValue;
2515   1      
2516   1          if (action == MIA_DecValue)
2517   1          {
2518   2              g8TempValue = (g8TempValue + CTEMP_Nums - 1) % CTEMP_Nums;
2519   2          }
2520   1          else
2521   1          {
2522   2              g8TempValue = (g8TempValue + 1) % CTEMP_Nums;
2523   2          }
2524   1          if (temp == g8TempValue)
2525   1              return FALSE;
2526   1      
2527   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                     UserPrefColorTemp_Preset=g8TempValue;
                      else
              #endif
2532   1              UserPrefColorTemp = g8TempValue;
2533   1      
2534   1      #if sRGBIssue           //130109_23 Henry Move From Menu.c
                      if( UserPrefColorTemp == CTEMP_SRGB )
                              {
                                      if( UserPrefECOMode != ECO_Standard )
                                      {
                                              UserPrefECOMode = ECO_Standard;
                                              SetColorTemp();
                                      }
              
                                      if( UserPrefGamaMode != GAMA1 )
                                      {
                                              UserPrefGamaMode = GAMA1;
                                                      #if Enable_Gamma
                                              mStar_SetupGamma( GAMA1 );
                                                      #endif
                                      }
                                      if(UserPrefDcrMode)     
                                      {
                                              UserPrefDcrMode = 0;
                                              SetECO();
                                              msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                                      }
                                      
                              }
                      else
                              {
              
                                      UserPrefECOMode = UserPrevECOMode;
                                      UserPrefGamaMode = UserPrevGamaMode;
                      #if Enable_Gamma
                                      mStar_SetupGamma( UserPrefGamaMode );
                      #endif
                      #if sRGBIssue||iCareForResetIssue
                                      UserPrefiCareMode = UserPreviCareMode;
                      #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 43  

                                      UserPrefDcrMode = UserPrevDcrMode;
                                      SetECO();
                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                              }
              #endif  
2574   1         
2575   1              #if CT_sRGB_ENABLE
                      if( UserPrefColorTemp == CTEMP_SRGB )//20140817  for all scaler the same
                      {
                              if( UserPrefECOMode != ECO_Standard )
                              {
                                      UserPrefECOMode = ECO_Standard;
                                      SetColorTemp();
                              }
                              
                              if( UserPrefGamaMode != GAMA1 ) 
                              {
                                      UserPrefGamaMode = GAMA1;
                                      #if Enable_Gamma
                                      mStar_SetupGamma( GAMA1 );
                                                      #endif
                              }
                              if(UserPrefDcrMode)                     
                              {
                                      UserPrefDcrMode = 0;
                                      SetECO();
                                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
                              }
                              #if ENABLE_OSD_LowBlueLight     
                              if(UserprefLowBlueLightMode != LOW_BLUE_LIGHT_OFF)      
                                      UserprefLowBlueLightMode= LOW_BLUE_LIGHT_OFF;
                              #endif
              
                      }    
                      #endif
2604   1      
2605   1      #if LowBlueLightType == LowBlueLight_SharpFunc
              if(UserPrefColorTemp==CTEMP_LowBlue)   
              {
                      gTempLowBlueMode=UserprefLowBlueLightMode ;
              }
              #endif
2611   1      
2612   1              
2613   1          SetColorTemp();
2614   1            #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ECOMode), UserPrefECOMode);
                      NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                      NVRam_WriteByte( nvrMonitorAddr( DcrMode ), UserPrefDcrMode );
                     NVRam_WriteByte( nvrMonitorAddr( GamaMode ), UserPrefGamaMode );
                      #if ENABLE_OSD_LowBlueLight     
                        NVRam_WriteByte( nvrMonitorAddr( LowBlueLightMode ), UserprefLowBlueLightMode );
                      #endif
              
                  #else
2624   1              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
2625   1          #endif
2626   1              /*msAccOnOff(0); // 2006/11/9 11:27PM by Emily test
2627   1              UserPrefColorFlags = 0;*/
2628   1          return TRUE;
2629   1      }
2630          #if HKC_INPUTSELECT_MODE
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 44  

              Bool AdjustInputSource(MenuItemActionType action)
              {
                  
                  if (action == MIA_DecValue)
                  {
                      UserPrefInputType = (UserPrefInputType + Input_Nums - 1) % Input_Nums;
                  }
                  else if(action == MIA_IncValue)
                  {
                      UserPrefInputType = (UserPrefInputType + 1) % Input_Nums;
                  }
                //  SaveMonitorSetting();
                 // Set_SaveSettingFlag();
                  return TRUE;
              }
              #endif
2647          #if AdjustLanguageFunction
2648          Bool AdjustLanguage(MenuItemActionType action)
2649          {
2650   1          BYTE temp;
2651   1          temp = UserPrefLanguage;
2652   1      #if 1//LanguageEnable_All
2653   1          if (action == MIA_DecValue)
2654   1          {
2655   2              UserPrefLanguage = (UserPrefLanguage + LANG_Nums - 1) % LANG_Nums;
2656   2          }
2657   1          else
2658   1              {
2659   2              UserPrefLanguage = (UserPrefLanguage + 1) % LANG_Nums;
2660   2              }
2661   1      #else
                  //return TRUE;
                  if (action == MIA_DecValue)
                  {
                      while(1)
                      {
                      UserPrefLanguage = (UserPrefLanguage + LANG_Nums - 1) % LANG_Nums;
              #if 0//!LanguageEnable_English  
                      if(UserPrefLanguage==LANG_English) continue;
              #endif
              #if !LanguageEnable_France
                      if(UserPrefLanguage==LANG_France) continue;
              #endif
              #if !LanguageEnable_Spanish     
                      if(UserPrefLanguage==LANG_Spanish) continue;
              #endif
              #if !LanguageEnable_Portugues   
                      if(UserPrefLanguage==LANG_Portugues) continue;
              #endif
              #if !LanguageEnable_German              
                      if(UserPrefLanguage==LANG_German) continue;
              #endif
              #if !LanguageEnable_Italian             
                      if(UserPrefLanguage==LANG_Italian) continue;
              #endif
              #if !LanguageEnable_Dutch               
                      if(UserPrefLanguage==LANG_Dutch) continue;
              #endif
              #if !LanguageEnable_Swedish             
                      if(UserPrefLanguage==LANG_Swedish) continue;
              #endif
              #if !LanguageEnable_Finnish             
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 45  

                      if(UserPrefLanguage==LANG_Finnish) continue;
              #endif
              #if !LanguageEnable_Polish              
                      if(UserPrefLanguage==LANG_Polish) continue;
              #endif
              #if !LanguageEnable_Czech               
                      if(UserPrefLanguage==LANG_Czech) continue;
              #endif
              #if !LanguageEnable_Russia              
                      if(UserPrefLanguage==LANG_Russia) continue;
              #endif
              #if !LanguageEnable_Korea               
                      if(UserPrefLanguage==LANG_Korea) continue;
              #endif
              #if !LanguageEnable_TChina              
                      if(UserPrefLanguage==LANG_TChina) continue;
              #endif
              #if !LanguageEnable_SChina              
                      if(UserPrefLanguage==LANG_SChina) continue;
              #endif
              #if !LanguageEnable_Japan       
                      if(UserPrefLanguage==LANG_Japan) continue;
              #endif
                      break;
                      }       
                              
                  }
                  else
                  {
              
                      while(1)
                      {
                     UserPrefLanguage = (UserPrefLanguage + 1) % LANG_Nums;
              #if 0//!LanguageEnable_English  
                      if(UserPrefLanguage==LANG_English) continue;
              #endif
              #if !LanguageEnable_France
                      if(UserPrefLanguage==LANG_France) continue;
              #endif
              #if !LanguageEnable_Spanish     
                      if(UserPrefLanguage==LANG_Spanish) continue;
              #endif
              #if !LanguageEnable_Portugues   
                      if(UserPrefLanguage==LANG_Portugues) continue;
              #endif
              #if !LanguageEnable_German              
                      if(UserPrefLanguage==LANG_German) continue;
              #endif
              #if !LanguageEnable_Italian             
                      if(UserPrefLanguage==LANG_Italian) continue;
              #endif
              #if !LanguageEnable_Dutch               
                      if(UserPrefLanguage==LANG_Dutch) continue;
              #endif
              #if !LanguageEnable_Swedish             
                      if(UserPrefLanguage==LANG_Swedish) continue;
              #endif
              #if !LanguageEnable_Finnish             
                      if(UserPrefLanguage==LANG_Finnish) continue;
              #endif
              #if !LanguageEnable_Polish              
                      if(UserPrefLanguage==LANG_Polish) continue;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 46  

              #endif
              #if !LanguageEnable_Czech               
                      if(UserPrefLanguage==LANG_Czech) continue;
              #endif
              #if !LanguageEnable_Russia              
                      if(UserPrefLanguage==LANG_Russia) continue;
              #endif
              #if !LanguageEnable_Korea               
                      if(UserPrefLanguage==LANG_Korea) continue;
              #endif
              #if !LanguageEnable_TChina              
                      if(UserPrefLanguage==LANG_TChina) continue;
              #endif
              #if !LanguageEnable_SChina              
                      if(UserPrefLanguage==LANG_SChina) continue;
              #endif
              #if !LanguageEnable_Japan       
                      if(UserPrefLanguage==LANG_Japan) continue;
              #endif
                      break;
                      }       
                  }
              #endif
2778   1          if (temp == UserPrefLanguage)
2779   1              return FALSE;
2780   1          return TRUE;
2781   1      }
2782          #else
              Bool AdjustLanguage( MenuItemActionType action )
              { 
                   action=action;
                   if (UserPrefLanguage==MenuItemIndex)
                        return FALSE;
                       
                      UserPrefLanguage=MenuItemIndex;
              
              #if DEBUG_PRINTDATA                             
                 printData("UserPrefLanguage Index %d",UserPrefLanguage);
              #endif
                      
                      return TRUE;
              }
              #endif
2798          
2799          
2800          //========== ADJUST INPUT PORT =======================
2801          #if Dual 
2802          Bool ChangeSource(void)
2803          {       
2804   1          // 071218 source select
2805   1      
2806   1              hw_SetGreenLed();
2807   1              hw_ClrAmberLed();
2808   1               
2809   1      
2810   1              #if AudioFunc && ENABLE_HDMI    //120119 Modify for TPV Request
2811   1               if (SrcInputType == Input_HDMI||SrcInputType == Input_HDMI2||SrcInputType == Input_HDMI3)
2812   1                      mstar_HDMIAudioMute(HDMI_AUDIO_OFF);
2813   1              #endif
2814   1      
2815   1              #if AudioFunc && ENABLE_DP_INPUT 
                      if( 
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 47  

                              #if INPUT_TYPE == INPUT_1A1DP
                              ((PrevInputType==INPUT_PRIORITY_VGA)&&(SrcInputType == INPUT_PRIORITY_DP))
                              ||((PrevInputType == INPUT_PRIORITY_DP)&&(SrcInputType==INPUT_PRIORITY_VGA))    
                              #elif INPUT_TYPE == INPUT_1A1H1DP
                              ((PrevInputType==INPUT_PRIORITY_VGA||PrevInputType==INPUT_PRIORITY_HDMI)&&(SrcInputType == INPUT_PRIORIT
             -Y_DP))
                              ||((PrevInputType == INPUT_PRIORITY_DP)&&(SrcInputType==INPUT_PRIORITY_VGA||SrcInputType==INPUT_PRIORITY
             -_HDMI))
                            #elif (INPUT_TYPE == INPUT_1D1H1DP)
                            ((PrevInputType==INPUT_PRIORITY_DVI||PrevInputType==INPUT_PRIORITY_HDMI)&&(SrcInputType == I
             -NPUT_PRIORITY_DP))
                            ||((PrevInputType == INPUT_PRIORITY_DP)&&(SrcInputType==INPUT_PRIORITY_DVI||SrcInputType==IN
             -PUT_PRIORITY_HDMI))
                            #elif (INPUT_TYPE == INPUT_1A2H1DP)
                              ((PrevInputType==INPUT_PRIORITY_VGA)&&(SrcInputType == INPUT_PRIORITY_DP))||((PrevInputType == INPUT_PRI
             -ORITY_DP)&&(SrcInputType==INPUT_PRIORITY_VGA))          
                              #else
                              ((PrevInputType==INPUT_PRIORITY_VGA||PrevInputType==INPUT_PRIORITY_DVI)&&(SrcInputType == INPUT_PRIORITY
             -_DP))
                              ||((PrevInputType == INPUT_PRIORITY_DP)&&(SrcInputType==INPUT_PRIORITY_VGA||SrcInputType==INPUT_PRIORITY
             -_DVI))
                              #endif
                              )
                              {
                              hw_SetMute();
                     }
                      #endif
2837   1              
2838   1      
2839   1                 
2840   1              Power_TurnOffPanel();
2841   1              mStar_SetupInputPort();
2842   1              Clr_BackToStandbyFlag();
2843   1              Set_InputTimingChangeFlag();
2844   1      #if Dual
2845   1              if (!(FactoryModeFlag))
2846   1              Set_ShowInputInfoFlag();
2847   1      #endif
2848   1              SrcFlags |= SyncLoss;
2849   1              return TRUE;
2850   1          }
2851          #endif
2852          
2853          #if DDCCI_ENABLE && DDCCCIMenu_Enable
              void Set_DDC2BI_ID( void )
              {
                
                  D2B_SET_ID_VGA(DDCciFlag);//DDCADC_DDCCI_ID = 0xB7;
                  
              #if (CHIP_ID == CHIP_TSUMC) || (CHIP_ID == CHIP_TSUMD) || (CHIP_ID == CHIP_TSUM9) || (CHIP_ID == CHIP_TSUM
             -F)
                  #if DDC_Port_D0
                      D2B_SET_ID_DVI0(DDCciFlag);
                  #endif
                  #if DDC_Port_D1
                      D2B_SET_ID_DVI1(DDCciFlag);
                  #endif
                  #if DDC_Port_D2
                      D2B_SET_ID_DVI2(DDCciFlag);
                  #endif
              #else
              #if INPUT_TYPE!=INPUT_1A
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 48  

                  D2B_SET_ID_DVI(DDCciFlag);//DDCDVI_DDCCI_ID = 0xB7;
                  #if ENABLE_HDMI
                  D2B_SET_ID_HDMI(DDCciFlag);//DDCHDMI_DDCCI_ID = 0xB7;
                  #endif
              #endif
              #endif
               
              #if ENABLE_DP_INPUT
                  D2B_SET_ID_DP(DDCciFlag);//DDCDP_DDCCI_ID=0xB7;
              #endif  
              
              }
              
              #if 1
              Bool AdjustDDCCI(MenuItemActionType action)
              {
                  action = action;
                  if (DDCciFlag)
                      Clr_DDCciFlag();
                  else
                      Set_DDCciFlag();
                      Set_DDC2BI_ID();
                  return TRUE;
              }
              #endif
              Bool ExecDDC2Bi(void)
              {
                  if (DDCciFlag)
                      Clr_DDCciFlag();
                  else
                      Set_DDCciFlag();
                      Set_DDC2BI_ID();
                  return TRUE;
              }
              #endif
2906          #if HKC_INPUTSELECT_MODE
              Bool SetInputSourceChange( void ) //111223 Modify
              {
              
                      if ((SrcInputType == UserPrefInputType)
                              )
                      {
                                      if( UnsupportedModeFlag)
                                              Set_BackToUnsupportFlag();
                          return FALSE;
                      }
              
                      SrcInputType = UserPrefInputType;
              
                      if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
                      {
                              UserPrefInputSelectType=INPUT_PRIORITY_AUTO;
                              UserPrefInputType = SrcInputType;       //110424 Modify
                              Set_SaveSettingFlag();
                      }
              
                      ChangeSource();
                      #if AudioFunc && ENABLE_DP_INPUT 
                      PrevInputType=SrcInputType;
                      #endif
                      return TRUE;
                  }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 49  

              #endif
2934          #if ENABLE_AutoDetech
              #if (INPUT_TYPE!=INPUT_1A) && (INPUT_TYPE!=INPUT_1H)
              Bool SetInputToAuto( void )     //111223 Modify
              {
                      UserPrefInputSelectType=INPUT_PRIORITY_AUTO;
                      Set_SaveSettingFlag();
                      return TRUE;
              }
              #endif
              
              
              #if HotInputSelect      //111223 Modify
              
              #if ENABLE_VGA_INPUT
                      Bool SetInputToAnalog(void)     //111223 Modify
                      {
                              UserPrefInputSelectType=INPUT_PRIORITY_VGA;
                              Set_SaveSettingFlag();
                              if (SrcInputType == INPUT_PRIORITY_VGA&&!FreeRunModeFlag)
                              {
                                      return FALSE;
                              }
                  
                              UserPrefInputType=SrcInputType = INPUT_PRIORITY_VGA;                    
                              ChangeSource();
                              #if AudioFunc && ENABLE_DP_INPUT 
                              PrevInputType=SrcInputType;
                              #endif
                              return TRUE;
                      }
              #endif
                   #if ENABLE_DVI_INPUT
                   Bool SetInputToDigital(void)       //111223 Modify
                   {
              
                      UserPrefInputSelectType=INPUT_PRIORITY_DVI;
                      Set_SaveSettingFlag();
                      if (SrcInputType == INPUT_PRIORITY_DVI&&!FreeRunModeFlag)
                      {
                              return FALSE;
                      }
                      
                      UserPrefInputType = SrcInputType = INPUT_PRIORITY_DVI;
                      ChangeSource();
                      #if AudioFunc && ENABLE_DP_INPUT 
                      PrevInputType=SrcInputType;
                      #endif
                      return TRUE;
                   }
                   #endif     
                       
                      #if ENABLE_HDMI_INPUT
                      Bool SetInputToHDMI(void)       //111223 Modify
                      {
                              UserPrefInputSelectType=INPUT_PRIORITY_HDMI;
                              Set_SaveSettingFlag();
                              if (SrcInputType == INPUT_PRIORITY_HDMI&&!FreeRunModeFlag)
                              {
                                      return FALSE;
                              }
                              UserPrefInputType = SrcInputType = INPUT_PRIORITY_HDMI;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 50  

                              ChangeSource();
                              #if AudioFunc && ENABLE_DP_INPUT 
                              PrevInputType=SrcInputType;
                              #endif
                              return TRUE;
                      }
                      #if ENABLE_HDMI2ND_INPUT
                      Bool SetInputToHDMI2(void)      //111223 Modify
                      {
                              UserPrefInputSelectType=INPUT_PRIORITY_HDMI2ND;
                              Set_SaveSettingFlag();
                              if (SrcInputType == INPUT_PRIORITY_HDMI2ND&&!FreeRunModeFlag)
                              {
                                      return FALSE;
                              }
                              UserPrefInputType = SrcInputType = INPUT_PRIORITY_HDMI2ND;
                              ChangeSource();
                              #if AudioFunc && ENABLE_DP_INPUT 
                              PrevInputType=SrcInputType;
                              #endif
                              return TRUE;
                      }
                      #endif  
                      
                      #endif  
              
              #if ENABLE_DPlay_INPUT
                      Bool SetInputToDP(void)   //111223 Modify
                      {
                          UserPrefInputSelectType=INPUT_PRIORITY_DP;
                          Set_SaveSettingFlag();
                          if (SrcInputType == INPUT_PRIORITY_DP&&!FreeRunModeFlag)
                          {
                              return FALSE;
                          }
                          UserPrefInputType = SrcInputType = INPUT_PRIORITY_DP;
                          ChangeSource();
                      #if AudioFunc && ENABLE_DP_INPUT 
                       PrevInputType=SrcInputType;
                      #endif
                          return TRUE;
                      }
              #endif
              
              
              #endif
              #endif
3042          
3043                  Bool EnterHotInputMenu( void )
3044                  {
3045   1                 if(PowerSavingFlag)
3046   1                 {
3047   2                         Clr_PowerSavingFlag();
3048   2                         Power_TurnOnPanel();
3049   2                 }
3050   1                      return TRUE;
3051   1              }       
3052          
3053          #if Dual
3054          
3055                  #if ENABLE_VGA_INPUT
3056              Bool ChangeSourceToAnalog(void)     //111223 Modify
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 51  

3057              {
3058   1              if ((SrcInputType == INPUT_PRIORITY_VGA))
3059   1              {
3060   2                              if( UnsupportedModeFlag)
3061   2                                      Set_BackToUnsupportFlag();
3062   2                  return FALSE;
3063   2              }
3064   1      
3065   1              SrcInputType = INPUT_PRIORITY_VGA;
3066   1      
3067   1              if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
3068   1              {
3069   2                      UserPrefInputSelectType=INPUT_PRIORITY_VGA;
3070   2                      UserPrefInputType = SrcInputType;       //110424 Modify
3071   2                      Set_SaveSettingFlag();
3072   2              }
3073   1      
3074   1              ChangeSource();
3075   1              #if AudioFunc && ENABLE_DP_INPUT 
                      PrevInputType=SrcInputType;
                      #endif
3078   1              return TRUE;
3079   1          }
3080                  #endif
3081          
3082          
3083                  
3084              #if ENABLE_DVI_INPUT
                  Bool ChangeSourceToDigital(void)    //111223 Modify
                  {
                        if ((SrcInputType == INPUT_PRIORITY_DVI)// 130717     william
                       )
                        {
                                      if( UnsupportedModeFlag )
                                              Set_BackToUnsupportFlag();
                                return FALSE;
                        }
                       
                       SrcInputType = INPUT_PRIORITY_DVI;
                       if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
                       {
                       UserPrefInputSelectType=INPUT_PRIORITY_DVI;
                       UserPrefInputType = SrcInputType;      //110424 Modify
                       Set_SaveSettingFlag();
                       }
                       ChangeSource();
                   #if AudioFunc && ENABLE_DP_INPUT 
                       PrevInputType=SrcInputType;
                   #endif
                       return TRUE;
                  }   
                  #endif
3109          
3110          
3111          
3112                  
3113            #if ENABLE_HDMI_INPUT //120424 Modify
3114                  Bool ChangeSourceToHDMI(void)
3115                  {
3116   1                  if (SrcInputType == INPUT_PRIORITY_HDMI)
3117   1                  {
3118   2                              if( UnsupportedModeFlag )
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 52  

3119   2                                      Set_BackToUnsupportFlag();
3120   2                      return FALSE;
3121   2                  }
3122   1                  SrcInputType = INPUT_PRIORITY_HDMI;
3123   1                      if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
3124   1                      {
3125   2                              UserPrefInputSelectType=INPUT_PRIORITY_HDMI;
3126   2                              UserPrefInputType = SrcInputType;       //110424 Modify
3127   2                              Set_SaveSettingFlag();
3128   2                      }
3129   1                  ChangeSource();
3130   1              #if AudioFunc && ENABLE_DP_INPUT 
                      PrevInputType=SrcInputType;
                      #endif
3133   1                  return TRUE;
3134   1              }
3135          
3136            #if ENABLE_HDMI2ND_INPUT      //120424 Modify
                      Bool ChangeSourceToHDMI2(void)
                      {
                          if (SrcInputType == INPUT_PRIORITY_HDMI2ND)
                          {
                                      if( UnsupportedModeFlag )
                                              Set_BackToUnsupportFlag();
                              return FALSE;
                          }
                          SrcInputType = INPUT_PRIORITY_HDMI2ND;
                              if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
                              {
                                      UserPrefInputSelectType=INPUT_PRIORITY_HDMI2ND;
                                      UserPrefInputType = SrcInputType;       //110424 Modify
                                      Set_SaveSettingFlag();
                              }
                          ChangeSource();
                      #if AudioFunc && ENABLE_DP_INPUT 
                      PrevInputType=SrcInputType;
                      #endif
                          return TRUE;
                      }
                 #endif
3159          
3160            
3161             #endif
3162          
3163          #if ENABLE_DP_INPUT
                       Bool ChangeSourceToDP(void)
                          {
                              if (SrcInputType == INPUT_PRIORITY_DP)
                              {
                                  if( UnsupportedModeFlag )
                                      Set_BackToUnsupportFlag();
                                  return FALSE;
                              }
                                SrcInputType = INPUT_PRIORITY_DP;
                              if(UserPrefInputSelectType!=INPUT_PRIORITY_AUTO)
                              {
                                  UserPrefInputSelectType=INPUT_PRIORITY_DP;
                                  UserPrefInputType = SrcInputType;   //110424 Modify
                                  Set_SaveSettingFlag();
                              }
                              ChangeSource();
                          #if AudioFunc && ENABLE_DP_INPUT 
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 53  

                              PrevInputType=SrcInputType;
                              #endif
                              return TRUE;
                          }
              #endif
3186          
3187          
3188          
3189              #endif // dual
3190              
3191          
3192          
3193          
3194          #if CHIP_ID == CHIP_TSUMV||CHIP_ID == CHIP_TSUM2
              
                      BYTE code SharpnessTable[]=
                      {
                              #if CHIP_ID == CHIP_TSUMV       //130306 Modify
                              0x1B, 0x1C, 0x1D, 0x1E, 0x1F,0x20,0x24, 0x28, 0x2C, 0x31, 0x35
                              #else
                            0x1B, 0x1C, 0x1D, 0x1E, 0x1F, 0x20, 0x21,0x22, 0x23, 0x24, 0x25   //william0524 Modify For Cha
             -nge ByPassSharpness Position//0x1D, 0x1E, 0x1F, 0x20, 0x21,0x22, 0x23, 0x24, 0x25, 0x26,0x27
                              #endif          
                      };
              
              #elif CHIP_ID == CHIP_TSUMC||CHIP_ID == CHIP_TSUMD ||CHIP_ID == CHIP_TSUM9||CHIP_ID == CHIP_TSUMF
3206              BYTE code SharpnessTable[]=
3207              {
3208                 0x00, 0x02,0x04, 0x06,0x08, 0x0B, 0x10,0x15, 0x1A, 0x1F, 0x24//william0524 Modify For Change ByPass
             -Sharpness Position    //0x00, 0x04, 0x08, 0x0B, 0x10,0x15, 0x1A, 0x1F, 0x24, 0x29,0x2E//  0x00, 0x05, 0x0A, 0x0E, 0x14,0x19
             -, 0x1E, 0x23, 0x28, 0x2D,0x32 //130407 Modify
3209              };
3210              
3211          #else
              
              BYTE code SharpnessTable[]=
              {
                  0x03,0x04,0x05, 0x06, 0x07, 0x08, 0x09,0x0A, 0x0B, 0x0C, 0x0D       // william0524 Modify For Change ByPassS
             -harpness Position//0x05, 0x06, 0x07, 0x08, 0x09,0x0A, 0x0B, 0x0C, 0x0D,0x0E,0x0F
              };
              
              #endif
3219          
3220          
3221          
3222          
3223          #if ( LowBlueLightType==LowBlueLight_ColorTemp)||(LowBlueLightType==LowBlueLight_Misc_Group)
3224          WORD DecIncValueCirculate( MenuItemActionType action, WORD value, WORD minValue, WORD maxValue, BYTE step 
             -)
3225          {
3226   1          if ( action == MIA_IncValue )
3227   1          {
3228   2              if ( value == maxValue )
3229   2                  value = minValue;
3230   2              else
3231   2                  value += step;
3232   2          }
3233   1      
3234   1          else if ( action == MIA_DecValue )
3235   1          {
3236   2              if ( value == minValue )
3237   2                  value = maxValue;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 54  

3238   2              else
3239   2                  value -= step;
3240   2          }
3241   1          return value;
3242   1      }
3243          #endif
3244          
3245          #if ENABLE_FACTORY_BLACKLEVEL
              Bool AdjustColorBlacklevel( MenuItemActionType action )
              {
                  WORD tempValue;
                  tempValue = DecIncValue( action, UserprefRedBlackLevel, 0, 100, 1 );
                  if( tempValue == UserprefRedBlackLevel )
                  {
                      return FALSE;
                  }
                  UserprefRedBlackLevel = tempValue;
                  UserprefGreenBlackLevel = tempValue;
                  UserprefBlueBlackLevel = tempValue;
              
                  mStar_AdjustUserPrefBlacklevel( UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBlackLevel
             - );
              
                  SaveUserPref();
                  return TRUE;
              }
              WORD GetColorBlacklevelValue( void )
              {
                  return UserprefRedBlackLevel;
              }
              
              #endif
3269          
3270          
3271          
3272          Bool ResetAllSetting(void)
3273          {
3274   1          #if 0//ndef SETTING_IN_FLASH_12K
                  ModeInfoType modeInfo;
                  #endif
3277   1          WORD hFreq, vFreq;  
3278   1          hFreq = HFreq(SrcHPeriod);
3279   1          vFreq = VFreq(hFreq, SrcVTotal);
3280   1         
3281   1          UserPrefOsdHStart = DefOsdHPosValue;//50;
3282   1          UserPrefOsdVStart = DefOsdVPosValue;//50;
3283   1      
3284   1      #if 0//ENABLE_FREESYNC
                  UserprefFreeSyncMode = FreeSyncMenuItems_On;
                  msAPI_combo_IPEnableDDRFlag(UserprefFreeSyncMode);
              #endif
3288   1          
3289   1      
3290   1          #if !USEFLASH
                  if(FactoryModeFlag)
                      FlashEnableWP();
                  #endif
3294   1          
3295   1          #if INPUT_TYPE == INPUT_1A
                  UserPrefInputSelectType = INPUT_PRIORITY_VGA;
                      #elif INPUT_TYPE == INPUT_1H
                  UserPrefInputSelectType = INPUT_PRIORITY_HDMI;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 55  

                      #else
3300   1          #if DISABLE_AUTO_SWITCH
                      UserPrefInputSelectType = FIXED_PORT;
                  #else
3303   1          UserPrefInputSelectType = INPUT_PRIORITY_AUTO; // 071221 modified for initial UserPrefInputSelectType
3304   1          #endif      
3305   1          #endif
3306   1              
3307   1      #if AudioFunc
3308   1      
3309   1          UserPrefVolume = DefVolume;
3310   1      
3311   1        if(UserPrefMuteState)
3312   1        {
3313   2             UserPrefMuteState=0;
3314   2              SwitchMute(MIA_Nothing);     
3315   2        }
3316   1        else
3317   1              mStar_AdjustVolume(UserPrefVolume);
3318   1      #endif
3319   1      
3320   1              
3321   1      #if ENABLE_FREESYNC
                 // if(UserprefFreeSyncMode != FreeSyncMenuItems_Off)
                  {
                  #if FreeSyncMenu_Enable
                      if (CURRENT_INPUT_IS_HDMI())    
                          UserprefFreeSyncMode = FreeSyncStatues;//FreeSyncMenuItems_Off
                      #else
                      UserprefFreeSyncMode = FreeSyncMenuItems_On;//FreeSyncMenuItems_Off
                      #endif
              #if FreeSyncSwitchEDID  
                      FreeSyncEDIDSwitch(HDMI1,UserprefFreeSyncMode);
                     //   return 0;
                      FreeSyncEDIDSwitch(HDMI2,UserprefFreeSyncMode);
                     //   return 0;
              #endif  
              #if FreeSyncMenu_Enable
                    //  msAPI_combo_IPEnableDDRFlag(UserprefFreeSyncMode);
               #endif
                  }
              #endif
3341   1      
3342   1          if (FactoryModeFlag)
3343   1          // User  R/G/B
3344   1          {
3345   2              UserPrefRedColor = 0xb2; //0xff;   // 0105 ask by LAI
3346   2              UserPrefGreenColor = 0xb2; //0xff; // 0105 ask by LAI
3347   2              UserPrefBlueColor = 0xb2; //0xff;  // 0105 ask by LAI
3348   2          }
3349   1          #if ENABLE_FACTORY_BLACKLEVEL  ||   ENABLE_DDCCI_BLACKLEVEL   
                      UserprefRedBlackLevel = DefRedBlackLevel;
                      UserprefGreenBlackLevel = DefGreenBlackLevel;
                      UserprefBlueBlackLevel = DefBlueBlackLevel;
                      mStar_AdjustUserPrefBlacklevel(UserprefRedBlackLevel, UserprefGreenBlackLevel, UserprefBlueBlackLe
             -vel);
                  #endif
3355   1          // UserPrefLanguage=ResetLanguage;           //20050919 cancel
3356   1          #if Enable_Expansion
3357   1              if(UserprefExpansionMode  != DefExpansion)
3358   1              {
3359   2              UserprefExpansionMode = DefExpansion;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 56  

3360   2                mStar_BlackWhiteScreenCtrl(BW_SCREEN_BLACK);/////180711 modify
3361   2      
3362   2          #if (CHIP_ID!=CHIP_TSUMU && CHIP_ID!=CHIP_TSUM2&& CHIP_ID!=CHIP_TSUMC&& CHIP_ID!=CHIP_TSUMD&& CHIP_ID!
             -=CHIP_TSUMF)
                      mStar_SetScalingFactor();
                      #else
3365   2              #if ENABLE_OVER_SCAN
                      mStar_SetCaptureWindow();
                      #endif
3368   2              mStar_SetupPath();
3369   2              mStar_SetTimingGen(PanelWidth, PanelHeight, FALSE);
3370   2              #endif
3371   2              mStar_BlackWhiteScreenCtrl(BW_SCREEN_OFF);/////180711 modify
3372   2              }
3373   1          #endif
3374   1      
3375   1      
3376   1      
3377   1      
3378   1          UserPrefSavedModeIndex = NumberOfMode;
3379   1          UserPrefOsdTime = DefOsdTime;
3380   1          UserPrefOsdTrans = 0;               //120119 Modify
3381   1          //UserPrefLanguage = DefLanguage;
3382   1          Osd_SetTransparence(UserPrefOsdTrans);
3383   1          #ifdef OffPower           //090331 xiandi.yu Auto Off Power
                  UserPrefAutoPowerOff=0;
                  AutoPowerOffMTime=0;
                  AutoPowerOffHTime=0;
                 ShowOffPowerWarningFlag = 0;
                 #endif
3389   1      
3390   1      
3391   1          UserPrefSharpness = DefSharpness;                                                   //120105 Modify
3392   1      #if CHIP_ID == CHIP_TSUMV
                      if(CURRENT_INPUT_IS_DVI())
                              msAdjustSharpness( MAIN_WINDOW,  GetRealSharpness() ,1);        //120105 Modify
                      else
              #endif 
3397   1          msAdjustSharpness( MAIN_WINDOW,  GetRealSharpness() ,0);    //120105 Modify
3398   1      
3399   1          UserPrefBrightness = DefBrightness;
3400   1          UserPrefContrast = DefContrast;
3401   1      
3402   1          UserPrefBrightnessUser = UserPrefBrightness;
3403   1          UserPrefContrastUser = UserPrefContrast;
3404   1              
3405   1          UserPrefECOMode = ECO_Standard;
3406   1          UserPrefColorTemp = DefColorTemp;//CTEMP_Warm1;//CTEMP_Warm1; //CTEMP_9300K 20051115 wmz
3407   1      
3408   1      
3409   1              #if PresetMode_Enable
                       UserPrefColorTemp_Preset       = CTEMP_Warm1;
                       UserPrefBrightness_Preset      = DefBrightness;
                       UserPrefContrast_Preset        = DefContrast;
                       UserPrefGamaMode_Preset = GAMA1;
                      #endif
3415   1      
3416   1      
3417   1              
3418   1          SetColorTemp(); //9300K()
3419   1      
3420   1      
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 57  

3421   1      
3422   1              
3423   1              #if Enable_Gamma
                  UserPrefGamaMode = GAMA1;
                  mStar_SetupGamma( GAMA1 );
                      #endif
3427   1              if(UserPrefDcrMode)
3428   1              {
3429   2                  UserPrefDcrMode = 0;
3430   2                      msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
3431   2              }
3432   1      
3433   1      
3434   1          
3435   1      #if 0//ENABLE_RTE
                              
                      UserPrefRTEMode=DefRTEMode;
              
                      #if ENABLE_DISPLAY_UNDERSCAN
                      if(UnderScanSetting.Enable)
                      {
                              msOverDriveOnOff( FALSE );
                      }
                  else  if(g_SetupPathInfo.bFBMode) // FB mode, FRC case
                     {
                              msOverDriveOnOff( FALSE );
                      }
                  else
                      #endif
                     #if ENABLE_DUAL_LINK
                     if((GetVfreq()>85)&&(!ENABLE_FREESYNC)
                              #if ENABLE_120Hz_OD
                              && !(g_SetupPathInfo.wImgSizeOutH==PanelWidth &&  g_SetupPathInfo.wImgSizeOutV==PanelHeight)&&(Userpr
             -efExpansionMode !=Expansion_Aspect)
                              #endif
                              )//(SrcModeIndex==MODE_1920x1080P_144Hz)        //130328 Modify
                     {
                         msOverDriveOnOff( FALSE );
                     }
                     else
                      #endif
                  {
                          msOverDriveOnOff( TRUE );
                  }
                  {
                             msOverDriveOnOff( FALSE );
                             //Clr_OverDriveOnFlag();
                                  msRTE_LoadLUT();
                             msOverDriveOnOff( TRUE );
                   }
              #endif
3471   1      
3472   1      
3473   1      #if ENABLE_RTE
                              
                      UserPrefRTEMode=DefRTEMode;
              
                      msOverDriveOnOff( DefRTEMode );
              #endif
3479   1      
3480   1      
3481   1      
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 58  

3482   1          // 2006/11/10 5:15PM by KK not need reset this item    UserPrefLanguage = LANG_English;
3483   1          #if ECO
3484   1              SetECO();
3485   1          #endif
3486   1              #if Enable_YCM_Mode
                  UserPrefYColor = DefColor;
                  UserPrefCColor = DefColor;
                  UserPrefMColor = DefColor;
                      #endif
3491   1              
3492   1              //if(FactoryModeFlag)
3493   1              {
3494   2              UserPrefRedColorUser = DefColor;
3495   2              UserPrefGreenColorUser = DefColor;
3496   2              UserPrefBlueColorUser = DefColor;
3497   2              }
3498   1              
3499   1      #if MWEFunction
3500   1          UserPrefHue = 50;
3501   1          UserPrefSaturation = 0x80;
3502   1          UserPrefSubContrast = DefSubContrast;
3503   1          UserPrefSubBrightness = DefSubBrightness;
3504   1      
3505   1          // 2006/10/26 6:46PM by Emily     UserPrefSubSharpness = 11;
3506   1              //msAdjustSharpness(SUB_WINDOW, 11, 1); //111223 Modify
3507   1              msAdjustSubBrightness( SUB_WINDOW, UserPrefSubBrightness, UserPrefSubBrightness, UserPrefSubBrightness );
3508   1              msAdjustVideoContrast( SUB_WINDOW, DefContrastBase + UserPrefContrast );
3509   1              msAdjustVideoHue( SUB_WINDOW, UserPrefHue );
3510   1              msAdjustVideoSaturation( SUB_WINDOW, UserPrefSaturation );
3511   1       #endif   
3512   1      
3513   1              #if DDCCI_ENABLE && DDCCCIMenu_Enable//20130509
                      Set_DDCciFlag();
                      Set_DDC2BI_ID();
                      #endif
3517   1      
3518   1          #if USEFLASH
3519   1          UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
3520   1          #else
                  SaveMonitorSetting(); //1020
                  #endif
3523   1      #if 0    
                  if ((SrcInputType < Input_Digital))//
                  {
                      if((!FactoryModeFlag)&&PowerOnFlag)//add PowerOnFlag for DC off/on close Burnin 101220 add by win
                      {
                          if (mStar_AutoGeomtry() == TRUE)
                          {
                              UserPrefAutoTimes = 1;
                              UserPrefAutoHStart = UserPrefHStart;
                              UserPrefAutoVStart = UserPrefVStart;
                          }
                      }
                      {
                          BYTE modeIndex, flag;
                          flag = SrcFlags; //UserModeFlag
                          modeIndex = SaveIndex; //SrcModeIndex;
                          SrcFlags &= ~bUserMode;
                              #if !USEFLASH
                                  for (SaveIndex = 0; SaveIndex < NumberOfMode; SaveIndex++)
                                  {
                                      NVRam_WriteByte(nvrModeAddr(checksum), 0);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 59  

                                  }
                                  for (SaveIndex = 0; SaveIndex < NumberOfMode; SaveIndex++)
                                  {
                                      modeInfo.HerFreq = 0;
                                      modeInfo.VerFreq = 0;
                                      modeInfo.VTotal = 0;
                                      modeInfo.Flags = 0;
                                      NVRam_WriteTbl(nvrModeInfoAddr(SaveIndex), (BYTE*) &modeInfo, ModeInfoSize);
                                  }
                                  SaveIndex = 0;
                                  SrcFlags = flag;
                                  modeInfo.HerFreq = hFreq;
                                  modeInfo.VerFreq = vFreq;
                                  modeInfo.VTotal = SrcVTotal;
                                  modeInfo.Flags = SrcFlags &0x13;
                                  NVRam_WriteTbl(nvrModeInfoAddr(SaveIndex), (BYTE*) &modeInfo, ModeInfoSize);
                                  NVRam_WriteByte(nvrModeAddr(checksum), 0);
                                  NVRam_WriteByte(nvrMonitorAddr(SavedModeIndex), UserPrefSavedModeIndex);
                                  SaveModeSetting();
                          #else
                                      SaveIndex = SrcModeIndex;//0;
                                              SrcFlags = flag;
                                      #if 1//ndef SETTING_IN_FLASH_12K
                                       modeInfo.HerFreq = hFreq;
                                       modeInfo.VerFreq = vFreq;
                                       modeInfo.VTotal = SrcVTotal;
                                       modeInfo.Flags = SrcFlags &0x13;
                                      #endif
                                      Flash_ClearModeSet();
                                      UserPref_EnableFlashSaveBit(bFlashSaveModeBit); 
                           #endif
                      }
                  }
                  else
                  {
                      Delay1ms(500);
                  }
              #endif  
3582   1          Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
3583   1      #if Enable_OsdEngine1
                  Osd_SetOsdEngine(1);
                  Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
                  Osd_SetOsdEngine(0);
              #endif
3588   1      
3589   1      
3590   1          if (FactoryModeFlag)
3591   1          {
3592   2                  Clr_FactoryModeFlag();
3593   2                  hw_ClrAmberLed();
3594   2                  hw_SetGreenLed();   
3595   2          }
3596   1      
3597   1      
3598   1             Clr_BurninModeFlag();
3599   1              Clr_DoBurninModeFlag();//edit by lizzie,100429.for DC ON/OFF can't clr burnin mode the 1st time
3600   1              SaveMonitorSetting();//UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
3601   1      
3602   1          #if ENABLE_OSD_LowBlueLight
3603   1          UserprefLowBlueLightMode  = DEF_LowBlueLight_MODE; 
3604   1      #if LowBlueLightType == LowBlueLight_SharpFunc
                       gTempLowBlueMode = LOW_BLUE_LIGHT_OFF;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 60  

              #endif
3607   1              
3608   1          SetLowBlueLight();
3609   1          #endif
3610   1              
3611   1      #if sRGBIssue
                      UserPrevDcrMode=UserPrefDcrMode;
                      UserPrevGamaMode = UserPrefGamaMode;
                      UserPrevECOMode = UserPrefECOMode;
              #endif
3616   1      
3617   1          return TRUE;
3618   1      }
3619          
3620          
3621          Bool AutoConfig(void)
3622          {
3623   1          Bool result;
3624   1          result = mStar_AutoGeomtry();
3625   1          //UserPrefAutoHStart=UserPrefHStart;
3626   1          if (result)
3627   1          {
3628   2              UserPrefAutoHStart = UserPrefHStart;
3629   2              UserPrefAutoVStart = UserPrefVStart;
3630   2              UserPrefAutoTimes = 1;
3631   2          }
3632   1          else
3633   1          {
3634   2              UserPrefHTotal = StandardModeHTotal;
3635   2              UserPrefHStart = StandardModeHStart;
3636   2              UserPrefVStart = StandardModeVStart;
3637   2              UserPrefAutoHStart = UserPrefHStart;
3638   2              UserPrefAutoVStart = UserPrefVStart;
3639   2              UserPrefPhase = 18;
3640   2              UserPrefAutoTimes = 1;
3641   2              drvADC_AdjustHTotal( UserPrefHTotal );
3642   2              drvADC_SetPhaseCode( UserPrefPhase );
3643   2              msWrite2Byte( SC0_07, UserPrefHStart );
3644   2              mStar_AdjustVPosition(UserPrefAutoVStart);
3645   2          }
3646   1              #if USEFLASH
3647   1              UserPref_EnableFlashSaveBit(bFlashSaveModeBit); 
3648   1              #else
                      SaveModeSetting();
                      #endif
3651   1      
3652   1          return result;
3653   1      }
3654          
3655          #if Enabe_DDCCI_FUNCTION
3656          
3657            
3658              Bool ResetGeometry(void)
3659              {
3660   1      
3661   1              #if !USEFLASH
                      UserPrefHStart = StandardModeHStart;
                      mStar_AdjustHPosition(UserPrefHStart);
                      NVRam_WriteByte(nvrModeAddr(HStart), UserPrefHStart);
                      UserPrefVStart = StandardModeVStart;
                      mStar_AdjustVPosition(UserPrefVStart);
                      NVRam_WriteByte(nvrModeAddr(VStart), UserPrefVStart);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 61  

                      UserPrefHTotal = StandardModeHTotal;
                              drvADC_AdjustHTotal( UserPrefHTotal );
                      NVRam_WriteByte(nvrModeAddr(HTotal), UserPrefHTotal);
                      UserPrefPhase = 0;
                              drvADC_SetPhaseCode( UserPrefPhase );
                      NVRam_WriteByte(nvrModeAddr(Phase), UserPrefPhase);
                      AutoConfig();
                     #else 
3676   1              UserPrefHStart = StandardModeHStart;
3677   1              mStar_AdjustHPosition(UserPrefHStart);
3678   1              UserPrefVStart = StandardModeVStart;
3679   1              mStar_AdjustVPosition(UserPrefVStart);
3680   1              UserPrefHTotal = StandardModeHTotal;
3681   1                      drvADC_AdjustHTotal( UserPrefHTotal );
3682   1              UserPrefPhase = 0;
3683   1                      drvADC_SetPhaseCode( UserPrefPhase );
3684   1              AutoConfig();      
3685   1              #endif          
3686   1              return TRUE;
3687   1          }
3688          
3689          #endif
3690          // 090430 check
3691          void SaveUserPref(void)
3692          {
3693   1          #if USEFLASH
3694   1          UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
3695   1          if (SrcInputType < Input_Digital)
3696   1          {
3697   2              UserPref_EnableFlashSaveBit(bFlashSaveModeBit);
3698   2          }
3699   1          #else
                  SaveMonitorSetting();
                  if (SrcInputType < Input_Digital)
                  {
                      SaveModeSetting();
                  }
                  #endif
3706   1      }
3707          
3708          void SaveUserPrefSetting(BYTE menuPageIndex)
3709          {
3710   1          menuPageIndex = 0;
3711   1          SaveUserPref();
3712   1          Clr_SaveSettingFlag();
3713   1      }
3714          #if !USEFLASH
              
              void SaveFactorySetting( void )
              {
                  NVRam_WriteTbl( FactorySettingAddr, ( BYTE* ) &FactorySetting, FactorySettingSize );
              #if DEBUG_MSG
                  //printMsg( "Save FactorySetting" );
              #endif
              }
              #endif
3724          
3725          
3726          //=======================================================================================
3727          // For Factory alignment
3728          #if 1
3729              Bool AutoColor(void)
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 62  

3730              {
3731   1              Bool result;
3732   1          #if CHIP_ID>=CHIP_TSUMC
3733   1              if (SrcInputType == Input_Digital  || SrcInputType == Input_Digital2 || SrcInputType == Input_Disp
             -layport|| SrcInputType == Input_Displayport3 )        //121128 Modify
3734   1          #else
                  if (SrcInputType == Input_Digital  || SrcInputType == Input_Digital2 || SrcInputType == Input_Displayp
             -ort ) //121128 Modify
                  #endif
3737   1              return FALSE;   //120204 Modify
3738   1              result = mStar_AutoColor();
3739   1              Osd_SetTextColor(CP_RedColor, CP_WhiteColor);
3740   1              if (result)
3741   1              {
3742   2                  SaveFactorySetting();//UserPref_EnableFlashSaveBit(bFlashSaveFactoryBit); 
3743   2              }
3744   1      
3745   1              if (UserPrefAutoTimes == 0)
3746   1              {
3747   2                  mStar_AutoGeomtry();
3748   2                  UserPrefAutoTimes = 1;
3749   2                  UserPrefAutoHStart = UserPrefHStart;
3750   2                  UserPrefAutoVStart = UserPrefVStart;
3751   2                  #if USEFLASH
3752   2                  UserPref_EnableFlashSaveBit(bFlashSaveModeBit); 
3753   2                  #else
                          SaveModeSetting();
                          #endif
3756   2              }
3757   1              else
3758   1              {
3759   2                  Delay1ms(500);
3760   2              }
3761   1              return result;
3762   1          }
3763              #if AboutDSUBFunc_Enable
3764                  //====================================================
3765                          #define ADC_RESOLUTION  0x0FFF
3766                  Bool AdjustRedGain(MenuItemActionType action)
3767                  {
3768   1                  WORD tempValue;
3769   1                  tempValue = DecIncValue(action, UserPrefAdcRedGain, 0, ADC_RESOLUTION, 1);          //110311 Modify
3770   1                  if (tempValue == UserPrefAdcRedGain)
3771   1                  {
3772   2                      return FALSE;
3773   2                  }
3774   1                  UserPrefAdcRedGain = tempValue;
3775   1                              drvADC_SetRedGainCode(UserPrefAdcRedGain);
3776   1                  return TRUE;
3777   1              }
3778                  WORD GetRedGainValue(void)
3779                  {
3780   1                  return UserPrefAdcRedGain;
3781   1              }
3782                  Bool AdjustGreenGain(MenuItemActionType action)
3783                  {
3784   1                  WORD tempValue;
3785   1                  tempValue = DecIncValue(action, UserPrefAdcGreenGain, 0, ADC_RESOLUTION, 1);                //110311 Modify
3786   1                  if (tempValue == UserPrefAdcGreenGain)
3787   1                  {
3788   2                      return FALSE;
3789   2                  }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 63  

3790   1                  UserPrefAdcGreenGain = tempValue;
3791   1                              drvADC_SetGreenGainCode(UserPrefAdcGreenGain);
3792   1                  return TRUE;
3793   1              }
3794                  WORD GetGreenGainValue(void)
3795                  {
3796   1                  return UserPrefAdcGreenGain;
3797   1              }
3798                  Bool AdjustBlueGain(MenuItemActionType action)
3799                  {
3800   1                  WORD tempValue;
3801   1                  tempValue = DecIncValue(action, UserPrefAdcBlueGain, 0, ADC_RESOLUTION, 1);         //110311 Modify
3802   1                  if (tempValue == UserPrefAdcBlueGain)
3803   1                  {
3804   2                      return FALSE;
3805   2                  }
3806   1                  UserPrefAdcBlueGain = tempValue;
3807   1                              drvADC_SetBlueGainCode(UserPrefAdcBlueGain);
3808   1                  return TRUE;
3809   1              }
3810                  WORD GetBlueGainValue(void)
3811                  {
3812   1                  return UserPrefAdcBlueGain;
3813   1              }
3814                  //====================================================
3815                  //====================================================
3816                  Bool AdjustAdcRedOffset(MenuItemActionType action)
3817                  {
3818   1                  WORD tempValue;
3819   1                  tempValue = DecIncValue(action, UserPrefAdcRedOffset, 0, ADC_RESOLUTION, 1);                //110311 Modify
3820   1                  if (tempValue == UserPrefAdcRedOffset)
3821   1                  {
3822   2                      return FALSE;
3823   2                  }
3824   1                  UserPrefAdcRedOffset = tempValue;
3825   1                              drvADC_SetRedOffsetCode(UserPrefAdcRedOffset);
3826   1                  return TRUE;
3827   1              }
3828                  WORD GetAdcRedOffsetValue(void)
3829                  {
3830   1                  return UserPrefAdcRedOffset;
3831   1              }
3832                  Bool AdjustAdcGreenOffset(MenuItemActionType action)
3833                  {
3834   1                  WORD tempValue;
3835   1                  tempValue = DecIncValue(action, UserPrefAdcGreenOffset, 0, ADC_RESOLUTION, 1);              //110311 Modif
             -y
3836   1                  if (tempValue == UserPrefAdcGreenOffset)
3837   1                  {
3838   2                      return FALSE;
3839   2                  }
3840   1                  UserPrefAdcGreenOffset = tempValue;
3841   1                              drvADC_SetGreenOffsetCode(UserPrefAdcGreenOffset);
3842   1                  return TRUE;
3843   1              }
3844                  WORD GetAdcGreenOffsetValue(void)
3845                  {
3846   1                  return UserPrefAdcGreenOffset;
3847   1              }
3848                  Bool AdjustAdcBlueOffset(MenuItemActionType action)
3849                  {
3850   1                  WORD tempValue;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 64  

3851   1                  tempValue = DecIncValue(action, UserPrefAdcBlueOffset, 0, ADC_RESOLUTION, 1);               //110311 Modify
3852   1                  if (tempValue == UserPrefAdcBlueOffset)
3853   1                  {
3854   2                      return FALSE;
3855   2                  }
3856   1                  UserPrefAdcBlueOffset = tempValue;
3857   1                              drvADC_SetBlueOffsetCode(UserPrefAdcBlueOffset);
3858   1                  return TRUE;
3859   1              }
3860                  WORD GetAdcBlueOffsetValue(void)
3861                  {
3862   1                  return UserPrefAdcBlueOffset;
3863   1              }
3864              #endif
3865                  void GetColorTempRGB(ColorType *pstColor)
3866                  {
3867   1      #if LowBlueLightType == LowBlueLight_SharpFunc
              
                      if(UserPrefColorTemp<CTEMP_LowBlue)
                      {
                      pstColor->u8Red =  *ColorTempPtr[UserPrefColorTemp][0];
                      pstColor->u8Green =  *ColorTempPtr[UserPrefColorTemp][1];
                      pstColor->u8Blue =  *ColorTempPtr[UserPrefColorTemp][2];
                      }
                      else
                      {
                      pstColor->u8Red =  LBLColorTempPtr[UserprefLowBlueLightMode][0];
                      pstColor->u8Green =  LBLColorTempPtr[UserprefLowBlueLightMode][1];
                      pstColor->u8Blue =  LBLColorTempPtr[UserprefLowBlueLightMode][2];
                      }
              
              #else   
3883   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                      {       
                              pstColor->u8Red         =*(ColorTempPtr[UserPrefColorTemp_Preset][0]);
                              pstColor->u8Green       =*(ColorTempPtr[UserPrefColorTemp_Preset][1]);
                              pstColor->u8Blue        =*(ColorTempPtr[UserPrefColorTemp_Preset][2]);  
                      }
                      else
              #endif  
3892   1              {       
3893   2                      pstColor->u8Red         =*(ColorTempPtr[UserPrefColorTemp][0]);
3894   2                      pstColor->u8Green       =*(ColorTempPtr[UserPrefColorTemp][1]);
3895   2                      pstColor->u8Blue        =*(ColorTempPtr[UserPrefColorTemp][2]); 
3896   2              }
3897   1      
3898   1      
3899   1              #if ENABLE_OSD_LowBlueLight     
3900   1                       if(LOW_BLUE_LIGHT_Strong==UserprefLowBlueLightMode)
3901   1                      pstColor->u8Blue-=UserprefLowBlueLightMode*15;        
3902   1                        else
3903   1                      pstColor->u8Blue-=UserprefLowBlueLightMode*10;   
3904   1              #endif
3905   1      #endif
3906   1                      
3907   1              }
3908              void ReadColorTempSetting(void) //120522
3909              {
3910   1      #if PresetMode_Enable
                      if(UserPrefECOMode == ECO_Preset)
                      {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 65  

                      UserPrefRedColor =  *ColorTempPtr[UserPrefColorTemp_Preset][0];
                      UserPrefGreenColor =  *ColorTempPtr[UserPrefColorTemp_Preset][1];
                      UserPrefBlueColor =  *ColorTempPtr[UserPrefColorTemp_Preset][2];
              
                      // 2006/11/10 11:13PM by KK   if(!UserPrefDcrMode) // for under DCR mode, the picture show filter
                      mStar_AdjustBrightness(UserPrefBrightness_Preset);
                      mStar_AdjustContrast(UserPrefContrast_Preset);
                      }
                      else
              #endif                   
3923   1              {
3924   2      
3925   2      #if LowBlueLightType ==  LowBlueLight_SharpFunc
              if(UserPrefColorTemp<CTEMP_LowBlue)
                      {
                      UserPrefRedColor =  *ColorTempPtr[UserPrefColorTemp][0];
                      UserPrefGreenColor =  *ColorTempPtr[UserPrefColorTemp][1];
                      UserPrefBlueColor =  *ColorTempPtr[UserPrefColorTemp][2];               
                      }
                      else
                      {
                      UserPrefRedColor =  LBLColorTempPtr[UserprefLowBlueLightMode][0];
                      UserPrefGreenColor =  LBLColorTempPtr[UserprefLowBlueLightMode][1];
                      UserPrefBlueColor =  LBLColorTempPtr[UserprefLowBlueLightMode][2];      
                      }
              #else
3939   2              UserPrefRedColor =  *ColorTempPtr[UserPrefColorTemp][0];
3940   2              UserPrefGreenColor =  *ColorTempPtr[UserPrefColorTemp][1];
3941   2              UserPrefBlueColor =  *ColorTempPtr[UserPrefColorTemp][2];
3942   2      #endif
3943   2                      
3944   2              CheckColorValueRange();
3945   2              UserPrefBrightness %= 101;
3946   2      
3947   2              // 2006/11/10 11:13PM by KK   if(!UserPrefDcrMode) // for under DCR mode, the picture show filter
3948   2              mStar_AdjustBrightness(UserPrefBrightness);
3949   2              mStar_AdjustContrast(UserPrefContrast);
3950   2              }
3951   1          }
3952          #if ECO
3953              void SetECO(void)
3954              {
3955   1                       if (UserPrefECOMode == ECO_Internet)
3956   1                      {
3957   2                              UserPrefBrightness = DefBriValue_ECO_Internet;
3958   2                              UserPrefContrast = DefContrast;
3959   2      
3960   2                              //mStar_AdjustUserPrefBlacklevel( 50, 50, 50 );
3961   2                      }
3962   1                      else if (UserPrefECOMode == ECO_Game)
3963   1                      {
3964   2                              UserPrefBrightness = DefBriValue_ECO_Game;
3965   2                              UserPrefContrast = DefContrast;
3966   2      
3967   2                              //mStar_AdjustUserPrefBlacklevel( 70, 70, 70 );
3968   2                      }
3969   1                  #if ENABLE_FPS_RTS
                              else if (UserPrefECOMode == ECO_FPS)
                              {
                                      UserPrefBrightness = 50;
                                      UserPrefContrast = DefContrast;
                              }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 66  

                              else if (UserPrefECOMode == ECO_RTS)
                              {
                                      UserPrefBrightness = 70;
                                      UserPrefContrast = DefContrast;
                              }
                              #endif
3981   1                      else if (UserPrefECOMode == ECO_Movie)
3982   1                      {
3983   2                              UserPrefBrightness = DefBriValue_ECO_Movies;
3984   2                              UserPrefContrast = DefContrast;
3985   2      
3986   2                              //mStar_AdjustUserPrefBlacklevel( 50, 50, 50 );
3987   2                      }
3988   1      #if     PresetMode_Enable
                              else if (UserPrefECOMode == ECO_Preset)
                              {
                              
                              }
              #endif
3994   1                      else
3995   1                      {
3996   2                              UserPrefBrightness = UserPrefBrightnessUser;
3997   2                              UserPrefContrast = UserPrefContrastUser;
3998   2      
3999   2                              //mStar_AdjustUserPrefBlacklevel( 50, 50, 50 );
4000   2                      }
4001   1                      SetColorTemp();
4002   1                      //mStar_AdjustBrightness(UserPrefBrightness);
4003   1                      //mStar_AdjustContrast(UserPrefContrast);
4004   1          }
4005              Bool AdjustECOMode(MenuItemActionType action)
4006              {
4007   1              UserPrefDcrMode = 0;
4008   1              msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
4009   1      
4010   1                      ICE_MAIN_CTRL(0);                               //120204 Modify
4011   1                      ICE_SUB_CTRL(0);                                //120204 Modify
4012   1              if (action == MIA_DecValue)
4013   1              {
4014   2                  UserPrefECOMode = (UserPrefECOMode + ECO_Nums - 1) % ECO_Nums; //Benz have some bug issue
4015   2              }
4016   1              else
4017   1              {
4018   2                  UserPrefECOMode = (UserPrefECOMode + 1) % ECO_Nums;
4019   2              }
4020   1      #if sRGBIssue
                      UserPrevECOMode = UserPrefECOMode;
              #endif
4023   1                      
4024   1                      #if CT_sRGB_ENABLE
                      if(UserPrefColorTemp==CTEMP_SRGB)
                      {
                              UserPrefColorTemp=CTEMP_Warm1;
                                      #if !USEFLASH
                                      NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
                      }
                              #endif
4033   1                      #if !USEFLASH
                              NVRam_WriteByte(nvrMonitorAddr(ECOMode), UserPrefECOMode);
                              NVRam_WriteByte(nvrMonitorAddr(DcrMode), UserPrefDcrMode);
                              #else
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 67  

4037   1                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
4038   1                      #endif
4039   1              SetECO();
4040   1              return TRUE;
4041   1          }
4042          #endif
4043          #if Enable_Gamma
              Bool AdjustGamaMode(MenuItemActionType action)
              {
                   {
                       if (action == MIA_DecValue)
                       {
                           UserPrefGamaMode = (UserPrefGamaMode + GAMA_Nums - 1) % GAMA_Nums;
                       }
                       else
                       {
                           UserPrefGamaMode = (UserPrefGamaMode + 1) % GAMA_Nums;
                       }
                   
                       #if sRGBIssue
                              UserPrevGamaMode = UserPrefGamaMode;
                       #endif
                   
                      #if Enable_Gamma
                           mStar_SetupGamma( UserPrefGamaMode );
                      #endif
                       if ( UserPrefDcrMode)  //yz.nie  100414 for colorboost on,adjust gammamode,have pictureboost 
                       {
                           #if !ENABLE_HDMI
                           msAccOnOff(1);
                              #endif
                       }
                      #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(GamaMode), UserPrefGamaMode);
                      #else
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                      #endif
                   }
                  return TRUE;
              }
              #endif
4078          Bool AdjustDcrMode(MenuItemActionType action)
4079          {
4080   1          #if ENABLE_HDMI
4081   1          BYTE XDATA ucDomain;
4082   1          #endif
4083   1      
4084   1          action = action;
4085   1      
4086   1          #if ENABLE_HDMI
4087   1          ucDomain = 0x00;
4088   1          if(!IsColorspaceRGB())      //130608 xiandi
4089   1              ucDomain = 0xFF;
4090   1          #endif
4091   1      
4092   1              if( UserPrefDcrMode )
4093   1              {
4094   2                      UserPrefDcrMode = 0;
4095   2                      SetECO();
4096   2              }
4097   1              else
4098   1              {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 68  

4099   2                      UserPrefDcrMode = 1;
4100   2                      #if CT_sRGB_ENABLE
                      if(UserPrefColorTemp==CTEMP_SRGB)               //121122 Modify
                      {
                                      UserPrefColorTemp=CTEMP_Warm1;
                                      #if !USEFLASH
                                      NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                                      #endif
                      }
                              #endif
4109   2      
4110   2                      #if DcrResetEcoFuncEnable
4111   2                      UserPrefECOMode = ECO_Standard;
4112   2                      ReadColorTempSetting();
4113   2                      #endif
4114   2      
4115   2              #if MWEFunction
4116   2                      {
4117   3                        ICE_MAIN_CTRL(0);                             //120117 Modify
4118   3                        ICE_SUB_CTRL(0);                              //120117 Modify
4119   3               }
4120   2                      
4121   2              #endif
4122   2                      
4123   2              }
4124   1      #if sRGBIssue
                      UserPrevDcrMode=UserPrefDcrMode;
              #endif
4127   1              msDCROnOff(UserPrefDcrMode, MAIN_WINDOW);
4128   1                      
4129   1          #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(DcrMode), UserPrefDcrMode);
                      NVRam_WriteByte(nvrMonitorAddr(ECOMode), UserPrefECOMode);
              
                  #else
4134   1               UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
4135   1          #endif
4136   1          return TRUE;
4137   1      }
4138              //=====================================================================
4139              #if 1
4140                  Bool SetFactoryColorTempCool1(void)
4141                  {
4142   1                  UserPrefColorTemp = CTEMP_Cool1;
4143   1                  ReadColorTempSetting(); // 2006/11/10 6:58PM by KK ReadCool1Setting();
4144   1                  mStar_AdjustBrightness(UserPrefBrightness);
4145   1                  mStar_AdjustContrast(UserPrefContrast);
4146   1                  return TRUE;
4147   1              }
4148                  Bool SetFactoryColorTempWarm1(void)
4149                  {
4150   1                  UserPrefColorTemp = CTEMP_Warm1;
4151   1                  ReadColorTempSetting(); // 2006/11/10 6:57PM by KK  ReadWarm1Setting();
4152   1                  mStar_AdjustBrightness(UserPrefBrightness);
4153   1                  mStar_AdjustContrast(UserPrefContrast);
4154   1                  return TRUE;
4155   1              }
4156                          #if CT_7500K_ENABLE
                      Bool SetFactoryColorTempNormal(void)
                      {
                          UserPrefColorTemp = CTEMP_Normal;
                          ReadColorTempSetting(); // 2006/11/10 6:58PM by KK ReadNormalSetting();
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 69  

                          mStar_AdjustBrightness(UserPrefBrightness);
                          mStar_AdjustContrast(UserPrefContrast);
                          return TRUE;
                      }
                              #endif
4166                          #if CT_sRGB_ENABLE
                      Bool SetFactoryColorTempSRGB(void)
                      {
                          UserPrefColorTemp = CTEMP_SRGB;
                          ReadColorTempSetting(); // 2006/11/10 6:58PM by KK ReadSRGBSetting();
                          mStar_AdjustBrightness(UserPrefBrightness);
                          mStar_AdjustContrast(UserPrefContrast);
                          return TRUE;
                      }
                              #endif
4176              #endif
4177              #if 1
4178                  //====================================================
4179                  Bool AdjustRedColorCool1(MenuItemActionType action)
4180                  {
4181   1                  WORD tempValue;
4182   1                  tempValue = DecIncValue(action, UserPrefRedColorCool1, MinColorValue, MaxColorValue, 1);
4183   1                  if (tempValue == UserPrefRedColorCool1)
4184   1                  {
4185   2                      return FALSE;
4186   2                  }
4187   1                  UserPrefRedColorCool1 = tempValue;
4188   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
4191   1                      mStar_AdjustRedColor(UserPrefRedColorCool1, UserPrefContrast);
4192   1                  #endif
4193   1                  return TRUE;
4194   1              }
4195                  Bool AdjustGreenColorCool1(MenuItemActionType action)
4196                  {
4197   1                  WORD tempValue;
4198   1                  tempValue = DecIncValue(action, UserPrefGreenColorCool1, MinColorValue, MaxColorValue, 1);
4199   1                  if (tempValue == UserPrefGreenColorCool1)
4200   1                  {
4201   2                      return FALSE;
4202   2                  }
4203   1                  UserPrefGreenColorCool1 = tempValue;
4204   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
4207   1                      mStar_AdjustGreenColor(UserPrefGreenColorCool1, UserPrefContrast);
4208   1                  #endif
4209   1                  return TRUE;
4210   1              }
4211                  Bool AdjustBlueColorCool1(MenuItemActionType action)
4212                  {
4213   1                  WORD tempValue;
4214   1                  tempValue = DecIncValue(action, UserPrefBlueColorCool1, MinColorValue, MaxColorValue, 1);
4215   1                  if (tempValue == UserPrefBlueColorCool1)
4216   1                  {
4217   2                      return FALSE;
4218   2                  }
4219   1                  UserPrefBlueColorCool1 = tempValue;
4220   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 70  

4223   1                      mStar_AdjustBlueColor(UserPrefBlueColorCool1, UserPrefContrast);
4224   1                  #endif
4225   1                  return TRUE;
4226   1              }
4227          
4228                  WORD GetRColorCool1Value(void)
4229                  {
4230   1                  return UserPrefRedColorCool1;
4231   1              }
4232                  WORD GetGColorCool1Value(void)
4233                  {
4234   1                  return UserPrefGreenColorCool1;
4235   1              }
4236                  WORD GetBColorCool1Value(void)
4237                  {
4238   1                  return UserPrefBlueColorCool1;
4239   1              }
4240          
4241                  //====================================================
4242                  Bool AdjustRedColorWarm1(MenuItemActionType action)
4243                  {
4244   1                  WORD tempValue;
4245   1                  tempValue = DecIncValue(action, UserPrefRedColorWarm1, MinColorValue, MaxColorValue, 1);
4246   1                  if (tempValue == UserPrefRedColorWarm1)
4247   1                  {
4248   2                      return FALSE;
4249   2                  }
4250   1                  UserPrefRedColorWarm1 = tempValue;
4251   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
4254   1                      mStar_AdjustRedColor(UserPrefRedColorWarm1, UserPrefContrast);
4255   1                  #endif
4256   1                  return TRUE;
4257   1              }
4258                  Bool AdjustGreenColorWarm1(MenuItemActionType action)
4259                  {
4260   1                  WORD tempValue;
4261   1                  tempValue = DecIncValue(action, UserPrefGreenColorWarm1, MinColorValue, MaxColorValue, 1);
4262   1                  if (tempValue == UserPrefGreenColorWarm1)
4263   1                  {
4264   2                      return FALSE;
4265   2                  }
4266   1                  UserPrefGreenColorWarm1 = tempValue;
4267   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
4270   1                      mStar_AdjustGreenColor(UserPrefGreenColorWarm1, UserPrefContrast);
4271   1                  #endif
4272   1                  return TRUE;
4273   1              }
4274                  Bool AdjustBlueColorWarm1(MenuItemActionType action)
4275                  {
4276   1                  WORD tempValue;
4277   1                  tempValue = DecIncValue(action, UserPrefBlueColorWarm1, MinColorValue, MaxColorValue, 1);
4278   1                  if (tempValue == UserPrefBlueColorWarm1)
4279   1                  {
4280   2                      return FALSE;
4281   2                  }
4282   1                  UserPrefBlueColorWarm1 = tempValue;
4283   1                  #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 71  

                          #else
4286   1                      mStar_AdjustBlueColor(UserPrefBlueColorWarm1, UserPrefContrast);
4287   1                  #endif
4288   1                  return TRUE;
4289   1              }
4290                  WORD GetRColorWarm1Value(void)
4291                  {
4292   1                  return UserPrefRedColorWarm1;
4293   1              }
4294                  WORD GetGColorWarm1Value(void)
4295                  {
4296   1                  return UserPrefGreenColorWarm1;
4297   1              }
4298                  WORD GetBColorWarm1Value(void)
4299                  {
4300   1                  return UserPrefBlueColorWarm1;
4301   1              }
4302          
4303                  //===============================================================
4304          #if CT_7500K_ENABLE        
                      Bool AdjustRedColorNormal(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefRedColorNormal, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefRedColorNormal)
                          {
                              return FALSE;
                          }
                          UserPrefRedColorNormal = tempValue;
                          #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustRedColor(UserPrefRedColorNormal, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
                      Bool AdjustGreenColorNormal(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefGreenColorNormal, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefGreenColorNormal)
                          {
                              return FALSE;
                          }
                          UserPrefGreenColorNormal = tempValue;
                          #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustGreenColor(UserPrefGreenColorNormal, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
                      Bool AdjustBlueColorNormal(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefBlueColorNormal, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefBlueColorNormal)
                          {
                              return FALSE;
                          }
                          UserPrefBlueColorNormal = tempValue;
                          #if UsesRGB
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 72  

                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustBlueColor(UserPrefBlueColorNormal, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
              
                      WORD GetRColorNormalValue(void)
                      {
                          return UserPrefRedColorNormal;
                      }
                      WORD GetGColorNormalValue(void)
                      {
                          return UserPrefGreenColorNormal;
                      }
                      WORD GetBColorNormalValue(void)
                      {
                          return UserPrefBlueColorNormal;
                      }
              #endif
4367                  //====================================================
4368                          #if CT_sRGB_ENABLE
                      Bool AdjustRedColorSRGB(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefRedColorSRGB, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefRedColorSRGB)
                          {
                              return FALSE;
                          }
                          UserPrefRedColorSRGB = tempValue;
                          #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustRedColor(UserPrefRedColorSRGB, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
                      Bool AdjustGreenColorSRGB(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefGreenColorSRGB, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefGreenColorSRGB)
                          {
                              return FALSE;
                          }
                          UserPrefGreenColorSRGB = tempValue;
                          #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustGreenColor(UserPrefGreenColorSRGB, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
                      Bool AdjustBlueColorSRGB(MenuItemActionType action)
                      {
                          WORD tempValue;
                          tempValue = DecIncValue(action, UserPrefBlueColorSRGB, MinColorValue, MaxColorValue, 1);
                          if (tempValue == UserPrefBlueColorSRGB)
                          {
                              return FALSE;
                          }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 73  

                          UserPrefBlueColorSRGB = tempValue;
                          #if UsesRGB
                              mStar_AdjustContrast(UserPrefContrast);
                          #else
                              mStar_AdjustBlueColor(UserPrefBlueColorSRGB, UserPrefContrast);
                          #endif
                          return TRUE;
                      }
              
                      WORD GetRColorSRGBValue(void)
                      {
                          return UserPrefRedColorSRGB;
                      }
                      WORD GetGColorSRGBValue(void)
                      {
                          return UserPrefGreenColorSRGB;
                      }
                      WORD GetBColorSRGBValue(void)
                      {
                          return UserPrefBlueColorSRGB;
                      }
                      #endif
4431              #endif
4432          #if ENABLE_FACTORY_SSCADJ       //120305 Modify
4433                  Bool AdjustFactorySSCModulation( MenuItemActionType action )
4434                  {
4435   1                      WORD xdata tempValue;
4436   1              
4437   1                      tempValue = DecIncValue( action, FactorySetting.SSCModulation, 0, PANEL_SSC_MODULATION_MAX, 1 );
4438   1                      //tempValue = DecIncValue( action, FactorySetting.SSCModulation, 0, MAX_MODULATION, 1 );
4439   1                      if( tempValue == FactorySetting.SSCModulation )
4440   1                              return FALSE;
4441   1              
4442   1                      FactorySetting.SSCModulation = tempValue;
4443   1                      
4444   1                      mStar_SetPanelSSC(FactorySetting.SSCModulation, FactorySetting.SSCPercentage);
4445   1              
4446   1              #if USEFLASH
4447   1                      Set_FlashForceSaveFactoryFlag();
4448   1              #else
                              NVRam_WriteByte( nvrFactoryAddr( SSCModulation ), FactorySetting.SSCModulation );
                      #endif
4451   1                      
4452   1                      return TRUE;
4453   1              }
4454                  
4455                  WORD GetFactorySSCModulationValue( void )
4456                  {
4457   1                      return FactorySetting.SSCModulation;
4458   1              }
4459                  
4460                  Bool AdjustFactorySSCPercentage( MenuItemActionType action )
4461                  {
4462   1                      WORD xdata tempValue;
4463   1                    tempValue = DecIncValue( action, FactorySetting.SSCPercentage, 0, PANEL_SSC_PERCENTAGE_MAX, 
             -1 );
4464   1                      //tempValue = DecIncValue( action, FactorySetting.SSCPercentage, 0, MAX_PERCENTAGE, 1 );
4465   1                      if( tempValue == FactorySetting.SSCPercentage )
4466   1                              return FALSE;
4467   1              
4468   1                      FactorySetting.SSCPercentage = tempValue;
4469   1                      
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 74  

4470   1                      mStar_SetPanelSSC(FactorySetting.SSCModulation, FactorySetting.SSCPercentage);
4471   1              #if USEFLASH
4472   1                      Set_FlashForceSaveFactoryFlag();
4473   1              #else
                              NVRam_WriteByte( nvrFactoryAddr( SSCPercentage ), FactorySetting.SSCPercentage );
                      #endif
4476   1                      return TRUE;
4477   1              }
4478                  
4479                  WORD GetFactorySSCPercentageValue( void )
4480                  {
4481   1                      return FactorySetting.SSCPercentage;
4482   1              }
4483          #endif
4484              //======================================================================================
4485              Bool EnableBurninMode(void)
4486              {
4487   1              PatternNo = 0;
4488   1                      drvOSD_FrameColorEnable(TRUE);
4489   1                      
4490   1              return TRUE;
4491   1          }
4492              #if 1
4493                  WORD GetBurninValue(void)
4494                  {
4495   1                  return (BurninModeFlag) ? (1): (0);
4496   1              }
4497                  Bool AdjustBurnin(MenuItemActionType action)
4498                  {
4499   1                  action = action;
4500   1                  if (BurninModeFlag)
4501   1                  {
4502   2                      Clr_BurninModeFlag();
4503   2                                      Clr_DoBurninModeFlag(); //120112 Modify for TPV Request
4504   2                  }
4505   1                  else
4506   1                  {
4507   2                      Set_BurninModeFlag();
4508   2                                      Set_DoBurninModeFlag(); //120112 Modify for TPV Request
4509   2                  }
4510   1                  Delay1ms(200);
4511   1                  return TRUE;
4512   1              }
4513              #endif
4514          
4515          #if !USEFLASH // 130829 larry
                      Bool EraseAllEEPROMCell( void )
                      {
                              if( UserPrefBrightness == 0 && UserPrefContrast == MinContrastValue )
                              {
                                      WORD  i;
                                      
                        #if (EEPROM_TYPE==EEPROM_24C32)
                                  BYTE xdata EmplyTable[16]={0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF
             -F,0xFF,};
                                  for( i = 0; i < 0xff; i++ )
                                          NVRam_WriteTbl(i*(16), (BYTE*) &EmplyTable, 16);
                                      
                        #else
                           #if (EEPROM_TYPE==EEPROM_24C04)
                                              for( i = 0; i < 0x1ff; i++ )
                         
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 75  

                           #elif (EEPROM_TYPE==EEPROM_24C16)
                                    for( i = 0; i < 0x7ff; i++ )
                            #endif
                                                      NVRam_WriteByte( i, 0xFF );
                        #endif
              
                      
                                      //Power_TurnOnAmberLed();
                                
                                return TRUE;
                              }
                              else
                                      return FALSE;
                                      
                      }
              #endif
4547                  
4548              #if 0//DisplayPowerOnLogo//130613 Jun
                      WORD GetLogoValue(void)
                      {
                          return (UserPrefLogoON) ? (1): (0);
                      }
                      Bool AdjustLogo(MenuItemActionType action)
                      {
                          action = action;
                          if (UserPrefLogoON)
                          {
                              UserPrefLogoON=0;//130613 Modify for TPV Request
                          }
                          else
                          {
                              UserPrefLogoON=1;//130613 Modify for TPV Request
                          }
                          #if USEFLASH
                          SaveFactorySetting();
                          #else
                          NVRam_WriteByte(nvrFactoryAddr(LogoON), UserPrefLogoON);
                          #endif
                                      
                          return TRUE;
                      }
                  #endif
4573              #if Enable_ProductModeAdjust
                      WORD GetProductModeValue(void)
                      {
                          return (0);
                      }
                      Bool AdjustProductMode(MenuItemActionType action)
                      {
                          action = action;
                          if(UserPrefBrightness==0&&UserPrefContrast==MinContrastValue)
                              {
              
                                  {
                                              #if USEFLASH
                                              FactoryProductModeValue=ProductModeOnValue;
                                              UserPref_EnableFlashSaveBit(bFlashSaveFactoryBit);
                                              #else
                                              //WORD temp=ProductModeOnValue;
                                              //NVRam_WriteTbl(ProductModeAddr, (BYTE*)(&temp), 2);
                                              NVRam_WriteWord(ProductModeAddr, ProductModeOnValue);
                                              #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 76  

                                              Set_GreenLedFlash(5);
                                  }
                              }
                          return TRUE;
                      }
                  #endif
4599              //====================================================
4600              
4601              Bool EnterDisplayLogo(void)
4602              {
4603   1              OsdCounter = 3;
4604   1              mStar_SetupFreeRunMode();
4605   1                      Osd_Hide();
4606   1              Power_TurnOnPanel();
4607   1                      Osd_Show();
4608   1              return TRUE;
4609   1          }
4610          
4611          
4612          #endif
4613          #if DDCCI_ENABLE
4614              #if 0
                      void AdjustTempColorTemp(BYTE ctemp)
                      {
                          mStar_AdjustBrightness(*(ColorTempPtr[ctemp][0])); //wei1010
                          mStar_AdjustRedColor(*(ColorTempPtr[ctemp][1]), *(ColorTempPtr[ctemp][2]));
                          mStar_AdjustGreenColor(*(ColorTempPtr[ctemp][1]), *(ColorTempPtr[ctemp][3]));
                          mStar_AdjustBlueColor(*(ColorTempPtr[ctemp][1]), *(ColorTempPtr[ctemp][4]));
                      }
                      Bool ResetGeometry(void)
                      {
                          //Reset HStart
                          UserPrefHStart = StandardModeHStart;
                          mStar_AdjustHPosition(UserPrefHStart);
                          NVRam_WriteByte(nvrModeAddr(HStart), UserPrefHStart);
                          //Reset VStart
                          UserPrefVStart = StandardModeVStart;
                          mStar_AdjustVPosition(UserPrefVStart);
                          NVRam_WriteByte(nvrModeAddr(VStart), UserPrefVStart);
                          //Reset HTotal
                          UserPrefHTotal = StandardModeHTotal;
                          mStar_AdjustHTotal(UserPrefHTotal);
                          NVRam_WriteByte(nvrModeAddr(HTotal), UserPrefHTotal);
                          //Reset Phase
                          UserPrefPhase = 0; // Bruce 1211.2003
                          mStar_AdjustPhase(UserPrefPhase);
                          NVRam_WriteByte(nvrModeAddr(Phase), UserPrefPhase);
                          Clr_SaveSettingFlag();
                          return TRUE;
                      }
                      Bool ResetColorTemp(void)
                      {
                          /*
                          UserPrefRedColor9300K=Def9300KRedColor;
                          UserPrefGreenColor9300K=Def9300KGreenColor;
                          UserPrefBlueColor9300K=Def9300KBlueColor;
                          UserPrefRedColor7200K=Def7200KRedColor;
                          UserPrefGreenColor7200K=Def7200KGreenColor;
                          UserPrefBlueColor7200K=Def7200KBlueColor;
                          UserPrefRedColor6500K=Def6500KRedColor;
                          UserPrefGreenColor6500K=Def6500KGreenColor;
                          UserPrefBlueColor6500K=Def6500KBlueColor;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 77  

                          NVRam_WriteByte(nvrMonitorAddr(RedColor9300K), UserPrefRedColor9300K);
                          NVRam_WriteByte(nvrMonitorAddr(GreenColor9300K), UserPrefGreenColor9300K);
                          NVRam_WriteByte(nvrMonitorAddr(BlueColor9300K), UserPrefBlueColor9300K);
                          NVRam_WriteByte(nvrMonitorAddr(RedColor7200K), UserPrefRedColor7200K);
                          NVRam_WriteByte(nvrMonitorAddr(GreenColor7200K), UserPrefGreenColor7200K);
                          NVRam_WriteByte(nvrMonitorAddr(BlueColor7200K), UserPrefBlueColor7200K);
                          NVRam_WriteByte(nvrMonitorAddr(RedColor6500K), UserPrefRedColor6500K);
                          NVRam_WriteByte(nvrMonitorAddr(GreenColor6500K), UserPrefGreenColor6500K);
                          NVRam_WriteByte(nvrMonitorAddr(BlueColor6500K), UserPrefBlueColor6500K);
                           */
                          UserPrefRedColor = DefRedColor;
                          UserPrefGreenColor = DefGreenColor;
                          UserPrefBlueColor = DefBlueColor;
                          NVRam_WriteByte(nvrMonitorAddr(RedColor), UserPrefRedColor);
                          NVRam_WriteByte(nvrMonitorAddr(GreenColor), UserPrefGreenColor);
                          NVRam_WriteByte(nvrMonitorAddr(BlueColor), UserPrefBlueColor);
                          UserPrefColorTemp = CTEMP_Cool1;
                          NVRam_WriteByte(nvrMonitorAddr(ColorTemp), UserPrefColorTemp);
                          AdjustTempColorTemp(UserPrefColorTemp);
                          return TRUE;
                      }
                  #endif
4677          #endif
4678          #if 0//AudioFunc
                  Bool SetMute(void)
                  {
                      hw_SetMute();
                      //hw_SetStandby();
                      return TRUE;
                  }
              #endif
4686          
4687          
4688          
4689          WORD GetPanelOnTimeValue(void)
4690          {
4691   1          WORD xdata hour;
4692   1               #if Show_BackLightTimeValue
4693   1                      hour =BlacklitTime_H; 
4694   1              #endif
4695   1          return hour;
4696   1      }
4697          WORD GetPanelOnTimeMValue(void)
4698          {
4699   1          WORD xdata Min;
4700   1               #if Show_BackLightTimeValue
4701   1                      Min =BlacklitTime_M; 
4702   1              #endif
4703   1          return Min;
4704   1      }
4705          
4706          
4707          
4708          #if 1
4709          
4710          WORD GetCheckSumValue(void)
4711          {
4712   1      
4713   1          return Code_checksun;
4714   1      }
4715          #endif
4716          
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 78  

4717          
4718          #if F_ShowVsync_Enable
              WORD GetVsyncValue(void)
              {
                  WORD ValueTemp;
                  ValueTemp =GetSrcFreesyncFPS();
              
                  return (ValueTemp&0xFFFF);
              }
              
              #endif
4728          
4729          
4730          
4731          
4732          #if Enable_Expansion
4733          /*
4734          
4735          #define WAIT_V_OUTPUT_BLANKING_START()   { if(!SyncLossState()&&PanelOnFlag){SetTimOutConter(30);while(((m
             -sReadByte(SC0_E0)&BIT0)==0)&&bTimeOutCounterFlag);\
4736                                                  SetTimOutConter(30);while(((msReadByte(SC0_E0)&BIT0)!=0)&&bTimeOut
             -CounterFlag);}}//20130227 modify for DC OFF issue
4737          */
4738          void SetExpansionMode(void)
4739          {
4740   1          mStar_WaitForDataBlanking();    //120204 Modify
4741   1          mStar_BlackWhiteScreenCtrl(BW_SCREEN_BLACK);
4742   1          mStar_WaitForDataBlanking();    //120204 Modify
4743   1          
4744   1      #if (CHIP_ID!=CHIP_TSUMU && CHIP_ID!=CHIP_TSUM2&& CHIP_ID!=CHIP_TSUMC&& CHIP_ID!=CHIP_TSUMD&& CHIP_ID!=CHI
             -P_TSUM9&& CHIP_ID!=CHIP_TSUMF)
                          mStar_SetScalingFactor();
              #else // 121113 coding, check it again in gaming model
4747   1      
4748   1              #if CHIP_ID==CHIP_TSUMU         //william130802 For Q2770PQU 4:3 fail
                          hw_ClrBlacklit();
                         Delay1ms(300);
                      #endif
4752   1          #if ENABLE_OVER_SCAN ||  CHIP_ID==CHIP_TSUMD //130909 nick add for FRC case
                          mStar_SetCaptureWindow();
                  #endif
4755   1                  mStar_SetupPath();
4756   1                  mStar_SetTimingGen(PanelWidth, PanelHeight, FALSE);
4757   1                   
4758   1                  #if ENABLE_OVER_SCAN                
                          //if(!g_SetupPathInfo.bFBMode)
                              mStar_SetPanelTiming();
                          #endif 
4762   1                  
4763   1                  Delay1ms(300);
4764   1                  hw_SetBlacklit();
4765   1          
4766   1      #endif
4767   1      
4768   1      #if 0//ENABLE_RTE
                      if(
                  #if 0
              
                      #else
                      UserPrefRTEMode==OFF
                  #endif
                      #if ENABLE_DISPLAY_UNDERSCAN
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 79  

                              ||(UnderScanSetting.Enable)||(g_SetupPathInfo.bFBMode)
                      #endif
                      #if ENABLE_DUAL_LINK
                              ||(GetVfreq()>85
                      #if ENABLE_120Hz_OD
                              && !(g_SetupPathInfo.wImgSizeOutH==PanelWidth &&  g_SetupPathInfo.wImgSizeOutV==PanelHeight)
                      #endif
                      )//(SrcModeIndex==MODE_1920x1080P_144Hz)
                      #endif
                      )
                      {
                              msOverDriveOnOff( FALSE );
                      }
                      else
                      {
                              msOverDriveOnOff( FALSE );
                              msRTE_LoadLUT();
                              msOverDriveOnOff( TRUE );
                      }
              #endif
4796   1      
4797   1      #if ((CHIP_ID==CHIP_TSUMY)||(CHIP_ID==CHIP_TSUMC)||(CHIP_ID==CHIP_TSUMD)||(CHIP_ID==CHIP_TSUMU)||(CHIP_ID 
             -== CHIP_TSUM9)||(CHIP_ID == CHIP_TSUMF))              //130116_1 Henry For Garbage
4798   1              WAIT_V_OUTPUT_BLANKING_START();
4799   1      #else
                  mStar_WaitForDataBlanking();    //120204 Modify
              #endif
4802   1          mStar_BlackWhiteScreenCtrl(BW_SCREEN_OFF);
4803   1      
4804   1      }
4805          Bool AdjustExpansionMode(MenuItemActionType action)
4806          {
4807   1      #if ENABLE_OVER_SCAN    //121228 Modify 
                      //if (INPUT_IS_NATIVE_TIMING())
                              //return FALSE;
              #else
4811   1          if (!ExpansionFlag)
4812   1              return FALSE;
4813   1      #endif
4814   1          {
4815   2                  if (action == MIA_DecValue)
4816   2                  {
4817   3                      UserprefExpansionMode = (UserprefExpansionMode + Expansion_Nums - 1) % Expansion_Nums;
4818   3                  }
4819   2                  else
4820   2                  {
4821   3                      UserprefExpansionMode = (UserprefExpansionMode + 1) % Expansion_Nums;
4822   3                  }
4823   2              //UserprefExpansionMode++;
4824   2             // UserprefExpansionMode = (UserprefExpansionMode) % Expansion_Nums;
4825   2      
4826   2              
4827   2                      #if ENABLE_OVER_SCAN    //121228 Modify
                                      if(UserprefExpansionMode==Expansion_Aspect && INPUT_IS_WILD_TIMING())
                                      {
                                          if (action == MIA_DecValue)
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + Expansion_Nums - 1) % Exp
             -ansion_Nums;
                                          }
                                          else
                                          {
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 80  

                                              UserprefExpansionMode = (UserprefExpansionMode + 1) % Expansion_Nums;
                                          }
                                              //UserprefExpansionMode++;
                                              //UserprefExpansionMode = (UserprefExpansionMode) % Expansion_Nums;
                                      }
                                      if((UserprefExpansionMode==Expansion_Aspect||UserprefExpansionMode==Expansion_11) && INPUT_IS_NA
             -TIVE_TIMING())
                                      {
                                          if (action == MIA_DecValue)
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + Expansion_Nums - 1) % Exp
             -ansion_Nums;
                                          }
                                          else
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + 1) % Expansion_Nums;
                                          }
                                      }
                                      if((UserprefExpansionMode==Expansion_Aspect||UserprefExpansionMode==Expansion_11) && INPUT_IS_NA
             -TIVE_TIMING())
                                      {
                                          if (action == MIA_DecValue)
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + Expansion_Nums - 1) % Exp
             -ansion_Nums;
                                          }
                                          else
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + 1) % Expansion_Nums;
                                          }
                                      }
                                      if((UserprefExpansionMode==Expansion_11) && ((StandardModeWidth > PANEL_WIDTH) || (StandardModeHeight >
             - PANEL_HEIGHT)))
                                      {
                                          if (action == MIA_DecValue)
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + Expansion_Nums - 1) % Exp
             -ansion_Nums;
                                          }
                                          else
                                          {
                                              UserprefExpansionMode = (UserprefExpansionMode + 1) % Expansion_Nums;
                                          }
                                      }
                              #endif
4875   2              SetExpansionMode();
4876   2          }
4877   1      
4878   1      #if DEBUG_PRINTDATA
                  printData("UserprefExpansionMode:%d", UserprefExpansionMode);
              #endif
4881   1          
4882   1      
4883   1          #if !USEFLASH
                      NVRam_WriteByte(nvrMonitorAddr(ExpansionMode), UserprefExpansionMode);
                  #else
4886   1              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
4887   1          #endif
4888   1          return TRUE;
4889   1      }
4890          #endif
4891          
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 81  

4892          #if 0
              Bool DoAutoConfig(void)
              {
                      if(DoAutoConfigFlag)
                           AutoConfig();
                  Clr_DoAutoConfigFlag();
              
                  return TRUE;
              }
              #endif
4902          
4903          #if 0
              void SetDefaultSetting(BYTE ucDef)
              {
                      if(ucDef)
                      {
                      if(SrcInputType<Input_Digital)// image setting by default
                              {
                                      if(UserPrefAutoTimes==0)
                                      {
                                              mStar_AdjustHPosition(StandardModeHStart);
                                              mStar_AdjustVPosition(StandardModeVStart);
                                      }
                                      else
                                      {
                                              mStar_AdjustHPosition(UserPrefAutoHStart);
                                              mStar_AdjustVPosition(UserPrefAutoVStart);
                                      }
                                              drvADC_AdjustHTotal( StandardModeHTotal );
                                              drvADC_SetPhaseCode( 0 );
                              }               
                              
                              mStar_AdjustBrightness(DefBrightness);
                              mStar_AdjustContrast(DefContrast);
                              msWriteByte(0x00, 0x06);
                              msWriteByte(0x30, 0x00);
                              msWriteByte(0x00, 0x00);
                              msWriteByte(SC0_5C, msReadByte(0x5C)&~BIT3);//disable all sub-win setting
                              #if AudioFunc
                              mStar_AdjustVolume(50);
                              #endif
                  #if Enable_Expansion
                      {
                              mStar_SetScalingFactor();
                      }
                  #endif
              
                  Osd_SetTransparence(1);             //120119 Modify
                  #if OSD_PIVOT_EN  //071226
                  if(OSDRotateFlag)
                  Osd_SetPosition(50, 50);                    
                  else
                  #endif              
                  Osd_SetPosition(50, 50);
              #if Enable_OsdEngine1
                  Osd_SetOsdEngine(1);
                  #if OSD_PIVOT_EN  //071226
                  if(OSDRotateFlag)
                  Osd_SetPosition(50, 50);            
                  else
                  #endif      
                  Osd_SetPosition(50, 50);
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 82  

                  Osd_SetOsdEngine(0);
              #endif
                      #if Enable_Gamma
                      mStar_SetupGamma(GAMA1);
                      #endif
              
                      }
                      else
                      {
                              if(SrcInputType<Input_Digital) // image setting by user
                              {
                                      mStar_AdjustHPosition(UserPrefHStart);
                                      mStar_AdjustVPosition(UserPrefVStart);
                                              drvADC_AdjustHTotal( UserPrefHTotal );
                                              drvADC_SetPhaseCode( UserPrefPhase );
                              }                       
                  #if AudioFunc
                  mStar_AdjustVolume(UserPrefVolume);
                  #endif
                  #if Enable_Expansion
                      mStar_SetScalingFactor();
                  #endif
              //              mStar_SetUserPref();
                      mStar_AdjustBrightness( UserPrefBrightness );
                      mStar_AdjustContrast(UserPrefContrast);
                      if( UserPrefColorFlags )
                      {
                              msWriteByte(0x00, 0x06);
                              if(DemoFlag)
                                      msWriteByte(0x30,0x07);
                              else
                                      msWriteByte(0x30,0x70);
                              msWriteByte(0x00, 0x00);
                      }
                  if (UserPrefDcrMode ||DemoFlag ||PictureBoostFlag)
                      {
                      msWriteByte(SC0_5C, msReadByte(SC0_5C) | BIT3);
                      }
                  Osd_SetTransparence(UserPrefOsdTrans);
                  #if OSD_PIVOT_EN  //071226
                  if(OSDRotateFlag)
                  Osd_SetPosition(100-UserPrefOsdHStart, 100-UserPrefOsdVStart);                      
                  else
                  #endif              
                  Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
                  #if Enable_OsdEngine1
                  Osd_SetOsdEngine(1);
                  #if OSD_PIVOT_EN  //071226
                  if(OSDRotateFlag)
                  Osd_SetPosition(100-UserPrefOsdHStart, 100-UserPrefOsdVStart);                      
                  else
                  #endif      
                  Osd_SetPosition(UserPrefOsdHStart, UserPrefOsdVStart);
                  Osd_SetOsdEngine(0);
              #endif
                      #if Enable_Gamma
                      mStar_SetupGamma(UserPrefGamaMode);
                      #endif
                  
                      }
              }
              #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 83  

5016          
5017          
5018          #if 0
                      WORD GetOverDriveValue(void)
                      {
                          return (OverDriveOnFlag) ? (1): (0);
                      }
              #endif
5024          #if (ENABLE_RTE)
              
              Bool AdjustOverDrive(MenuItemActionType action)
              {
              
                      /*
                      if (action == MIA_DecValue)
                      {
                          UserPrefRTEMode = (UserPrefRTEMode + RTE_Nums - 1) % RTE_Nums;
                      }
                      else
                      {
                          UserPrefRTEMode = (UserPrefRTEMode + 1) % RTE_Nums;
                      }
                      */
                      action = action;
                      UserPrefRTEMode = UserPrefRTEMode?0:1;  
              
              
                      if(UserPrefRTEMode==OFF
              #if ENABLE_DISPLAY_UNDERSCAN
                          || (UnderScanSetting.Enable)||(g_SetupPathInfo.bFBMode)
              #endif
              #if ENABLE_DUAL_LINK
                         ||((GetVfreq()>85)&&(!ENABLE_FREESYNC)
                                      #if ENABLE_120Hz_OD
                                              && !(g_SetupPathInfo.wImgSizeOutH==PanelWidth &&  g_SetupPathInfo.wImgSizeOutV==PanelHeight)
                                      #endif
                          )//(SrcModeIndex==MODE_1920x1080P_144Hz)    //130328 Modify
              #endif
                          )
                      {
                          //Set_OverDriveOnFlag();
                          //Clr_OverDriveOnFlag();
                          msOverDriveOnOff( FALSE );
                      }
                      else
                      {
                          {
                             msOverDriveOnOff( FALSE );
                             //Clr_OverDriveOnFlag();
                                  msRTE_LoadLUT();
                             msOverDriveOnOff( TRUE );
                          }
                      }
                          
                      //Delay1ms(200);
              
                  
                      #if !USEFLASH
                              NVRam_WriteByte(nvrMonitorAddr(RTEMode), UserPrefRTEMode);
                      #else
                              UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                      #endif
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 84  

                      return TRUE;
              }
              #endif
5081          
5082          
5083          
5084          
5085          #if PanelminiLVDS || PANEL_VCOM_ADJUST  //110229 Modify
              WORD GetVCOMValue(void)
              {
                   return FactorySetting.VcomValue;
              }
              
              Bool AdjustVCOMValue(MenuItemActionType action)
              {
                      BYTE tempValue;
                      
                      tempValue = DecIncValue( action, FactorySetting.VcomValue, MIN_VCOM_VALUE, MAX_VCOM_VALUE, 1 );
                      
                      if( tempValue == FactorySetting.VcomValue )
                      {
                              return FALSE;
                      }
                      
                      FactorySetting.VcomValue = tempValue;
                      
                      msWriteMiniLVDSi2c_Vcom_DAC(FactorySetting.VcomValue);
              
                      return TRUE;
              }
              
              
              #endif
5111          
5112          
5113          #if ENABLE_FREESYNC
              #if F_ShowVsync_Enable
              BYTE GetSrcFreesyncFPS(void)
              {
                  BYTE xdata u8Vfreq = 0xFF;
                  DWORD xdata u32OvsPeriod,u8DivN;
                  WORD xdata u16TimeOutCnt;
                  WORD xdata u16IvsPrd_L;
                  BYTE xdata u8IvsPrd_H,u8DivN_L,u8DivN_H;
              
                  u16TimeOutCnt = 600;
                  while(u16TimeOutCnt!=0)
                  {
                      u16TimeOutCnt--;
                      u16IvsPrd_L = msRead2Byte(REG_3842);
                      u8IvsPrd_H = msReadByte(REG_3844);
              
                      u8DivN_L = msReadByte(REG_3819);
                      u8DivN_H = msReadByte(REG_381C);
                      u8DivN=(DWORD)(((u8DivN_H&BIT0)<<4)|(u8DivN_L&0x0F));
                      u32OvsPeriod = ((DWORD)u8IvsPrd_H<<16)|u16IvsPrd_L;
                      if(u32OvsPeriod!=0)
                      {
                          u8Vfreq = (((DWORD)CRYSTAL_CLOCK )*(u8DivN+1)+ u32OvsPeriod/2) / u32OvsPeriod;
                          break;
                      }
                  }
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 85  

                  return u8Vfreq;
              }
              #endif
              
              #if FreeSyncMenu_Enable
              //#message ""
              Bool SetDRRFunction(void)
              {
                  hw_ClrBlacklit();//2 jemery  181008 add
                  msAPI_combo_IPEnableDDRFlag(UserprefFreeSyncMode);
                  return TRUE;
              }
              
              
              
              Bool AdjustFreeSync( MenuItemActionType action )
              {
                   action=action;
                if(UserprefFreeSyncMode==FreeSyncMenuItems_On)
                   UserprefFreeSyncMode=FreeSyncMenuItems_Off;
                else
                   UserprefFreeSyncMode=FreeSyncMenuItems_On;
                
                   Set_OSDFreeSyncActionFlag();
              #if FreeSyncSwitchEDID 
                  FreeSyncEDIDSwitch(HDMI_EDID,UserprefFreeSyncMode);
                  #if ENABLE_HDMI2
                  FreeSyncEDIDSwitch(HDMI2_EDID,UserprefFreeSyncMode);
                  #endif      
              #endif   
              
                   SetDRRFunction();  
              
                  #if USEFLASH
                      UserPref_EnableFlashSaveBit(bFlashSaveMonitorBit); 
                  #else
                      NVRam_WriteByte(nvrMonitorAddr(FreeSyncMode), UserprefFreeSyncMode);
                  #endif
                       
                  return TRUE;
              }
              #endif
              
              
              #endif
5185          #if ENABLE_OSD_LowBlueLight
5186          
5187          Bool SetLowBlueLight(void)
5188          {
5189   1                      // ColorType CT;
5190   1      
5191   1              //       GetColorTempRGB(&CT);
5192   1      
5193   1                //  mStar_AdjustRGBColor(UserPrefContrast, CT.u8Red, CT.u8Green, CT.u8Blue);
5194   1              ReadColorTempSetting();
5195   1                       return TRUE;
5196   1      }
5197          
5198          #if ( LowBlueLightType==LowBlueLight_ColorTemp)||(LowBlueLightType==LowBlueLight_Misc_Group)
5199          Bool AdjustLowBlueLight(MenuItemActionType action)
5200          {
5201   1              WORD    u16TempValue;
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 86  

5202   1              u16TempValue = DecIncValueCirculate(action, UserprefLowBlueLightMode, LowBlueLight_MODE_OSD_MIN, LowBlueL
             -ight_MODE_OSD_MAX, 1);
5203   1      
5204   1              if (u16TempValue == UserprefLowBlueLightMode)
5205   1              {
5206   2                      return FALSE;
5207   2              }
5208   1      
5209   1      #if CT_sRGB_ENABLE
                       if(UserPrefColorTemp==CTEMP_SRGB)
                       {
                              UserPrefColorTemp=CTEMP_Warm1;
                       }
              #endif   
5215   1               UserprefLowBlueLightMode= u16TempValue;
5216   1               SetLowBlueLight();
5217   1      
5218   1              return TRUE;
5219   1      }
5220          #elif ( LowBlueLightType==LowBlueLight_Misc_Guage)
              Bool AdjustLowBlueLight(MenuItemActionType action)
              {
                      WORD    u16TempValue;
                      u16TempValue = DecIncValue(action, UserprefLowBlueLightMode, LowBlueLight_MODE_OSD_MIN, LowBlueLight_MODE
             -_OSD_MAX, 1);
              
                      if (u16TempValue == UserprefLowBlueLightMode)
                      {
                              return FALSE;
                      }
              
              #if CT_sRGB_ENABLE
                       if(UserPrefColorTemp==CTEMP_SRGB)
                       {
                              UserPrefColorTemp=CTEMP_Warm1;
                       }
              #endif   
                       UserprefLowBlueLightMode= u16TempValue;
                       SetLowBlueLight();
              
                      return TRUE;
              }
              
              #if LowBlueLightType==LowBlueLight_Misc_Guage 
              WORD GetLowBlueLightValue( void )
              {
                  //return 5*10;
                  return UserprefLowBlueLightMode*25;
              }
              #endif
              
              #elif ( LowBlueLightType==LowBlueLight_SharpFunc)
              Bool AdjustLowBlueLight(MenuItemActionType action)
              {
              //      WORD    u16TempValue;
              //      u16TempValue = DecIncValue(action, UserprefLowBlueLightMode, LowBlueLight_MODE_OSD_MIN, LowBlueLight_MO
             -DE_OSD_MAX, 1);
              
              //      if (u16TempValue == UserprefLowBlueLightMode)
              //              return FALSE;
              //       UserprefLowBlueLightMode= u16TempValue;
              
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 87  

                  if ( action == MIA_IncValue )
                  {
                      if ( UserprefLowBlueLightMode == LowBlueLight_MODE_OSD_MAX )
                          UserprefLowBlueLightMode = LowBlueLight_MODE_OSD_MIN;
                      else
                          UserprefLowBlueLightMode += 1;
                  }
              
                  else if ( action == MIA_DecValue )
                  {
                      if ( UserprefLowBlueLightMode == LowBlueLight_MODE_OSD_MIN )
                          UserprefLowBlueLightMode = LowBlueLight_MODE_OSD_MAX;
                      else
                          UserprefLowBlueLightMode -= 1;
                  }
              
              
                       gTempLowBlueMode = UserprefLowBlueLightMode;
                       SetLowBlueLight();
              
                      return TRUE;
              }
              
              #endif
5285          #endif
5286          
5287          
5288          #if 1
5289          #if Enable_Adjust_SharpnessMenu
              WORD GetSharpnessValue( void )
              {
                  //return GetScale100Value( 5, 0, 10 );
                  return GetScale100Value( UserPrefSharpness, MinSharpness, MaxSharpness);    //120105 Modify
              }
              WORD GetSharpnessRealValue( void )
              {
                  //return 5*10;
                  return UserPrefSharpness*10;
              }
              #endif
5301          BYTE GetRealSharpness(void)
5302          {
5303   1              #if 1
5304   1              if(CURRENT_INPUT_IS_TMDS()||CURRENT_INPUT_IS_DISPLAYPORT())     //121130 Modify
5305   1                      return SharpnessTable[ByPassSharpness];
5306   1              else 
5307   1              #endif
5308   1              return SharpnessTable[UserPrefSharpness];
5309   1      }
5310          #endif
5311          
5312          
5313          
5314          
5315          
5316          
5317          #if Enable_Adjust_SharpnessMenu
              Bool AdjustSharpness( MenuItemActionType action )
              {
                  WORD tempValue;
                  tempValue = DecIncValue( action, UserPrefSharpness, MinSharpness, MaxSharpness, 1 );        //120105 Modify
                  if( tempValue == UserPrefSharpness )
C51 COMPILER V9.01   MENUFUNC                                                              03/09/2023 15:39:09 PAGE 88  

                  {
                      return FALSE;
                  }
                  UserPrefSharpness = tempValue;
              #if CHIP_ID == CHIP_TSUMV       //130306 Modify
                  if((UserPrefSharpness<DefSharpness )
                              || CURRENT_INPUT_IS_DVI()       //20130513 for DVI dot pattern color deviation problem.
                              )       
                          msAdjustSharpness( MAIN_WINDOW,  GetRealSharpness() ,1);
                  else
              #endif          
                  msAdjustSharpness( MAIN_WINDOW,  GetRealSharpness() ,0);
                  return TRUE;
              
              }
              #endif
5339          
5340          
5341          
5342          
5343          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4677    ----
   CONSTANT SIZE    =    305    ----
   XDATA SIZE       =      2       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      27
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
